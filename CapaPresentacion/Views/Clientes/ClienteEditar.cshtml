@{
    ViewBag.Title = "Creación y modificación de Clientes";
    ViewBag.SubTitle = "";
}
<style>
    .table thead {
        background-color: #5799bf;
        color: #fff;
    }
</style>



<div class="row">
    <div class="col-md-7">
        <div class="panel panel-primary">
            <div class="panel-heading">@ViewBag.EstadoDes</div>         
            <div class="box box-body box-header">             
                    <div class="col-md-6">
                        <div id="prm" class="form-group" disabled>
                            <label for="segape" style="color: #3d566e;">Tipo de Cliente</label>
                            <div class="form-group">                              
                                @Html.DropDownList("dwtipocliente", new SelectList(ViewBag.UsuTipo, "usu_tip_id", "usu_tip_nombre", "-1"), new { @class = "selectpicker", @data_live_search = "true", @id = "dwtipocliente", @name = "dwtipocliente", @data_actions_box = "true", @onchange= "selecciona_tipo_cliente();", @data_selected_text_format = "count > 2" })
                            </div>                
                        </div>
                    </div>                                
            </div>
        </div>
        </div>   
</div>

  <div class="row">
        <div class="col-md-7">
            <div class="box box-widget">
                <div class="box-header with-border">
                    <div class="user-block">
                        <img class="img-circle" src="../Content/images/placeholder-user.jpg" alt="User Image">
                        <span class="username" id="doc-nom-persona" style="color:#f88989">Datos basicos de información personal</span>                     
                        <span class="description" id="ubi-persona">&nbsp;</span>                                                
                    </div>
                    <!-- /.user-block -->
                    <div class="box-tools">
                        <button type="button" class="btn btn-box-tool" id="btnbasico" data-widget="collapse">
                            <i class="fa fa-minus" id="i_basico"></i>
                        </button>
                    </div>
                    <!-- /.box-tools -->
                </div>
                <div class="box-body" id="toggle-example">
                    <div class="row">
                        <div class="col-md-6" style="padding-left: 25px;">
                            <div id="prm" class="form-group" disabled>
                                <label for="segape" style="color: #3d566e;">Tipo de Documento</label>
                                <div class="form-group">
                                    @Html.DropDownList("dwtipodoc", new SelectList(ViewBag.DocTipo, "Doc_Tip_Id", "Doc_Tip_Descripcion", "-1"), new { @class = "selectpicker", @data_live_search = "true", @id = "dwtipodoc", @name = "dwtipodoc", @data_actions_box = "true", @data_selected_text_format = "count > 2" })
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6" style="padding-left: 25px;">
                            <div id="prm" class="form-group" disabled>
                                <label for="segape" style="color: #3d566e;">Numero de Documento</label>
                                <div class="form-group">
                                    @*<input type="text" value="" class="form-control" name="txtdni" id="txtdni" />*@
                                    <input id="txtdni" type="number" min="0" step="1" maxlength="7" focus="true" required placeholder="Ingrese Dni o Ruc" class="form-control" />
                                </div>
                            </div>
                        </div>
                      
                    </div> 
                    <div class="row">
                        <div class="col-md-6" style="padding-left: 25px;">
                            <div id="prm" class="form-group" disabled>
                                <label for="segape" style="color: #3d566e;">Primer Nombre</label>
                                <div class="form-group">
                                    <input type="text" value="" placeholder="Ingrese Primer Nombre" maxlength="55" class="form-control" name="txtprinom" id="txtprinom" />
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6" style="padding-left: 25px;">
                            <div id="prm" class="form-group" disabled>
                                <label for="segape" style="color: #3d566e;">Segundo Nombre</label>
                                <div class="form-group">
                                    <input type="text" value="" placeholder="Ingrese Segundo Nombre" maxlength="55" class="form-control" name="txtsegnom" id="txtsegnom" />
                                </div>
                            </div>
                        </div>
                    </div> 
                    <div class="row">
                        <div class="col-md-6" style="padding-left: 25px;">
                            <div id="prm" class="form-group" disabled>
                                <label for="segape" style="color: #3d566e;">Primer Apellido</label>
                                <div class="form-group">
                                    <input type="text" value="" maxlength="55" placeholder="Ingrese Primer Apellido" class="form-control" name="txtpriapepat" id="txtpriapepat" />
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6" style="padding-left: 25px;">
                            <div id="prm" class="form-group" disabled>
                                <label for="segape" style="color: #3d566e;">Segundo Apellido</label>
                                <div class="form-group">
                                    <input type="text" value="" maxlength="55" placeholder="Ingrese Segundo Apellido" class="form-control" name="txtpriapemat" id="txtpriapemat" />
                                </div>
                            </div>
                        </div>
                    </div> 
                    <div class="row">
                        <div class="col-md-6" style="padding-left: 25px;">
                            <div id="prm" class="form-group" disabled>
                                <label for="segape" style="color: #3d566e;">Fecha Nacimiento</label>
                                <div class="form-group">
                                    <div class="input-group">
                                        <div id="datepickerfecnac" class="input-group date" data-date-format="dd-mm-yyyy">
                                            <input id="fechanac" name="fechanac" value="" class="form-control custom-input" placeholder="dd-mm-yyyy" type="text" />
                                            <span class="input-group-addon  bg-white"><img src="~/Content/images/wall-calendar-with-lines.svg" height="20" width="20"></span>
                                        </div>
                                    </div>
                                    @*<input type="text" value="" class="form-control" name="promocion" id="promocion" />*@
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6" style="padding-left: 25px;">
                            <div id="prm" class="form-group" disabled>
                                <label for="segape" style="color: #3d566e;">Sexo</label>
                                <div class="form-group">                                    
                                    <label class="radio-inline"><input type="radio" name="opt" id="optfemenino" checked>Femenino</label>
                                    <label class="radio-inline"><input type="radio" name="opt" id="optmasculino">Masculino</label>                                    
                                </div>
                            </div>
                        </div>
                    </div> 
                </div>
            </div>
        </div>
    </div>
  <div class="row">
    <div class="col-md-7">
        <div class="box box-widget">
            <div class="box-header with-border">
                <div class="user-block">
                    <img class="img-circle" src="~/Content/images/anular.png" alt="User Image">
                    <span class="username" id="doc-nom-persona" style="color:#f88989">Tipo de persona y otros aspectos</span>                
                </div>
                <!-- /.user-block -->
                <div class="box-tools">
                    <button type="button" class="btn btn-box-tool" id="btntipper" data-widget="collapse">
                        <i class="fa fa-minus" id="i_tipper"></i>
                    </button>
                </div>
                <!-- /.box-tools -->
            </div>
            <div class="box-body">
                @*<div class="row">
                   
                </div>*@
                <div class="row">
                    <div class="col-md-6" style="padding-left: 25px;">
                        <div id="prm" class="form-group" disabled>
                            <label for="segape" style="color: #3d566e;">Tipo de Persona</label>
                            <div class="form-group">                                
                                @Html.DropDownList("dwpertipo", new SelectList(ViewBag.PerTipo, "per_tip_id", "per_tip_descripcion", "-1"), new { @class = "selectpicker", @data_live_search = "true", @id = "dwpertipo", @name = "dwpertipo", @data_actions_box = "true", @data_selected_text_format = "count > 2" })                                
                            </div>
                        </div>
                    </div>                 
                    <div class="col-md-6" style="padding-left: 25px;">
                        <div id="prm" class="form-group" disabled>
                            <label for="segape" style="color: #3d566e;">E-Mail</label>
                            <div class="form-group">
                                <input type="email" value="" maxlength="155" class="form-control" placeholder="Ingrese el E-Mail" name="txtemail" id="txtemail" />
                            </div>
                        </div>
                    </div>
                   
                </div>
                <div class="row">
                    <div class="col-md-6" style="padding-left: 25px;">
                        <div id="prm" class="form-group" disabled>
                            <label for="segape" style="color: #3d566e;">Teléfono</label>
                            <div class="form-group">
                                <input type="text" value="" maxlength="100" class="form-control" placeholder="Ingrese el Telefono" name="txttelefono" id="txttelefono" />
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6" style="padding-left: 25px;">
                        <div id="prm" class="form-group" disabled>
                            <label for="segape" style="color: #3d566e;">Número Celular</label>
                            <div class="form-group">
                                <input type="text" value="" maxlength="55" placeholder="Ingrese el Celular" class="form-control" name="txtcelular" id="txtcelular" />
                            </div>
                        </div>
                    </div>
                </div>              
            </div>
        </div>
    </div>
</div>
  <div class="row">
    <div class="col-md-7">
        <div class="box box-widget">
            <div class="box-header with-border">
                <div class="user-block">
                    <img class="img-circle" src="~/Content/images/ubicacion.png" alt="User Image">
                    <span class="username" id="doc-nom-persona" style="color:#f88989">Ubicacion</span>                 

                </div>
                <!-- /.user-block -->
                <div class="box-tools">
                    <button type="button" class="btn btn-box-tool" id="btnubi" data-widget="collapse">
                        <i class="fa fa-minus" id="i_ubi"></i>
                    </button>
                </div>
                <!-- /.box-tools -->
            </div>
            <div class="box-body">
              
                <div class="row">
                    <div class="col-md-6" style="padding-left: 25px;">
                        <div id="prm" class="form-group" disabled>
                            <label for="segape" style="color: #3d566e;">Departamento</label>
                            <div class="form-group">
                                @Html.DropDownList("dwdep", new SelectList(ViewBag.Dep, "dep_id", "dep_descripcion", "-1"), new { @class = "selectpicker", @data_live_search = "true", @id = "dwdep", @name = "dwdep", onchange= "Listar_Prov_Distri();", @data_actions_box = "true", @data_selected_text_format = "count > 2" })                                                                
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6" style="padding-left: 25px;">
                        <div id="prm" class="form-group" disabled>
                            <label for="segape" style="color: #3d566e;">Provincia</label>
                            <div class="form-group" id="divProv">
                                @Html.DropDownList("dwprov", new SelectList(ViewBag.Prov, "prv_cod", "Prv_Descripcion", "-1"), new { @class = "selectpicker", @data_live_search = "true", @id = "dwprov", @name = "dwprov", @data_actions_box = "true", @data_selected_text_format = "count > 2" })                                
                            </div>
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-6" style="padding-left: 25px;">
                        <div id="prm" class="form-group" disabled>
                            <label for="segape" style="color: #3d566e;">Distrito</label>
                            <div class="form-group" id="divDis">
                                @Html.DropDownList("dwdis", new SelectList(ViewBag.Dis, "Dis_Id", "Dis_Descripcion", "-1"), new { @class = "selectpicker", @data_live_search = "true", @id = "dwdis", @name = "dwdis", @data_actions_box = "true", @data_selected_text_format = "count > 2" })                                
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6" style="padding-left: 25px;">
                        <div id="prm" class="form-group" disabled>
                            <label for="segape" style="color: #3d566e;">Direccion</label>
                            <div class="form-group">
                                <input type="text" value="" maxlength="255" placeholder="Ingrese la direccion" class="form-control" name="txtdireccion" id="txtdireccion" />
                            </div>
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-6" style="padding-left: 25px;">
                        <div id="prm" class="form-group" disabled>
                            <label for="segape" style="color: #3d566e;">Lider</label>
                            <div class="form-group">
                                @Html.DropDownList("dwlider", new SelectList(ViewBag.Lider, "cod_lider", "nom_lider", "-1"), new { @class = "selectpicker", @data_live_search = "true", @id = "dwlider", @name = "dwlider", @data_actions_box = "true", @data_selected_text_format = "count > 2" })                                
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<div class="row">
    <div class="col-md-7">
        <div class="box box-widget">
            <div class="box-header with-border">
                <div class="user-block">
                    <img class="img-circle" src="~/Content/images/camion.png" alt="User Image">
                    <span class="username" id="doc-nom-persona" style="color:#f88989">Información especifica de cliente</span>                  

                </div>
                <!-- /.user-block -->
                <div class="box-tools">
                    <button type="button" class="btn btn-box-tool" data-widget="collapse">
                        <i class="fa fa-minus"></i>
                    </button>
                </div>
                <!-- /.box-tools -->
            </div>
            <div class="box-body">

                <div class="row">
                    <div class="col-md-6" style="padding-left: 25px;">
                        <div id="prm" class="form-group" disabled>
                            <label for="segape" style="color: #3d566e;">Agencia</label>
                            <div class="form-group">
                                <input type="text" value="" maxlength="100" placeholder="Ingrese la agencia" class="form-control" name="txtagencia" id="txtagencia" />
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6" style="padding-left: 25px;">
                        <div id="prm" class="form-group" disabled>
                            <label for="segape" style="color: #3d566e;">Destino</label>
                            <div class="form-group">
                                <input type="text" value="" maxlength="200" placeholder="Ingrese el destino" class="form-control" name="txtdestino" id="txtdestino" />
                            </div>
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-6" style="padding-left: 25px;">
                        <div id="prm" class="form-group" disabled>
                            <label for="segape" style="color: #3d566e;">Agencia Ruc</label>
                            <div class="form-group">                             
                                <input id="txtagenciaruc" name="txtagenciaruc" type="number" min="0" step="1" maxlength="12" focus="true" placeholder="Ingrese la agencia del ruc" class="form-control" />
                            </div>
                        </div>
                    </div>                  
                </div>             
            </div>
        </div>
    </div>
</div>
<div class="row">
    <div class="col-md-7">
        <div class="box box-body box-footer">
            <div class="box-header with-border">             
                <div class="modal-footer" style="margin-top:-10px">                
                    <div class="col-md-12">
                        <button name="btnguardar" id="btnguardar" title="Guardar" onclick="GeneraCliente();" class="btn btn-success" type="submit"><span class="glyphicon glyphicon-ok-circle"></span>&nbsp;Guardar</button>
                        <button name="btncancelar" id="btncancelar" title="Cancelar" onclick="cancelar();" type="button" class="btn btn-danger">
                          <span class="glyphicon glyphicon-remove-circle">
                          </span>&nbsp;Cancelar
                        </button>
                    </div>
                 </div>                               
            </div>           
        </div>
    </div>  
</div>


@section scripts{


    <script src="~/Scripts/Linkend/linq.min.js"></script>    
    <script>
        function cancelar(){
            window.location = '@Url.Action("Index", "Clientes")';
        }

        $(document).ready(function () {
            ListarProv();
            ListarDis();

            var estado = @ViewBag.Estado;

            if (estado==1){
                $('#dwdep').val('15');
                $('#dwdep').selectpicker('refresh');
                ListarProv();
                $('#dwprov').val('01');
                $('#dwprov').selectpicker('refresh');
                ListarDis();
                $('#dwdis').val('1248');
                $('#dwdis').selectpicker('refresh');
                $('#dwtipocliente').focus();
            } else{

            }

        });

        function Listar_Prov_Distri() {
            ListarProv();
            ListarDis();
        }

        function ListarProv() {
            var dataArray = function () { return @Html.Raw(Json.Encode(ViewBag.DepProvDis)); }();
            // var dataArray = data.Data;
            var strTipo = $('#dwdep').val();


            var listar = [];

            if (strTipo != null) {

                if (strTipo == "-1") {
                    var lista_filter = (strTipo == "-1") ? dataArray.filter(obj => obj.dep_id != strTipo) : dataArray.filter(obj => obj.dep_id === strTipo || obj.dep_id == '0');
                    $.each(lista_filter, function (index, item) {

                        listar.push(item);
                    });
                } else {

                    var lista_filter = dataArray.filter(obj => obj.dep_id == '0');
                    $.each(lista_filter, function (index, item) {

                        listar.push(item);
                    });

                     var lista_filter = dataArray.filter(obj => obj.dep_id === strTipo);
                        $.each(lista_filter, function (index, item) {

                            listar.push(item);
                        });
                }
            }


            var group_prov = Enumerable.from(listar)
            .groupBy(
            null,
            null,
            "{ prv_cod: $.prv_cod, Prv_Descripcion: $.Prv_Descripcion}",
            "'' + $.prv_cod + '-' + $.Prv_Descripcion"
            ).orderBy("$.Prv_Descripcion").toArray();


            llenarComboProv("divProv", "dwprov", group_prov, '0', '', "ListarDis", '1');
        }
        function llenarComboProv(DivId, IdControl, Data, codDefecto, desDefecto, onchangeFuncion, tipo) {

            $('#' + IdControl).find('option').remove();



            var str = (tipo == '1') ? '<select class="selectpicker" data-live-search="true" onchangeFuncion data-width="100%" id="' + IdControl + '" name="' + IdControl + '" data-actions-box="true"  data-selected-text-format="count > 2" >' : '<select class="selectpicker"  data-live-search="true" onchangeFuncion data-width="100%" id="' + IdControl + '" name="' + IdControl + '"  data-actions-box="true"  data-selected-text-format="count > 2" > ';
            var ItemNormal = '<option value="codItem">desItem</option>';
            var colectItemNormal = '';

            //if (codDefecto != '') { str += '<option value="' + codDefecto + '" selected="selected">------' + desDefecto + '------</option>'; }

            if (onchangeFuncion != '') { onchangeFuncion = 'onchange = "' + onchangeFuncion + '()"' }
            str = str.replace("onchangeFuncion", onchangeFuncion);

            $.each(Data, function (index, item) {

                colectItemNormal = colectItemNormal + ItemNormal
                var strSelected = '"';

                if (item.cod_entid == codDefecto) {
                    strSelected = '" selected="selected" '

                }
                strSelected = '" selected="selected" '; // seleccionar todos al cargar
                colectItemNormal = colectItemNormal.replace("codItem", item.prv_cod + strSelected);
                colectItemNormal = colectItemNormal.replace("desItem", item.Prv_Descripcion);

            });

            str += colectItemNormal
            str += '</select>'

            document.getElementById(DivId).innerHTML = str

            $('.selectpicker').selectpicker({
                liveSearch: true,
                showSubtext: true
            });

        }

        function ListarDis()
        {
            var dataArray = function () { return @Html.Raw(Json.Encode(ViewBag.DepProvDis)); }();
            // var dataArray = data.Data;
            var strdep = $('#dwdep').val();
            var strprov = $('#dwprov').val();


            var listar = [];

            if (strdep != null && strprov != null) {

                if (strdep == "-1" || strprov == "-1") {
                    var lista_filter = (strTipo == "-1") ? dataArray.filter(obj => obj.prv_cod != strdep) : dataArray.filter(obj => obj.prv_cod === strdep || obj.prv_cod == '0');
                    $.each(lista_filter, function (index, item) {

                        listar.push(item);
                    });
                } else {

                    var lista_filter = dataArray.filter(obj => obj.prv_cod == '0');
                    $.each(lista_filter, function (index, item) {

                        listar.push(item);
                    });

                    //$.each(strCad, function (index3, item3) {

                        //$.each(strdep, function (index2, item2) {

                            var lista_filter = dataArray.filter(obj => obj.prv_cod === strprov && obj.dep_id === strdep);
                            $.each(lista_filter, function (index, item) {

                                listar.push(item);
                            });

                        //});
                    //});
                }
            }


            var group_distrito = Enumerable.from(listar)
            .groupBy(
            null,
            null,
            "{ Dis_Id: $.Dis_Id, Dis_Descripcion: $.Dis_Descripcion}",
            "'' + $.Dis_Id + '-' + $.Dis_Descripcion"
            ).orderBy("$.Dis_Descripcion").toArray();


            llenarComboDis("divDis", "dwdis", group_distrito, '0', '', "", '1');
        }
        function llenarComboDis(DivId, IdControl, Data, codDefecto, desDefecto, onchangeFuncion, tipo) {

            $('#' + IdControl).find('option').remove();



            var str = (tipo == '1') ? '<select class="selectpicker"   data-live-search="true" onchangeFuncion data-width="100%" id="' + IdControl + '" name="' + IdControl + '" data-actions-box="true"  data-selected-text-format="count > 2" >' : '<select class="selectpicker"  data-live-search="true" onchangeFuncion data-width="100%" id="' + IdControl + '" name="' + IdControl + '"  data-actions-box="true"  data-selected-text-format="count > 2" > ';
            var ItemNormal = '<option value="codItem">desItem</option>';
            var colectItemNormal = '';

            //if (codDefecto != '') { str += '<option value="' + codDefecto + '" selected="selected">------' + desDefecto + '------</option>'; }

            if (onchangeFuncion != '') { onchangeFuncion = 'onchange = "' + onchangeFuncion + '()"' }
            str = str.replace("onchangeFuncion", onchangeFuncion);

            $.each(Data, function (index, item) {

                colectItemNormal = colectItemNormal + ItemNormal
                var strSelected = '"';

                if (item.cod_entid == codDefecto) {
                    strSelected = '" selected="selected" '

                }
                strSelected = '" selected="selected" '; // seleccionar todos al cargar
                colectItemNormal = colectItemNormal.replace("codItem", item.Dis_Id + strSelected);
                colectItemNormal = colectItemNormal.replace("desItem", item.Dis_Descripcion);

            });

            str += colectItemNormal
            str += '</select>'

            document.getElementById(DivId).innerHTML = str

            $('.selectpicker').selectpicker({
                liveSearch: true,
                showSubtext: true
            });

        }

    </script>
    <script>

        $(function () {
            $("#datepickerfecnac").datepicker({
                autoclose: true,
                todayHighlight: true
            }).datepicker();
        });

        $(document).ready(function () {


        });

        function selecciona_tipo_cliente() {
            var strTipoCliente = $('#dwtipocliente').val().toString();

            if (strTipoCliente == '01' || strTipoCliente == '09') {
                $('#dwlider').val('0');
                $("#dwlider").prop("disabled", true);
                $('#dwlider').selectpicker('refresh');
            }
            else
            {
                $('#dwlider').val('0');
                $("#dwlider").prop("disabled", false);
                $('#dwlider').selectpicker('refresh');
            }
        }

        function GeneraCliente() {                                                      
            if (valida_grabar() == 1) return;
            var strDni = $('#txtdni').val().toString();
            var str_email = $('#txtemail').val().toString();

            waitingDialog.show("Espere por favor...")
            $.ajax({
                type: "POST",
                url: '@Url.Action("valida_cliente", "Clientes")',
                data: { dni: strDni, correo: str_email },
                success: function (data) {
                    waitingDialog.hide();
                    if (data.estado == 0) {
                        grabar_cliente();
                    }
                    else {
                        if (data.estado == '1') {
                            var cl_basico = document.getElementById("i_basico").className;
                            if (cl_basico == 'fa fa-plus') $('#btnbasico').click();
                            $('#txtdni').focus();
                        }
                        if (data.estado == '2') {
                            var cl_tipper = document.getElementById("i_tipper").className;
                            if (cl_tipper == 'fa fa-plus') $('#btntipper').click();
                            $('#txtemail').focus();
                        }
                        toastr.error(data.mensaje, "Alerta");
                    }
                },
                error: function (XMLHttpRequest, textStatus, errorThrown) {
                    toastr.error("Error al consultar.", "Alerta");
                }
            });
        }

        function grabar_cliente() {
            var estado = @ViewBag.Estado;
            var strDni = $('#txtdni').val().toString();
            var str_email = $('#txtemail').val().toString();
            var mensaje = "";
            var sexo=(document.getElementById('optfemenino').checked)?'F':'M';

            var dataArray = function () { return @Html.Raw(Json.Encode(ViewBag.cliente)); }();
            dataArray._Bas_Usu_TipId= $('#dwtipocliente').val().toString();;
            dataArray._Bas_Doc_Tip_Id= $('#dwtipodoc').val().toString();
            dataArray._Bas_Documento= $('#txtdni').val().toString();
            dataArray._Bas_Primer_Nombre= $('#txtprinom').val().toString();
            dataArray._Bas_Segundo_Nombre= $('#txtsegnom').val().toString();
            dataArray._Bas_Primer_Apellido= $('#txtpriapepat').val().toString();
            dataArray._Bas_Segundo_Apellido= $('#txtpriapemat').val().toString();
            dataArray._Bas_Fec_nac= $('#fechanac').val().toString();
            dataArray._Bas_Sex_Id=sexo;
            dataArray._Bas_Per_Tip_Id= $('#dwpertipo').val().toString();
            dataArray._Bas_Correo= $('#txtemail').val().toString();
            dataArray._Bas_Telefono= $('#txttelefono').val().toString();
            dataArray._Bas_Celular= $('#txtcelular').val().toString();
            dataArray._Bas_Dis_Id= $('#dwdis').val().toString();
            dataArray._Bas_Direccion= $('#txtdireccion').val().toString();
            dataArray._Bas_Are_Id= $('#dwlider').val().toString();
            dataArray._bas_agencia= $('#txtagencia').val().toString();
            dataArray._bas_destino= $('#txtdestino').val().toString();
            dataArray._bas_agencia_ruc= $('#txtagenciaruc').val().toString();

            switch(estado)
            {
                case 1:
                    mensaje = "¿Está seguro generar un nuevo cliente?"
                    break;
                case 2:
                    mensaje = "¿Está seguro guardar los datos modificados?"
                    break;
            }

            swal({
                title: "Guardar datos del cliente",
                text: mensaje,// "¿Está seguro de guardar el cruce?",
                icon: "warning",
                buttons: ["No", "Si"],
                dangerMode: true,
            }).then((cambiar) => {
                if (cambiar) {
                    waitingDialog.show("Espere un momento por favor.")
                    $.ajax({
                        type: "POST",
                        url: '@Url.Action("GuardarCliente", "Clientes")',
                        data: {dataArray:dataArray},
                        success: function (data) {
                            if (data.estado == 0) {
                               // toastr.success(data.mensaje);

                                if (estado=1){
                                    swal({
                                        title: "Ok",
                                        text: "Se Grabo con exito los datos.\nPara ingresar al sistema debe de ingresar.\n\nUsuario: " + str_email.toString()+
                                            "\nPassword: " + strDni.toString(),
                                        icon: "success"
                                    })
                                }
                                cancelar();
                                waitingDialog.hide();

                            } else {
                                toastr.error(data.mensaje);
                                waitingDialog.hide();
                            }
                        },
                        error: function (XMLHttpRequest, textStatus, errorThrown) {
                            waitingDialog.hide();
                            toastr.error("Error al consultar.", "Alerta");
                        }
                    });
                }
            });
        }

        function valida_grabar() {

            var cl_basico = document.getElementById("i_basico").className;

            var cl_tipper = document.getElementById("i_tipper").className;

            var cl_ubi = document.getElementById("i_ubi").className;


            var strTipoCliente = $('#dwtipocliente').val().toString();
            var strDni = $('#txtdni').val().toString();
            var strTipoDoc = $('#dwtipodoc').val().toString();

            var str_primnombre = $('#txtprinom').val().toString();

            var str_pertipo = $('#dwpertipo').val().toString();

            var str_email = $('#txtemail').val().toString();

            var str_telefono = $('#txttelefono').val().toString();

            var str_direccion = $('#txtdireccion').val().toString();

            var str_lider = $('#dwlider').val().toString();


            if (strTipoCliente == '0') {
                toastr.error("Ingrese el tipo de Cliente.", "Aviso");
                $('#dwtipocliente').focus();
                return 1;
            }
            if (strDni.length == 0) {
                if (cl_basico == 'fa fa-plus') $('#btnbasico').click();
                toastr.error("Ingrese el numero de Dni o Roc.", "Aviso");
                $('#txtdni').focus();
                return 1;
            }
            if (strDni.length != 8 && strDni.length != 11) {
                if (cl_basico == 'fa fa-plus') $('#btnbasico').click();
                toastr.error("Ingrese el numero de Dni o Ruc Valido", "Aviso");
                $('#txtdni').focus();
                return 1;
            }

            if (strDni.length == 11) {
                if (!valruc(strDni.toString())) {
                    if (cl_basico == 'fa fa-plus') $('#btnbasico').click();
                    toastr.error("El Numero de Ruc ingresado no es valido", "Aviso");
                    $('#txtdni').focus();
                    return 1;
                }
            }
            if ((strTipoDoc == '1' && strDni.length == 11) || (strTipoDoc == '2' && strDni.length == 8) || (strTipoDoc == '3' && strDni.length == 11)) {
                if (cl_basico == 'fa fa-plus') $('#btnbasico').click();
                toastr.error("El tipo de Documento no corresponde al documento ingresado", "Aviso");
                $('#dwtipodoc').focus();
                return 1;
            }
            if (str_primnombre.trim().trimLeft().trimRight().length == 0) {
                if (cl_basico == 'fa fa-plus') $('#btnbasico').click();
                toastr.error("Ingrese el Pimer nombre", "Aviso");
                $('#txtprinom').focus();
                return 1;
            }
            if (str_pertipo == '2') {
                if (strDni.length == 11) {

                    if (strDni.substring(0, 1).toString() != '2') {
                        if (cl_tipper == 'fa fa-plus') $('#btntipper').click();
                        toastr.error("El Tipo de persona no corresponde a ruc ingresado.", "Aviso");
                        $('#dwpertipo').focus();
                        return 1;
                    }
                }
                else
                {
                    if (cl_tipper == 'fa fa-plus') $('#btntipper').click();
                    toastr.error("El Tipo de persona no es valido para el documento ingresado.", "Aviso");
                    $('#dwpertipo').focus();
                    return 1;
                }
            }
            else
            {
                if (strDni.length == 11) {

                    if (strDni.substring(0, 1).toString() == '2') {
                        if (cl_tipper == 'fa fa-plus') $('#btntipper').click();
                        toastr.error("El Tipo de persona no corresponde a ruc ingresado.", "Aviso");
                        $('#dwpertipo').focus();
                        return 1;
                    }
                }
            }

            if (!validar_email(str_email)) {
                if (cl_tipper == 'fa fa-plus') $('#btntipper').click();
                toastr.error("El correo ingresado no es valido.", "Aviso");
                $('#txtemail').focus();
                return 1;
            }

            if (str_telefono.trim().trimLeft().trimRight().length == 0) {
                if (cl_tipper == 'fa fa-plus') $('#btntipper').click();
                toastr.error("Ingrese el numero de telefono.", "Aviso");
                $('#txttelefono').focus();
                return 1;
            }

            if (str_direccion.trim().trimLeft().trimRight().length == 0) {
                if (cl_ubi == 'fa fa-plus') $('#btnubi').click();
                toastr.error("Ingrese la direccion.", "Aviso");
                $('#txtdireccion').focus();
                return 1;
            }

            if (str_lider=='0' && strTipoCliente=='02'){
                if (cl_ubi == 'fa fa-plus') $('#btnubi').click();
                toastr.error("Selecione un lider para el promotor", "Aviso");
                $('#dwlider').focus();
                return 1;
            }

            return 0;
        }

        function validar_email(email) {
            //var expr = /^([\w-\.]+)@@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.)|(([\w-]+\.)+))([a-zA-Z]{2,4}|[0-9]{1,3})(\]?)$/;
            var regex = /^([a-zA-Z0-9_\.\-])+\@@(([a-zA-Z0-9\-])+\.)+([a-zA-Z0-9]{2,4})+$/;
            return regex.test(email) ? true : false;
        }

        function trim(cadena) {
            cadena2 = "";
            len = cadena.length;
            for (var i = 0; i <= len ; i++) if (cadena.charAt(i) != " ") { cadena2 += cadena.charAt(i); }
            return cadena2;
        }
        function esnulo(campo) { return (campo == null || campo == ""); }
        function esnumero(campo) { return (!(isNaN(campo))); }
        function eslongrucok(ruc) { return (ruc.length == 11); }
        function eslongdniok(dni) { return (dni.length == 8); }
        function esrucok(ruc) {
            return (!(esnulo(ruc) || !esnumero(ruc) || !eslongrucok(ruc) || !valruc(ruc)));
        }
        function esdniok(dni) {
            return (!(esnulo(dni) || !esnumero(dni) || !eslongdniok(dni)));
        }
        function valruc(valor) {
            valor = trim(valor);
            if (esnumero(valor)) {
                if (valor.length == 8) {
                    suma = 0;
                    for (i = 0; i < valor.length - 1; i++) {
                        digito = valor.charAt(i) - '0';
                        if (i == 0) suma += (digito * 2)
                        else suma += (digito * (valor.length - i))
                    }
                    resto = suma % 11;
                    if (resto == 1) resto = 11;
                    if (resto + (valor.charAt(valor.length - 1) - '0') == 11) {
                        return true;
                    }
                } else if (valor.length == 11) {
                    suma = 0;
                    x = 6;
                    for (i = 0; i < valor.length - 1; i++) {
                        if (i == 4) x = 8
                        digito = valor.charAt(i) - '0';
                        x--;
                        if (i == 0) suma += (digito * x)
                        else suma += (digito * x)
                    }
                    resto = suma % 11;
                    resto = 11 - resto;

                    if (resto >= 10) resto = resto - 10;
                    if (resto == valor.charAt(valor.length - 1) - '0') {
                        return true;
                    }
                }
            }
            return false;
        }


    </script>
}