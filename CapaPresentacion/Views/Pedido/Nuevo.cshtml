@using CapaEntidad.Promotor
@model Ent_Promotor
@{
    ViewBag.Title = "Pedido";
}

@*@Scripts.Render("~/bundles/bootstrap")*@
<style>
    #dwcliente {
        width: 200px;
    }

    .imgRedonda {
        width: 100px;
        height: 80px;
        border-radius: 15px;
    }

    #divImagen {
        width: 100%;
        height: 100%;
    }
     #listatallas {
        border-radius: 10px 10px 10px 10px;
        -moz-border-radius: 10px 10px 10px 10px;
        -webkit-border-radius: 10px 10px 10px 10px;
        border: 2px;
    }

    #lugar {
        border-radius: 10px 10px 10px 10px;
        -moz-border-radius: 10px 10px 10px 10px;
        -webkit-border-radius: 10px 10px 10px 10px;
        border: 2px;
    }
</style>
<link href="~/Content/plugins/iCheck/custom.css" rel="stylesheet" />

<link href="~/ContentSelect/bootstrap-select.css" rel="stylesheet" />
<div class="box box-body box-default" style="margin-top:0px;margin-bottom:0px;padding-top:5px;padding-bottom:5px;">
 @using (Ajax.BeginForm("listarStr_ArticuloTalla", new AjaxOptions { OnBegin = "MostrarArticulo();" }))
 {
    <div class="row" style="margin-top:5px;margin-left:5px;margin-right:5px;margin-bottom:0px;border-radius:5px;padding-top:0px;padding-bottom:0px;">

        <div id="DivHBasico"  class="modal-content">
            <div class="modal-header modal-header-danger" style="margin-top:0px;margin-bottom:0px;padding-top:2px;padding-bottom:2px;">
                <h5 class="modal-title" id="myModalLabel">
                    <table style="border-bottom:0px;font-size:14px;width:100%;">
                        <tr>
                            <td style="font-size:14px;width:90%;text-align:left;">Promotor y formas de pago</td>
                            <td style="font-size:14px;width:10%;text-align:right;">
                                <span id="bocu" onclick="ocultarDiv('DivBasico'); mostrarDivFast('bver'); ocultarDivFast('bocu')" class="glyphicon glyphicon-minus-sign"></span>
                                <span id="bver" style="display:none" onclick="mostrarDiv('DivBasico'); mostrarDivFast('bocu'); ocultarDivFast('bver')" class="glyphicon glyphicon-plus-sign"></span>
                            </td>
                        </tr>
                    </table>
                </h5>
            </div>
            <div id="DivBasico" class="modal-body">

                <div class="row" style="margin-top:0px;margin-left:10px;margin-right:10px;margin-bottom:0px;border-radius:5px;padding-top:10px;padding-bottom:10px;">

                    <div class="col-sm-3" style="margin-top:2px;margin-bottom:2px;">
                        <label  for="disponible">*Promotor</label>
                    </div>
                    <div id="divTipoDoc" class="col-sm-3" style="margin-top:2px;margin-bottom:2px;">
                        @Html.DropDownList("dwPromo", new SelectList(ViewBag.listPromotor, "codigo", "descripcion", "-1"), new { @class = "selectpicker", @data_live_search = "true", @id = "dwPromo", @onchange = "buscarPersonaPedido()", @placeholder = ".col-xs-1" })
                    </div>
                    <div class="col-sm-3" style="margin-top:2px;margin-bottom:2px;">
                        <label for="disponible">*Forma de Pago</label>
                    </div>
                    <div id="divTipoDoc" class="col-sm-3" style="margin-top:2px;margin-bottom:2px;">
                        @Html.DropDownList("dwFormaPagp", new SelectList(ViewBag.listFormapago, "codigo", "descripcion", "-1"), new { @class = "selectpicker", @data_live_search = "true", @id = "dwFormaPagp", @placeholder = ".col-xs-1" })
                    </div>
                    
                </div>

                <div class="row" style="margin-top:0px;margin-left:10px;margin-right:10px;margin-bottom:0px;border-radius:5px;padding-top:10px;padding-bottom:10px;">

                    <div class="col-sm-3" style="margin-top:2px;margin-bottom:2px;">
                        <label for="disponible">Estado</label>
                    </div>
                    <div class="col-sm-3" style="margin-top:2px;margin-bottom:2px;color:brown">
                        <label for="disponible">Nuevo</label>
                    </div>
                    <div class="col-sm-3" style="margin-top:2px;margin-bottom:2px;">
                        <label for="disponible">Premio por ganar</label>
                    </div>
                    <div class="col-sm-3" style="margin-top:2px;margin-bottom:2px;color:brown">
                        <label for="disponible">Premio generado</label>
                    </div>
                </div>

            </div>
            
        </div>

        <div class="row" style="margin-top:5px;margin-left:0px;margin-right:0px;margin-bottom:5px;background-color:#f4f4f4;border-radius:5px;padding-top:2px;padding-bottom:2px;">

            <div class="col-sm-3" style="margin-top:2px;margin-bottom:2px;">
                <label for="txtArticulo" >Articulo</label>
            </div>
            <div class="col-sm-3" style="margin-top:2px;margin-bottom:2px;">
                @*<table  style="width :100%;" ><tr><td  style="width :100%;" ><input id="txtArticulo" type="text" placeholder="Ingrese articulo" style="width :90%;" autofocus class="form-control" /><button type="submit" id="btnBuscar" name="btnConsultar" onclick="MostrarArticulo()" title="Buscar" class="btn btn-small btn-primary" data-modal="" data-toggle="modal"><i class="fa fa-search"></i></button></td></tr></table>*@
                <div class="input-group">
                    <input id="txtArticulo" type="text" focus="true" placeholder="Ingrese articulo" class="form-control" />
                    <div class="input-group-btn">
                        <button class="btn btn-primary" type="submit" id="btnBuscar" name="btnConsultar"  title="Buscar" >
                            <span class="glyphicon glyphicon-search"></span>
                        </button>
                    </div>
                </div>
              
            </div>           

        </div> 

        <div id="DivHBasico" class="modal-content">
            <div class="modal-header modal-header-danger" style="margin-top:0px;margin-bottom:0px;padding-top:2px;padding-bottom:2px;">
                <h5 class="modal-title" id="myModalLabel">
                    <table style="border-bottom:0px;font-size:14px;width:100%;">
                        <tr>
                            <td style="font-size:14px;width:90%;text-align:left;">Lista de Compra</td>
                            <td style="font-size:14px;width:10%;text-align:right;">
                                <span id="Locu" onclick="ocultarDiv('DivListCompra'); mostrarDivFast('Lver'); ocultarDivFast('Locu')" class="glyphicon glyphicon-minus-sign"></span>
                                <span id="Lver" style="display:none" onclick="mostrarDiv('DivListCompra'); mostrarDivFast('Locu'); ocultarDivFast('Lver')" class="glyphicon glyphicon-plus-sign"></span>
                            </td>
                        </tr>
                    </table>
                </h5>
            </div>
            <div id="DivListCompra" class="modal-body" style="padding:0">
                <div class="row" style="margin-top:0px;margin-left:10px;margin-right:10px;margin-bottom:0px;border-radius:5px;padding-top:10px;padding-bottom:10px;">
                    <div id="divDetalleVenta" style="overflow-x: auto; overflow-y:hidden; width:100%"> @*height: 378px;*@
                        <table  style="width:100%;">
                            <thead>
                                <tr>
                                    <th>
                                        <div class="col-sm-1" style="margin-top:2px;margin-bottom:2px;">
                                            <label for="disponible">Referencia</label>
                                        </div>
                                    </th>
                                    <th>
                                        <div class="col-sm-1" style="margin-top:2px;margin-bottom:2px;">
                                            <label for="disponible">Articulo</label>
                                        </div>
                                    </th>
                                    <th>
                                        <div class="col-sm-1" style="margin-top:2px;margin-bottom:2px;">
                                            <label for="disponible">Marca</label>
                                        </div>
                                    </th>
                                    <th>
                                        <div class="col-sm-1" style="margin-top:2px;margin-bottom:2px;">
                                            <label for="disponible">Color</label>
                                        </div>
                                    </th>
                                    <th>
                                        <div class="col-sm-1" style="margin-top:2px;margin-bottom:2px;">
                                            <label for="disponible">Talla</label>
                                        </div>
                                    </th>
                                    <th>
                                        <div class="col-sm-1" style="margin-top:2px;margin-bottom:2px;">
                                            <label for="disponible">Cantidad</label>
                                        </div>
                                    </th>
                                    <th>
                                        <div class="col-sm-1" style="margin-top:2px;margin-bottom:2px;">
                                            <label for="disponible">Precio</label>
                                        </div>
                                    </th>
                                    <th>
                                        <div class="col-sm-1" style="margin-top:2px;margin-bottom:2px;">
                                            <label for="disponible">Comision</label>
                                        </div>
                                    </th>
                                    <th>
                                        <div class="col-sm-1" style="margin-top:2px;margin-bottom:2px;">
                                            <label for="disponible">Descuento</label>
                                        </div>
                                    </th>
                                    <th>
                                        <div class="col-sm-1" style="margin-top:2px;margin-bottom:2px;">
                                            <label for="disponible">Total</label>
                                        </div>
                                    </th>
                                </tr>
                            </thead>

                        </table>
                    </div> 
                </div>            

            </div>

        </div>
    </div>  
 }



</div>
<div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" ng-app>
    <div class="modal-dialog">
        <div class="modal-content">
            <div id='myModalContent'></div>
        </div>
    </div>
</div>
<script src="~/Scripts/bootstrap.min.js"></script>
<script src="~/ScriptsSelect/bootstrap-select.js"></script>
<script src="~/Scripts/BI.js"></script>
<script src="~/Scripts/Plugins/iCheck/icheck.min.js"></script>

<script>
    var gTipoDoc = '';
    var gTipoPer = '';
    var listArticulos = [];
    var gArtBusqueda
    var glistTalla = [];
    var gStyleMovile = ''
    var gbMovile = false;
    var gCustomer = {
        comision: 0.00,
        idCust: 0,
        commission_POS_visaUnica: 0.00,
        percepcion: 0.00,
        email: "",
        nombrecompleto: "",
        premio: "",
        aplica_percepcion: "0"
    }

    $(document).ready(function () {
        
        if (/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)) {
            gStyleMovile = 'style="display:none"';
            gbMovile = true;
        }

        buscarPersonaPedido();
        document.getElementById("txtArticulo").focus();
        DibujarGrilla();

    });

    function buscarPersonaPedido() {

        waitingDialog.show('Espere un momento por favor');
        var ControllerUrl = "@Url.Action("PersonaPedido", "Pedido")";
        var promotor = $('#dwPromo').val();
        //alert(promotor)
        $.ajax({
            type: "GET",
            url: ControllerUrl,
            contentType: "application/json; charset=utf-8",
            data: { basId: promotor },
            datatype: "json",
            cache: true,
            success: function (data) {
                waitingDialog.hide();
                var codTienda = ''
                var consTienda = ''

                if (data != '' && data != '[]') {
        
                    gCustomer.comision = data.comision;
                    gCustomer.idCust = data.idCust;
                    gCustomer.commission_POS_visaUnica = data.commission_POS_visaUnica;
                    gCustomer.percepcion = data.percepcion;
                    gCustomer.email = data.email;
                    gCustomer.nombrecompleto = data.nombrecompleto;
                    gCustomer.premio = data.premio;
                    gCustomer.aplica_percepcion = data.aplica_percepcion;                  
                
                }

            },
            error: function () {
                waitingDialog.hide();
                alert('Error')
            }

        });
        waitingDialog.hide();
    }

    function QuitarEspacios(valor) {

        valor = valor.replace(/^\s+|\s+$/g, "");

        return valor;
    }

    function MostrarArticulo() {
  
        var codArticulo = $('#txtArticulo').val();
        codArticulo = codArticulo.replace(/^\s+|\s+$/g, "");
        if (codArticulo != "") {
            DibujarMostrarArticulo(codArticulo);
        } else {
            toastr.error("Debe ingresar un codigo.", "Aviso");
        }

        //return true
        
    }

    function EditarDetalle(control) {
        var codArticulo = $(control).attr('data-id');
        DibujarMostrarArticulo(codArticulo);

    }


    function DibujarMostrarArticulo(codArticulo) {

        waitingDialog.show('Espere un momento por favor');

        var bExiste = VerificarExistencia(codArticulo);

        var ControllerUrl = "@Url.Action("listarStr_ArticuloTalla", "Pedido")";
        var css = 'class="row"'
        var border2 = 'padding: 5px 5px 5px 5px;border:2px'
        var espacio = '&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'
        var ConstTalla =  '<td><div style="margin-top:2px;margin-right:2px;"><button class="btn btn-white btn-xs" style="width:100%;">variableTalla</button></div></td>'
        var BotonSuma = '<button title="Sumar Cantidad" class="btnSuma btn btn-success" onclick="sumarCantidad(this)" data-id="IdArticuloTallaS" data-modal="Sstock" data-toggle="modal"><span class="glyphicon glyphicon-plus"></span></button>'
        var BotonResta = '<button title="Restar Cantidad" class="btnResta btn btn-danger" onclick="restarCantidad(this)" data-id="IdArticuloTallaR" data-modal="Rstock" data-toggle="modal"><span class="glyphicon glyphicon-minus"></span></button>'
        var InputCantidadTalla = '<input id="inpArtTalla" type="Text"  name="Talla" value="valor" placeholder="cantidad" onchange = "validarStock(this)" data-id="inpStock" style="width:100%;" autofocus="" class="form-control"/>'
        var ConstHtmlTienda = '<br/><div id="lugar" style="background:#FFFFFF;' + border2 + '" ><div ' + css + '  style="background:#FFFFFF;" ><div class="col-sm-12"><div><h4><strong>VariableTienda</strong></h4><p>&nbsp;DireccionTienda</p></div><table><tr><td><div style="margin-top:2px;">' + BotonResta + '</div></td><td style="width:100px"><div style="margin-top:2px;">' + InputCantidadTalla + '</div></td><td><div style="margin-top:2px;">' + BotonSuma + '</div></td></tr></table></div><br/></div></div>';
        var ConstCantidad = ''
        var listTalla = '';
        var listCantidad = '';
        var divFinal = '';
        var strUrlImagen = '';
        var options = { "backdrop": "static", keyboard: true };

        $.ajax({
            type: "GET",
            url: ControllerUrl,
            contentType: "application/json; charset=utf-8",
            data: { codArticulo: codArticulo },
            datatype: "json",
            cache: true,
            success: function (data) {

                var codTienda = ''
                var consTienda = ''

                if (data != '' && data != '[]') {
                    var valors = JSON.parse(data);
                        gArtBusqueda = valors;
                    var nombreTienda = '';
                    var urlImagenSusti = '';
                    var DireccionTienda = '';
                    var CodTalla = '';
                    var cantidad = '';

                    var NombreArticulo = '';
                    var MarcaArticulo = '';
                    var ColorArticulo = '';
                    var CategoriArticulo = '';
                    var PrecioSinIgv = '';
                    var stock = '';

                    $.each(valors, function (index, item) {

                        strUrlImagen = item.Art_Foto
                        NombreArticulo = item.Art_Descripcion
                        MarcaArticulo = item.Mar_Descripcion
                        ColorArticulo = item.Col_Descripcion
                        PrecioSinIgv = item.Art_Pre_Sin_Igv
                        CategoriArticulo = item.Cat_Pri_Descripcion + ' > ' + item.Cat_Descripcion
                        CodTalla = item.Tal_Descripcion
                        codTienda = item.Tall_Des;
                        nombreTienda = '<i class="fa fa-check-circle"></i>&nbsp;Talla:&nbsp;&nbsp;' + item.Tall_Des
                        DireccionTienda = '<i class="fa fa-info-circle"></i>&nbsp;Stock:&nbsp;&nbsp;' + item.Tall_Cant
                        stock = item.Tall_Cant;

                        var strhtml = ConstHtmlTienda;

                        strhtml = strhtml.replace("VariableTienda", nombreTienda);
                        strhtml = strhtml.replace("DireccionTienda", DireccionTienda);
                        strhtml = strhtml.replace("IdArticuloTallaS", CodTalla);
                        strhtml = strhtml.replace("IdArticuloTallaR", CodTalla);
                        strhtml = strhtml.replace("Rstock", stock);
                        strhtml = strhtml.replace("Sstock", stock);
                        strhtml = strhtml.replace("inpStock", stock);

                        var strValor = ((bExiste) ? (VerificarArticuloTalla(CodTalla)) : '');

                        strhtml = strhtml.replace("valor", strValor);
                        strhtml = strhtml.replace("inpArtTalla", "inpt_" + CodTalla);
                        divFinal += strhtml;

                    });

                    var strhtml = ''
                    var pOcu = "ocultarDivFast('tdImagen');mostrarDivFast('bverP'); ocultarDivFast('bocuP')"
                    var pVer = "mostrarDivFast('tdImagen');ocultarDivFast('bverP'); mostrarDivFast('bocuP')"

                    strhtml += '<div class="modal-header modal-header-danger" style="margin-top:0px;margin-bottom:0px;padding-top:2px;padding-bottom:2px;">'
                    strhtml += '<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>'
                    strhtml += '<h5 class="modal-title" id="myModalLabel">'
                    strhtml += '<table style="border-bottom:0px;font-size:14px;width:100%;">'
                    strhtml += '<tr>'
                    strhtml += '<td style="font-size:14px;width:5%;text-align:left;">'
                    strhtml += '<span id="bocuP" onclick ="' + pOcu + '"  class="glyphicon glyphicon-eye-close"></span>'
                    strhtml += '<span id="bverP" onclick ="' + pVer + '" style="display:none" class="glyphicon glyphicon-picture"></span>'
                    strhtml += '</td>'
                    strhtml += '<td style="font-size:14px;width:90%;text-align:left;">Articulo:&nbsp;&nbsp;' + codArticulo + '&nbsp;&nbsp;-&nbsp;&nbsp;Precio:&nbsp;&nbsp;S/&nbsp;&nbsp;' + PrecioSinIgv + '</td>'
                    strhtml += '</tr>'
                    strhtml += '</table>'
                    strhtml += '</h5>'
                    strhtml += '</div>'
                    strhtml += '<div class="modal-body">'
                    strhtml += '<table id="example" class="table table-hover dataTable  table-striped table-responsive">'
                    strhtml += '<tbody>'
                    strhtml += '<tr>'
                    strhtml += '<td Id="tdImagen"style="background:#FFFFFF;width:30%;vertical-align:middle;border: 1px solid;border-color:gainsboro">'
                    strhtml += '<div Id="DivgImagen">'
                    strhtml += '<div id="DivNombre" style="text-align:center;"><h5><b>' + NombreArticulo + '</b></h5></div><br/>'
                    strhtml += '<div id="DivImagen" style="text-align:center;">'
                    strhtml += '<img id="imagenCatalogo" class="imgRedonda" src="' + strUrlImagen + '" width="100%" height="100%" />'
                    strhtml += '</div><br/>'
                    strhtml += '<div id="DivPrecio" style="text-align:left"><table style="width:100%" ><tr><td style="width:50%" ><div style="width:100%" ><h5><b>Precio:&nbsp;&nbsp;</b></h5></div></td><td><div style="width:100%;color:#FF0000"><h5><b>S/&nbsp;&nbsp;' + PrecioSinIgv + '</b></h5></div></td></tr></table></div>'
                    strhtml += '<div id="DivMarca" style="text-align:left"><h5><b>Marca:&nbsp;&nbsp;</b>' + MarcaArticulo + '</h5></div>'
                    strhtml += '<div id="DivColor" style="text-align:left"><h5><b>Color:&nbsp;&nbsp;</b>' + ColorArticulo + '</h5></div>'
                    strhtml += '<div id="DivCateg" style="text-align:left"><h5><b>Categorización:</b></h5></div>'

                    strhtml += '<div id="DivHCodArt"  style="display:none;">' + codArticulo + '</div>'
                    strhtml += '<div id="DivHDesArt"  style="display:none;">' + NombreArticulo + '</div>'
                    strhtml += '<div id="DivHMarArt"  style="display:none;">' + MarcaArticulo + '</div>'
                    strhtml += '<div id="DivHColArt"  style="display:none;">' + ColorArticulo + '</div>'
                    strhtml += '<div id="DivHPrecioArt"  style="display:none;">' + PrecioSinIgv + '</div>'
                    strhtml += '<div id="DivHImagenArt"  style="display:none;">' + strUrlImagen + '</div>'

                    strhtml += '</div>'
                    strhtml += '</td>'
                    strhtml += '<td>'
                    strhtml += '<div id="listTalla" style="overflow-x: hidden; overflow-y:auto; height: 378px;">'
                    strhtml += divFinal
                    strhtml += '</div>'
                    strhtml += '</td>'
                    strhtml += '</tr>'
                    strhtml += '</tbody>'
                    strhtml += '</table>'
                    strhtml += '</div>'
                    strhtml += '<div class="modal-footer" style="margin-top:-30px">'
                    strhtml += '<button type="button" class="btn btn-default" data-dismiss="modal">Cerrar</button>'
                    strhtml += '<input type="submit" class="btn btn-primary" onclick="agregarLista()"  id="btnSubmit" value="Agregar" />'
                    strhtml += '</div>'


                    $('#myModalContent').html(strhtml);
                    $('#myModal').modal(options);
                    $('#myModal').modal('show');
                    waitingDialog.hide();



                } else {
                    toastr.error("Stock por ingresar.", "Aviso");
                }
                waitingDialog.hide();

            },
            error: function () {
                waitingDialog.hide();
                alert('Error')
            }

        });

        waitingDialog.hide();
    }   

    function sumarCantidad(control) {

        var Cod = control.getAttribute('data-id');
        var stock = parseInt(control.getAttribute('data-modal'));
        var cInput = 'inpt_' + Cod;
        var valor = $('#' + cInput).val();
        var valorInt = 0;
        var msjAlert = "";
        valorInt = ((BorrarEspacio(valor) == '') ? (msjAlert += 'Fecha Nacimiento.<br/>', 1) : parseInt(valor) + 1);
        valorInt = ((valorInt >= stock) ? (stock) : valorInt);

        $('#' + cInput).val(valorInt);
    }

    function sumarCantidadMovil(control) {

        var Cod = control.getAttribute('data-id');
        var stock = parseInt(control.getAttribute('data-modal'));
        var cInput = 'inpt_' + Cod;
        var valor = $('#' + cInput).val();
        var valorInt = 0;
        var msjAlert = "";
        valorInt = ((BorrarEspacio(valor) == '') ? (msjAlert += 'Fecha Nacimiento.<br/>', 1) : parseInt(valor) + 1);
        valorInt = ((valorInt >= stock) ? (stock) : valorInt);

        $('#' + cInput).val(valorInt);
    }

    function agregarLista() {
                
        var codigoArt = document.getElementById('DivHCodArt').innerHTML;
            EliminarArticuloList(codigoArt);//elimnamos el codigo de la lista para agregarlo nuevamente 
        var DescriArt = document.getElementById('DivHDesArt').innerHTML;
        var MarcaArt = document.getElementById('DivHMarArt').innerHTML;
        var ColorArt = document.getElementById('DivHColArt').innerHTML;
        var PrecioArt = document.getElementById('DivHPrecioArt').innerHTML;
        var strUrlImagen = '';
        var LinecantTotal = 0;
        var listTallasCantidad = []; //lista de las tallas escogidas

        var glineArticulo = {
            codigoArt: codigoArt,
            DescriArt: DescriArt,
            MarcaArt: MarcaArt,
            ColorArt: ColorArt,
            PrecioArt: PrecioArt,
            listTallas: [],
            Comission: 0.00,
            Descuento: 0.00,
            Total: 0.00,
            CantidadTotal: 0,
            strUrlImagen: ""
        }            

        $.each(gArtBusqueda, function (index, item) {
            strUrlImagen = item.Art_Foto;
        });        
   
        $('input[name="Talla"]').each(function () {

            var valor = QuitarEspacios($(this).val());
            var CantTalla = ((valor == '') ? 0 : parseInt(valor));

            if (CantTalla > 0) {

                LinecantTotal += CantTalla;
                var codTalla = $(this).attr("id").substr(5);
                var oTalla = { codTalla: codTalla, CantTalla: CantTalla }
                listTallasCantidad.push(oTalla);

            }
        });

        if (LinecantTotal > 0) {

            var porcComision = gCustomer.comision / 100;
            //Comission = Math.round10((((PrecioArt * LinecantTotal)) * porcComision) * 1, -2);
            var Comission = (((PrecioArt * LinecantTotal)) * porcComision) * 1;
            var desc = glineArticulo.Descuento
            var comiss = Math.round(Comission * 100) / 100;
            var Total = Math.round(((PrecioArt * LinecantTotal) - comiss - desc) * 100) / 100;

            //console.log(PrecioArt)
            //console.log(LinecantTotal)
            //console.log(porcComision)            

            glineArticulo.Comission = comiss;
            glineArticulo.listTallas = listTallasCantidad;
            glineArticulo.Total = Total;
            glineArticulo.Comission = comiss;
            glineArticulo.CantidadTotal = LinecantTotal;
            glineArticulo.strUrlImagen = strUrlImagen;
            listArticulos.push(glineArticulo);

            toastr.success("Se agrego el Articulo a la venta.", 'Mensaje');

            DibujarGrilla();
        }
    }

    function EliminarArticuloList(codigoArticulo) {

        for (var i = 0; i < listArticulos.length; i++) {

            if (codigoArticulo == listArticulos[i].codigoArt) {
                listArticulos.splice(i, 1);
            }
        }
    }

    function VerificarExistencia(codigoArticulo) {

        var bexiste = false;

        for (var i = 0; i < listArticulos.length; i++) {

            if (codigoArticulo == listArticulos[i].codigoArt) {
                bexiste = true;
                glistTalla = listArticulos[i].listTallas;

            }
        }

        return bexiste;
    }

    function VerificarExistenciabk(codigoArticulo) {


        for (var i = 0; i < listArticulos.length; i++) {

            if (codigoArticulo == listArticulos[i].codigoArt) {

                var listTallasCantidad2 = listArticulos[i].listTallas;

                for (var j = 0; j < listTallasCantidad2.length; j++) {

                    var CodTalla = listTallasCantidad2[j].codTalla;
                    var Cantidad = listTallasCantidad2[j].CantTalla;
                    var numero = 0;
                    numero=3
                    //alert('inpt_' + CodTalla)
                    //$('inpt_' + CodTalla).val(Cantidad);
                    //$('#' + cInput).val(valorInt);
                    $('#inpt_06').val(numero)
                    alert($('#inpt_06').val())

                }
            }
        }

    }

    function VerificarArticuloTalla(codTalla) {

        var valor = '';

        for (var j = 0; j < glistTalla.length; j++) {

            var CodTalla = glistTalla[j].codTalla;
            if (codTalla == CodTalla) { valor = glistTalla[j].CantTalla; };
        }

        return valor;
    }

    function DibujarGrilla() {
  
        if (gbMovile) {

            GrillaMovil();

        } else {

            GrillaComputador();
        }
    }

    function GrillaComputador() {

        var strtable='';
        var theader='';
        var tbody='';
        theader +='<thead>';
        theader += '<tr>';
        theader += '<th>';
        theader += '<div class="col-sm-1" style="margin-top:2px;margin-bottom:2px;">';
        theader += '<label for="disponible"></label>';
        theader += '</div>';
        theader += '</th>';
        theader +='<th>';
        theader +='<div class="col-sm-1" style="margin-top:2px;margin-bottom:2px;">';
        theader +='<label for="disponible">Referencia</label>';
        theader +='</div>';
        theader +='</th>';
        theader +='<th '+gStyleMovile+'>';
        theader +='<div class="col-sm-1" style="margin-top:2px;margin-bottom:2px;">';
        theader +='<label for="disponible">Articulo</label>';
        theader +='</div>';
        theader +='</th>';
        theader += '<th ' + gStyleMovile + '>';
        theader +='<div class="col-sm-1" style="margin-top:2px;margin-bottom:2px;">';
        theader +='<label for="disponible">Marca</label>';
        theader +='</div>';
        theader +='</th>';
        theader += '<th ' + gStyleMovile + '>';
        theader +='<div class="col-sm-1" style="margin-top:2px;margin-bottom:2px;">';
        theader +='<label for="disponible">Color</label>';
        theader +='</div>';
        theader +='</th>';
        theader +='<th>';
        theader += '<div class="col-sm-1" style="width:100%;text-align:center;margin-top:2px;margin-bottom:2px;Text">';
        theader += '<label for="disponible">Talla/Cantidad</label>';
        theader +='</div>';
        theader +='</th>';
        theader += '<th ' + gStyleMovile + '>';
        theader +='<div class="col-sm-1" style="margin-top:2px;margin-bottom:2px;">';
        theader +=' <label for="disponible">Precio</label>';
        theader +='</div>';
        theader +='</th>';
        theader += '<th ' + gStyleMovile + '>';
        theader +='<div class="col-sm-1" style="margin-top:2px;margin-bottom:2px;">';
        theader +=' <label for="disponible">Comision</label>';
        theader +='</div>';
        theader +='</th>';
        theader += '<th ' + gStyleMovile + '>';
        theader +='<div class="col-sm-1" style="margin-top:2px;margin-bottom:2px;">';
        theader +='<label for="disponible">Descuento</label>';
        theader +='</div>';
        theader +='</th>';
        theader +='<th>';
        theader +='<div class="col-sm-1" style="margin-top:2px;margin-bottom:2px;">';
        theader +='<label for="disponible">Total</label>';
        theader +='</div>';
        theader += '</th>';
        theader += '<th>';
        theader += '<div class="col-sm-1" style="margin-top:2px;margin-bottom:2px;">';
        theader += '<label for="disponible"></label>';
        theader += '</div>';
        theader += '</th>';
        theader += '<th>';
        theader += '<div class="col-sm-1" style="margin-top:2px;margin-bottom:2px;">';
        theader += '<label for="disponible"></label>';
        theader += '</div>';
        theader += '</th>';
        theader +='</tr>';
        theader += '</thead>';
        
        tbody += '<td>';
        tbody += '<div class="col-sm-1" style="width:100%;margin-top:2px;margin-bottom:2px;">';
        tbody += ' <button title="Ver detalle" style="border-radius:50%" onclick="EditarDetalle(this)" class="btnEditar btn-xs btn-success" data-id="valorEdit" data-modal="" data-toggle="modal"><span class="glyphicon glyphicon-edit"></span></button>';
        tbody += '</div>';
        tbody += '</td>';      
        tbody += '<td>';
        tbody += '<div class="col-sm-1" style="width:100%;margin-top:2px;margin-bottom:2px;">';
        tbody += 'Referencia';
        tbody += '</div>';
        tbody += '</td>';
        tbody += '<td ' + gStyleMovile + '>';
        tbody += '<div class="col-sm-1" style="width:100%;margin-top:2px;margin-bottom:2px;">';
        tbody += 'Articulo';
        tbody += '</div>';
        tbody += '</td>';
        tbody += '<td ' + gStyleMovile + '>';
        tbody += '<div class="col-sm-1" style="width:100%;margin-top:2px;margin-bottom:2px;">';
        tbody += 'Marca';
        tbody += '</div>';
        tbody += '</td>';
        tbody += '<td ' + gStyleMovile + '>';
        tbody += '<div class="col-sm-1" style="width:100%;margin-top:2px;margin-bottom:2px;">';
        tbody += 'Color';
        tbody += '</div>';
        tbody += '</td>';
        tbody += '<td>';
        tbody += '<div class="col-sm-1" style="width:100%;margin-top:2px;margin-bottom:2px;text-align:center;">';
        tbody += '<table><tr><td><div style="margin-top:2px;margin-right:2px;"><button class="btn btn-white btn-xs"  title="Tallas"  style="width:100%;">T:</button></div></td><td><div style="margin-top:2px;margin-right:2px;"><button class="btn btn-success btn-xs" style="width:100%;">Total</button></div></td>ListvariableTalla</tr><tr><td><div style="margin-top:2px;margin-right:2px;"><button  title="Cantidad"  class="btn btn-white btn-xs" style="width:100%;">C:</button></div></td></td><td><div style="margin-top:2px;margin-right:2px;"><button class="btn btn-success btn-xs" style="width:100%;">VTotal</button></div></td>ListvariableCantidad</tr></table>'
        tbody += '</div>';
        tbody += '</td>';
        tbody += '<td ' + gStyleMovile + '>';
        tbody += '<div class="col-sm-1" style="width:100%;margin-top:2px;margin-bottom:2px;">';
        tbody += 'Precio';
        tbody += '</div>';
        tbody += '</td>';
        tbody += '<td ' + gStyleMovile + '>';
        tbody += '<div class="col-sm-1" style="width:100%;margin-top:2px;margin-bottom:2px;">';
        tbody += 'Comision';
        tbody += '</div>';
        tbody += '</td>';
        tbody += '<td ' + gStyleMovile + '>';
        tbody += '<div class="col-sm-1" style="width:100%;margin-top:2px;margin-bottom:2px;">';
        tbody += 'Descuento';
        tbody += '</div>';
        tbody += '</td>';
        tbody += '<td>';
        tbody += '<div class="col-sm-1" style="width:100%;margin-top:2px;margin-bottom:2px;">';
        tbody += 'TotalM';
        tbody += '</div>';
        tbody += '</td>';
        tbody += '<td>';
        tbody += '<div class="col-sm-1" style="width:100%;margin-top:2px;margin-bottom:2px;">';
        tbody += ' <button title="Ver detalle" style="border-radius:50%" onclick="verDetalle(this)" class="btnEditar btn-xs btn-primary" data-id="valorBoton" data-modal="" data-toggle="modal"><span class="glyphicon glyphicon-info-sign blue"></span></button>';
        tbody += '</div>';
        tbody += '</td>';
        tbody += '<td>';
        tbody += '<div class="col-sm-1" style="width:100%;margin-top:2px;margin-bottom:2px;">';
        tbody += ' <button title="Eliminar detalle" style="border-radius:50%" onclick="PopupEliminar(this)" class="btnEliminar btn-xs btn-danger" data-id="valorDelete" data-modal="" data-toggle="modal"><span class="glyphicon glyphicon-remove" "></span></button>';
        tbody += '</div>';
        tbody += '</td>';
        tbody += '</tr>';

        var Body = '';

        var ConstTalla = '<td><div style="margin-top:2px;margin-right:2px;"><button class="btn btn-primary btn-xs"  style="width:100%;" title="Talla"  data-id="codTienda" data-tda="desTiendaS" data-modal="codTalla" data-art="codArticulo"  >variableTalla</button></div></td>'
        var ConstCantidad = '<td><div style="margin-top:2px;margin-right:2px;"><button class="btn btn-info btn-xs" style="width:100%;text-align:center;">variableCantidad</button></div></td>'
        var listTalla = '';
        var listCantidad = '';

        for (var i = 0; i < listArticulos.length; i++) {
            var temrBody = tbody
            temrBody = temrBody.replace("Referencia", listArticulos[i].codigoArt);
            temrBody = temrBody.replace("Articulo", listArticulos[i].DescriArt); 
            temrBody = temrBody.replace("valorBoton", listArticulos[i].codigoArt); 
            temrBody = temrBody.replace("valorEdit", listArticulos[i].codigoArt); 
            temrBody = temrBody.replace("valorDelete", listArticulos[i].codigoArt);
            temrBody = temrBody.replace("Marca", listArticulos[i].MarcaArt);
            temrBody = temrBody.replace("Color", listArticulos[i].ColorArt);
            temrBody = temrBody.replace("Precio", listArticulos[i].PrecioArt);
            temrBody = temrBody.replace("Comision", listArticulos[i].Comission);
            temrBody = temrBody.replace("Descuento", listArticulos[i].Descuento);

            temrBody = temrBody.replace("TotalM", listArticulos[i].Total);

            var listTallasCantidad2 = listArticulos[i].listTallas;
            listTalla = '';
            listCantidad = '';
            var total = 0;
            for (var j = 0; j < listTallasCantidad2.length; j++) {

                var talla = listTallasCantidad2[j].codTalla;
                var cantidad = listTallasCantidad2[j].CantTalla;
                total += parseInt(cantidad);

                listTalla += ConstTalla;
                listCantidad += ConstCantidad;

                listTalla = listTalla.replace("variableTalla", talla);
                listCantidad = listCantidad.replace("variableCantidad", cantidad);

            }

            temrBody = temrBody.replace("VTotal", total);
            temrBody = temrBody.replace("ListvariableTalla", listTalla);
            temrBody = temrBody.replace("ListvariableCantidad", listCantidad);

            Body += temrBody;
        }

        //for (var i = 0; i < listArticulos.length; i++) {

        //    var listTallasCantidad2 = listArticulos[i].listTallas;

        //    for (var j = 0; j < listTallasCantidad2.length; j++) {
        //        alert(listTallasCantidad2[j].codTalla)
        //        alert(listTallasCantidad2[j].CantTalla)
        //    }
        //}

        strtable = '<table style="width:100%;">' + theader + '<tbody>' + Body + '</tbody>' + '</table>';

        document.getElementById("divDetalleVenta").innerHTML = strtable;
    }


    function GrillaMovil() {

        var border2 = 'border:2px';
        var espacio = '&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;';
        var strImg = '<td Id="tdImagen"style="background:#FFFFFF;width:20%;vertical-align:middle;">'
        strImg += '<div Id="DivgImagen">'
        strImg += '<div id="DivImagen" style="text-align:center;">'
        strImg += '<img id="imagenCatalogo" class="imgRedonda" src="DireccionImagen" width="100%" height="100%" />'
        strImg += '</div>'
        strImg += '</div>'
        strImg += '</td>'
        var css = 'class="row"';
        var ConstTalla = '<td><div style="margin-top:2px;margin-right:2px;"><button class="btn btn-white btn-xs" style="width:100%;">variableTalla</button></div></td>'
        var BotonSuma = '<button title="Sumar Cantidad" class="btnSuma btn btn-white btn-xs" onclick="sumarCantidadMovil(this)" data-id="IdArticuloTallaS"  data-art="IdArticuloCodS" data-modal="Sstock" data-toggle="modal"><span class="glyphicon glyphicon-plus"></span></button>'
        var BotonResta = '<button title="Restar Cantidad" class="btnResta btn btn-white btn-xs" onclick="restarCantidadMovil(this)" data-id="IdArticuloTallaR" data-art="IdArticuloCodR" data-modal="Rstock" data-toggle="modal"><span class="glyphicon glyphicon-minus"></span></button>'
        var InputCantidadTalla = '<input id="inpArtTalla" type="Text"  name="Talla" value="valorInp" placeholder="cantidad" onchange = "validarStock(this)" data-id="inpStock" style="width:100%;" autofocus="" class="form-control"/>'
        var ConstHtmlDetalleTallas = '<br/><div id="listatallas" style="background:#FFFFFF;' + border2 + '" ><div ' + css + '  style="background:#FFFFFF;" ><div class="col-sm-12"><i class="fa fa-info-circle"></i>&nbsp;<b>Tallas y Cantidades</b><br/></div><div class="col-sm-12">ListaTallas</div><br/></div></div>';
        var ConstHtmlDetalle = '<div id="lugar" style="background:#FFFFFF;' + border2 + '" ><div ' + css + '  style="background:#FFFFFF;" ><div class="col-sm-12"><table style="width:100%;border: 1px solid;border-color:gainsboro"><tr><td>' + strImg + '</td><td><table style="width:100%">Nombre&nbsp;Codigo&nbsp;Marca&nbsp;Color&nbsp;Talla&nbsp;Precio&nbsp;CDantidad&nbsp;Cantidad</table></td></tr></table></div></div></div>';

        var strTablaTallas = '<table><tr><td><div style="margin-top:2px;margin-right:2px;"><button class="btn btn-white btn-xs"  title="Tallas"  style="width:100%;">Tallas:</button></div></td><td><div style="margin-top:2px;margin-right:2px;"><button class="btn btn-success btn-xs" style="width:100%;">Total</button></div></td>ListvariableTalla</tr><tr><td><div style="margin-top:2px;margin-right:2px;"><button  title="Cantidad"  class="btn btn-white btn-xs" style="width:100%;">Cantidad:</button></div></td></td><td><div style="margin-top:2px;margin-right:2px;"><button class="btn btn-success btn-xs" style="width:100%;">VTotal</button></div></td>ListvariableCantidad</tr></table>'
        var ConstTalla = '<td><div style="margin-top:2px;margin-right:2px;"><button class="btn btn-primary btn-xs"  style="width:100%;" title="Talla"  data-id="codTienda" data-tda="desTiendaS" data-modal="codTalla" data-art="codArticulo"  >variableTalla</button></div></td>'
        var ConstCantidad = '<td><div style="margin-top:2px;margin-right:2px;"><button class="btn btn-info btn-xs" style="width:100%;text-align:center;">variableCantidad</button></div></td>'

        var listTalla = '';
        var listCantidad = '';
        var divFinal = '';
        var strUrlImagen = '';
        var codTienda = ''
        var consTienda = ''
        var Precio = 0.00;
        var Comision = 0.00;
        var Descuento = 0.00;
        var Total = 0.00;
        var urlImagenSusti = '';
        var DireccionTienda = '';
       
        var cantidad = '';

        var NombreArticulo = '';
        var CodigoArt = '';
        var MarcaArticulo = '';
        var ColorArticulo = '';
        var CategoriArticulo = '';
        var PrecioSinIgv = '';
        var stock = '';

        var cant = 0;
        $.each(listArticulos, function (index, item) {         

            cant +=1
            CodigoArt = item.codigoArt;
            strUrlImagen = item.strUrlImagen
            NombreArticulo = item.DescriArt
            MarcaArticulo = item.MarcaArt
            ColorArticulo = item.ColorArt
            PrecioSinIgv = item.PrecioArt
            CategoriArticulo = item.Cat_Pri_Descripcion + ' > ' + item.Cat_Descripcion

            var strhtml = ConstHtmlDetalle;
            var strhtmlTallas = ConstHtmlDetalleTallas
            //style = "font-size:14px;width:90%;text-align:left;"
            var strIni = '<tr><td style="text-align:left;">&nbsp;<i class="fa fa-check-circle"></i>&nbsp;<b>';
            var strIniCn = '<tr><td style="text-align:left;" colspan="2">&nbsp;<i class="fa fa-check-circle"></i>&nbsp;<b>';
            var strIniS = '<tr><td style="text-align:left;"><b>';
            var strIniNombre = '<tr><td style="text-align:center;" colspan="2" >&nbsp;&nbsp;<b>';
            var strMedio = '</b></td><td valign="top" style="padding:0; margin:0;text-align:left;">&nbsp;&nbsp;'
            var strMedioCant = '</b></td><td valign="top" style="padding:0; margin:0;text-align:center;">'
            var strMedioPrecio = '</b></td><td valign="top" style="padding:0; margin:0;text-align:left;color:#FF0000;">&nbsp;&nbsp;'
            var strFin = '</td></tr>';
            
            var strNombre = strIniNombre + '' +  '<b>' + NombreArticulo + strFin; 
            var strCodigo = strIniNombre + '' +  '<b>' + CodigoArt + strFin;
            var strMarca = strIni + 'Marca:' + strMedio + MarcaArticulo + strFin;
            var strColor = strIni + 'Color:' + strMedio  + ColorArticulo + strFin;
            var strPrecio = strIni + 'Precio:' + strMedioPrecio + item.PrecioArt + strFin;
               
                     
               
            strhtml = strhtml.replace("Nombre", strNombre);
            strhtml = strhtml.replace("Codigo", strCodigo);
            
            strhtml = strhtml.replace("Marca", strMarca);
            strhtml = strhtml.replace("Color", strColor);
            strhtml = strhtml.replace("Precio", strPrecio);
            //strhtml = strhtml.replace("Talla", strTalla);
            //strhtml = strhtml.replace("Cantidad", strCantidad); 
            strhtml = strhtml.replace("DireccionImagen", strUrlImagen);

            var listTallasCantidad2 = item.listTallas;
            var total = 0;

               

            for (var j = 0; j < listTallasCantidad2.length; j++) {
                                      
                var strhtmlTotal = strhtml;
                var CodTalla = listTallasCantidad2[j].codTalla;

                var strTalla = strIni + 'Talla:' + strMedio + CodTalla +strFin;
                strhtmlTotal = strhtmlTotal.replace("Talla", strTalla);

                var strCantidad = strIniS + '' + strMedioCant + '<table><tr><td>' + BotonResta + '</td><td width="50px"><div id="' + CodigoArt + '_' + CodTalla + '" >' + listTallasCantidad2[j].CantTalla + '</div><div style="display:none">' + InputCantidadTalla + '</div></td><td>' + BotonSuma + '</td></tr></table>' + strFin;
                strhtmlTotal = strhtmlTotal.replace("Cantidad", strCantidad);

                strhtmlTotal = strhtmlTotal.replace("inpArtTalla", "inpt_" + CodigoArt + '_' + CodTalla);
                strhtmlTotal = strhtmlTotal.replace("valorInp", listTallasCantidad2[j].CantTalla);

                strhtmlTotal = strhtmlTotal.replace("IdArticuloTallaS", CodTalla);
                strhtmlTotal = strhtmlTotal.replace("IdArticuloTallaR", CodTalla);

                var strDCantidad = strIniCn + 'Cantidad:' + '<b>' + strFin;
                strhtmlTotal = strhtmlTotal.replace("CDantidad", strDCantidad);
                   
                divFinal += strhtmlTotal;
            }

        })

        var strhtmlF = ''
        //strhtmlF += '<div class="modal-header modal-header-danger" style="margin-top:0px;margin-bottom:0px;padding-top:2px;padding-bottom:2px;">'
        //strhtmlF += 'Lista de Pedidos'
        //strhtmlF += '</div>'
        //strhtmlF += '<div class="modal-body">'
        //strhtmlF += '<table id="example" class="table table-hover dataTable  table-striped table-responsive">'
        //strhtmlF += '<tbody>'
        //strhtmlF += '<tr>'
        //strhtmlF += '<td>'
        strhtmlF += '<div id="listTalla" style="overflow-x: hidden; overflow-y:auto; height: 378px;">'
        strhtmlF += divFinal
        strhtmlF += '</div>'
        //strhtmlF += '</td>'
        //strhtmlF += '</tr>'
        //strhtmlF += '</tbody>'
        //strhtmlF += '</table>'
        //strhtmlF += '</div>'

        if (cant>0)
            document.getElementById("DivListCompra").innerHTML = strhtmlF;

    }

    function verDetalle(control){
        var codArticulo = $(control).attr('data-id');
        //DibujarDetalleArticulo(codArticulo);
        DibujarDetalleMovil(codArticulo);
      
    }

    function PopupEliminar(control) {
        var codArticulo = $(control).attr('data-id');
        
        var strhtml = ''       

        strhtml += '<div class="modal-header modal-header-danger" style="margin-top:0px;margin-bottom:0px;padding-top:2px;padding-bottom:2px;">'
        strhtml += '<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>'
        strhtml += '<h5 class="modal-title" id="myModalLabel">'
        strhtml += '<table style="border-bottom:0px;font-size:14px;width:50%;">'
        strhtml += '<tr>'
        strhtml += '<td style="font-size:14px;width:100%;text-align:left;">Articulo:&nbsp;&nbsp;' + codArticulo + '</td>'
        strhtml += '</tr>'
        strhtml += '</table>'
        strhtml += '</h5>'
        strhtml += '</div>'
        strhtml += '<div class="modal-body">'
        strhtml += 'Desea eliminar al articulo: ' + codArticulo + '?'
        strhtml += '</div>'
        strhtml += '<div class="modal-footer" style="margin-top:-30px">'
        strhtml += '<button type="button" class="btn btn-default" data-dismiss="modal">Cerrar</button>'
        strhtml += '<button type="button" class="btn btn-danger"  onclick="EliminarDetalle(this)"  data-id="' + codArticulo + '"  data-dismiss="modal">Eliminar</button>'
        //strhtml += ' <button type="button"  title="Eliminar class="btn btn-danger" data-dismiss="modal" detalle" onclick="EliminarDetalle(this)"  data-id="' + codArticulo + '" data-modal="" data-toggle="modal">Elimninar</button>';
        //strhtml += '<input type="submit" class="btn btn-primary" onclick="agregarLista()"  id="btnSubmit" value="Agregar" />'
        strhtml += '</div>'
        var options = { "backdrop": "static", keyboard: true };

        $('#myModalContent').html(strhtml);
        $('#myModal').modal(options);
        $('#myModal').modal('show');

    }

    function EliminarDetalle(control) {
        var codArticulo = $(control).attr('data-id');
        EliminarArticuloList(codArticulo);
        DibujarGrilla();
        toastr.success("El articulo se elimino del pedido.", 'Mensaje');
    }

    function DibujarDetalleMovil(codArticulo) {


        var border2 = 'border:2px';
        var espacio = '&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;';
        var strImg = '<td Id="tdImagen"style="background:#FFFFFF;width:30%;vertical-align:middle;">'
        strImg += '<div Id="DivgImagen">'
        strImg += '<div id="DivImagen" style="text-align:center;">'
        strImg += '<img id="imagenCatalogo" class="imgRedonda" src="DireccionImagen" width="100%" height="100%" />'
        strImg += '</div>'
        strImg += '</div>'
        strImg += '</td>'
        var css = 'class="row"';
        var ConstTalla = '<td><div style="margin-top:2px;margin-right:2px;"><button class="btn btn-white btn-xs" style="width:100%;">variableTalla</button></div></td>'
        var BotonSuma = '<button title="Sumar Cantidad" class="btnSuma btn btn-success" onclick="sumarCantidad(this)" data-id="IdArticuloTallaS" data-modal="Sstock" data-toggle="modal"><span class="glyphicon glyphicon-plus"></span></button>'
        var BotonResta = '<button title="Restar Cantidad" class="btnResta btn btn-danger" onclick="restarCantidad(this)" data-id="IdArticuloTallaR" data-modal="Rstock" data-toggle="modal"><span class="glyphicon glyphicon-minus"></span></button>'
        var InputCantidadTalla = '<input id="inpArtTalla" type="Text"  name="Talla" value="valor" placeholder="cantidad" onchange = "validarStock(this)" data-id="inpStock" style="width:100%;" autofocus="" class="form-control"/>'
        var ConstHtmlDetalleTallas = '<br/><div id="listatallas" style="background:#FFFFFF;' + border2 + '" ><div ' + css + '  style="background:#FFFFFF;" ><div class="col-sm-12"><i class="fa fa-info-circle"></i>&nbsp;<b>Tallas y Cantidades</b><br/></div><div class="col-sm-12">ListaTallas</div><br/></div></div>';
        var ConstHtmlDetalle = '<div id="lugar" style="background:#FFFFFF;' + border2 + '" ><div ' + css + '  style="background:#FFFFFF;" ><div class="col-sm-12"><table style="width:100%;border: 1px solid;border-color:gainsboro"><tr><td>' + strImg + '</td><td><table style="width:100%">Nombre&nbsp;Codigo&nbsp;Marca&nbsp;Color&nbsp;Talla&nbsp;Precio&nbsp;Cantidad</table></td></tr></table></div></div></div>';

        var strTablaTallas = '<table><tr><td><div style="margin-top:2px;margin-right:2px;"><button class="btn btn-white btn-xs"  title="Tallas"  style="width:100%;">Tallas:</button></div></td><td><div style="margin-top:2px;margin-right:2px;"><button class="btn btn-success btn-xs" style="width:100%;">Total</button></div></td>ListvariableTalla</tr><tr><td><div style="margin-top:2px;margin-right:2px;"><button  title="Cantidad"  class="btn btn-white btn-xs" style="width:100%;">Cantidad:</button></div></td></td><td><div style="margin-top:2px;margin-right:2px;"><button class="btn btn-success btn-xs" style="width:100%;">VTotal</button></div></td>ListvariableCantidad</tr></table>'
        var ConstTalla = '<td><div style="margin-top:2px;margin-right:2px;"><button class="btn btn-primary btn-xs"  style="width:100%;" title="Talla"  data-id="codTienda" data-tda="desTiendaS" data-modal="codTalla" data-art="codArticulo"  >variableTalla</button></div></td>'
        var ConstCantidad = '<td><div style="margin-top:2px;margin-right:2px;"><button class="btn btn-info btn-xs" style="width:100%;text-align:center;">variableCantidad</button></div></td>'

        var listTalla = '';
        var listCantidad = '';
        var divFinal = '';
        var strUrlImagen = '';
        var codTienda = ''
        var consTienda = ''
        var Precio = 0.00;
        var Comision = 0.00;
        var Descuento = 0.00;
        var Total = 0.00;
        var urlImagenSusti = '';
        var DireccionTienda = '';
        var CodTalla = '';
        var cantidad = '';

        var NombreArticulo = '';
        var CodigoArt = '';
        var MarcaArticulo = '';
        var ColorArticulo = '';
        var CategoriArticulo = '';
        var PrecioSinIgv = '';
        var stock = '';


        $.each(listArticulos, function (index, item) {

         

                CodigoArt = item.codigoArt;
                strUrlImagen = item.strUrlImagen
                NombreArticulo = item.DescriArt
                MarcaArticulo = item.MarcaArt
                ColorArticulo = item.ColorArt
                PrecioSinIgv = item.PrecioArt
                CategoriArticulo = item.Cat_Pri_Descripcion + ' > ' + item.Cat_Descripcion

                var strhtml = ConstHtmlDetalle;
                var strhtmlTallas = ConstHtmlDetalleTallas
                //style = "font-size:14px;width:90%;text-align:left;"
                var strIni = '<tr><td style="text-align:left;">&nbsp;<i class="fa fa-check-circle"></i>&nbsp;<b>';
                var strIniNombre = '<tr><td style="text-align:center;" colspan="2" >&nbsp;&nbsp;<b>';
                var strMedio = '</b></td><td valign="top" style="padding:0; margin:0;text-align:left;">&nbsp;&nbsp;'
                var strMedioPrecio = '</b></td><td valign="top" style="padding:0; margin:0;text-align:left;color:#FF0000;">&nbsp;&nbsp;'
                var strFin = '</td></tr>';
            
                var strNombre = strIniNombre + '' +  '<b>' + NombreArticulo + strFin; 
                var strCodigo = strIniNombre + '' +  '<b>' + CodigoArt + strFin;
                var strMarca = strIni + 'Marca:' + strMedio + MarcaArticulo + strFin;
                var strColor = strIni + 'Color:' + strMedio  + ColorArticulo + strFin;
                var strPrecio = strIni + 'Precio:' + strMedioPrecio + item.PrecioArt + strFin;
               
                     
               
                strhtml = strhtml.replace("Nombre", strNombre);
                strhtml = strhtml.replace("Codigo", strCodigo);
                strhtml = strhtml.replace("Marca", strMarca);
                strhtml = strhtml.replace("Color", strColor);
                strhtml = strhtml.replace("Precio", strPrecio);
                //strhtml = strhtml.replace("Talla", strTalla);
                //strhtml = strhtml.replace("Cantidad", strCantidad); 
                strhtml = strhtml.replace("DireccionImagen", strUrlImagen);

                var listTallasCantidad2 = item.listTallas;
                var total = 0;

               

                for (var j = 0; j < listTallasCantidad2.length; j++) {
                                      
                    var strhtmlTotal = strhtml;

                    var strTalla = strIni + 'Talla:' + strMedio + listTallasCantidad2[j].codTalla; +strFin;
                    strhtmlTotal = strhtmlTotal.replace("Talla", strTalla);

                    var strCantidad = strIni + 'Cantidad:' + strMedio + listTallasCantidad2[j].CantTalla + strFin;
                    strhtmlTotal = strhtmlTotal.replace("Cantidad", strCantidad);                              
                   
                    divFinal += strhtmlTotal;
                }

            

        });


        var strhtml = ''
        strhtml += '<div class="modal-header modal-header-danger" style="margin-top:0px;margin-bottom:0px;padding-top:2px;padding-bottom:2px;">'
        strhtml += 'Lista de Pedidos'
        strhtml += '</div>'
        strhtml += '<div class="modal-body">'
        strhtml += '<table id="example" class="table table-hover dataTable  table-striped table-responsive">'
        strhtml += '<tbody>'
        strhtml += '<tr>'
        strhtml += '<td>'
        strhtml += '<div id="listTalla" style="overflow-x: hidden; overflow-y:auto; height: 378px;">'
        strhtml += divFinal
        strhtml += '</div>'
        strhtml += '</td>'
        strhtml += '</tr>'
        strhtml += '</tbody>'
        strhtml += '</table>'
        strhtml += '</div>' 
       

    }
    

    function DibujarDetalleArticulo(codArticulo) {

    
        var border2 = 'padding: 5px 5px 5px 5px;border:2px';
        var espacio = '&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;';
        var css = 'class="row"';
        var ConstTalla = '<td><div style="margin-top:2px;margin-right:2px;"><button class="btn btn-white btn-xs" style="width:100%;">variableTalla</button></div></td>'
        var BotonSuma = '<button title="Sumar Cantidad" class="btnSuma btn btn-success" onclick="sumarCantidad(this)" data-id="IdArticuloTallaS" data-modal="Sstock" data-toggle="modal"><span class="glyphicon glyphicon-plus"></span></button>'
        var BotonResta = '<button title="Restar Cantidad" class="btnResta btn btn-danger" onclick="restarCantidad(this)" data-id="IdArticuloTallaR" data-modal="Rstock" data-toggle="modal"><span class="glyphicon glyphicon-minus"></span></button>'
        var InputCantidadTalla = '<input id="inpArtTalla" type="Text"  name="Talla" value="valor" placeholder="cantidad" onchange = "validarStock(this)" data-id="inpStock" style="width:100%;" autofocus="" class="form-control"/>'
        var ConstHtmlDetalleTallas = '<br/><div id="listatallas" style="background:#FFFFFF;' + border2 + '" ><div ' + css + '  style="background:#FFFFFF;" ><div class="col-sm-12"><i class="fa fa-info-circle"></i>&nbsp;<b>Tallas y Cantidades</b><br/></div><div class="col-sm-12">ListaTallas</div><br/></div></div>';
        var ConstHtmlDetalle = '<br/><div id="lugar" style="background:#FFFFFF;' + border2 + '" ><div ' + css + '  style="background:#FFFFFF;" ><div class="col-sm-12"><table style="width:100%">Cantidad&nbsp;Precio&nbsp;Comision&nbsp;Descuento&nbsp;Total</table></div><br/></div></div>';

        var strTablaTallas = '<table><tr><td><div style="margin-top:2px;margin-right:2px;"><button class="btn btn-white btn-xs"  title="Tallas"  style="width:100%;">Tallas:</button></div></td><td><div style="margin-top:2px;margin-right:2px;"><button class="btn btn-success btn-xs" style="width:100%;">Total</button></div></td>ListvariableTalla</tr><tr><td><div style="margin-top:2px;margin-right:2px;"><button  title="Cantidad"  class="btn btn-white btn-xs" style="width:100%;">Cantidad:</button></div></td></td><td><div style="margin-top:2px;margin-right:2px;"><button class="btn btn-success btn-xs" style="width:100%;">VTotal</button></div></td>ListvariableCantidad</tr></table>'
        var ConstTalla = '<td><div style="margin-top:2px;margin-right:2px;"><button class="btn btn-primary btn-xs"  style="width:100%;" title="Talla"  data-id="codTienda" data-tda="desTiendaS" data-modal="codTalla" data-art="codArticulo"  >variableTalla</button></div></td>'
        var ConstCantidad = '<td><div style="margin-top:2px;margin-right:2px;"><button class="btn btn-info btn-xs" style="width:100%;text-align:center;">variableCantidad</button></div></td>'

        var listTalla = '';
        var listCantidad = '';
        var divFinal = '';
        var strUrlImagen = '';
        var codTienda = ''
        var consTienda = ''
        var Precio = 0.00;
        var Comision = 0.00;
        var Descuento = 0.00;
        var Total = 0.00;
        var urlImagenSusti = '';
        var DireccionTienda = '';
        var CodTalla = '';
        var cantidad = '';

        var NombreArticulo = '';
        var MarcaArticulo = '';
        var ColorArticulo = '';
        var CategoriArticulo = '';
        var PrecioSinIgv = '';
        var stock = '';


        $.each(listArticulos, function (index, item) {

            if (codArticulo == item.codigoArt) {
                
                strUrlImagen = item.strUrlImagen
                NombreArticulo = item.DescriArt
                MarcaArticulo = item.MarcaArt
                ColorArticulo = item.ColorArt
                PrecioSinIgv = item.PrecioArt
                CategoriArticulo = item.Cat_Pri_Descripcion + ' > ' + item.Cat_Descripcion
                            
                var strhtml = ConstHtmlDetalle;
                var strhtmlTallas = ConstHtmlDetalleTallas
                var strIni = '<tr><td><p>&nbsp;<i class="fa fa-check-circle"></i>&nbsp;<b>';
                var strIniTotal = '<tr><td><p>&nbsp;<i class="fa fa-info-circle"></i>&nbsp;<b>';
                var strMedio = '</b></p></td><td valign="top" style="padding:0; margin:0;text-align:right">&nbsp;&nbsp;'
                var strFin = '</td></tr>';

                var strCantidad = strIni + 'Cantidad:' + strMedio + item.CantidadTotal + strFin;
                var strPrecio = strIni + 'Precio:' + strMedio + item.PrecioArt + strFin;
                var strComision = strIni + 'Comision:' + strMedio + item.Comission + strFin;
                var strDescuento = strIni + 'Descuento:' + strMedio + item.Descuento + strFin;
                var strTotal = strIniTotal + 'TOTAL:' + strMedio +'<b>'+ item.Total + strFin;

                strhtml = strhtml.replace("Cantidad", strCantidad);
                strhtml = strhtml.replace("Precio", strPrecio);
                strhtml = strhtml.replace("Comision", strComision);
                strhtml = strhtml.replace("Descuento", strDescuento);
                strhtml = strhtml.replace("Total", strTotal);
                
                var listTallasCantidad2 = item.listTallas;
                var total = 0;

                for (var j = 0; j < listTallasCantidad2.length; j++) {

                    var talla = listTallasCantidad2[j].codTalla;
                    var cantidad = listTallasCantidad2[j].CantTalla;
                    total += parseInt(cantidad);

                    listTalla += ConstTalla;
                    listCantidad += ConstCantidad;

                    listTalla = listTalla.replace("variableTalla", talla);
                    listCantidad = listCantidad.replace("variableCantidad", cantidad);

                }

                strTablaTallas = strTablaTallas.replace("VTotal", total);
                strTablaTallas = strTablaTallas.replace("ListvariableTalla", listTalla);
                strTablaTallas = strTablaTallas.replace("ListvariableCantidad", listCantidad);
                strhtmlTallas = strhtmlTallas.replace("ListaTallas", strTablaTallas);

                divFinal += strhtmlTallas
                divFinal += strhtml;
            }

        });
      

        var strhtml = ''
        var pOcu = "ocultarDivFast('tdImagen');mostrarDivFast('bverP'); ocultarDivFast('bocuP')"
        var pVer = "mostrarDivFast('tdImagen');ocultarDivFast('bverP'); mostrarDivFast('bocuP')"

        strhtml += '<div class="modal-header modal-header-danger" style="margin-top:0px;margin-bottom:0px;padding-top:2px;padding-bottom:2px;">'
        strhtml += '<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>'
        strhtml += '<h5 class="modal-title" id="myModalLabel">'
        strhtml += '<table style="border-bottom:0px;font-size:14px;width:100%;">'
        strhtml += '<tr>'
        strhtml += '<td style="font-size:14px;width:5%;text-align:left;">'
        strhtml += '<span id="bocuP" onclick ="' + pOcu + '"  class="glyphicon glyphicon-eye-close"></span>'
        strhtml += '<span id="bverP" onclick ="' + pVer + '" style="display:none" class="glyphicon glyphicon-picture"></span>'
        strhtml += '</td>'
        strhtml += '<td style="font-size:14px;width:90%;text-align:left;">Articulo:&nbsp;&nbsp;' + codArticulo + '&nbsp;&nbsp;-&nbsp;&nbsp;Precio:&nbsp;&nbsp;S/&nbsp;&nbsp;' + PrecioSinIgv + '</td>'
        strhtml += '</tr>'
        strhtml += '</table>'
        strhtml += '</h5>'
        strhtml += '</div>'
        strhtml += '<div class="modal-body">'
        strhtml += '<table id="example" class="table table-hover dataTable  table-striped table-responsive">'
        strhtml += '<tbody>'
        strhtml += '<tr>'
        strhtml += '<td Id="tdImagen"style="background:#FFFFFF;width:30%;vertical-align:middle;border: 1px solid;border-color:gainsboro">'
        strhtml += '<div Id="DivgImagen">'
        strhtml += '<div id="DivNombre" style="text-align:center;"><h5><b>' + NombreArticulo + '</b></h5></div><br/>'
        strhtml += '<div id="DivImagen" style="text-align:center;">'
        strhtml += '<img id="imagenCatalogo" class="imgRedonda" src="' + strUrlImagen + '" width="100%" height="100%" />'
        strhtml += '</div><br/>'
        strhtml += '<div id="DivPrecio" style="text-align:left"><table style="width:100%" ><tr><td style="width:50%" ><div style="width:100%" ><h5><b>Precio:&nbsp;&nbsp;</b></h5></div></td><td><div style="width:100%;color:#FF0000"><h5><b>S/&nbsp;&nbsp;' + PrecioSinIgv + '</b></h5></div></td></tr></table></div>'
        strhtml += '<div id="DivMarca" style="text-align:left"><h5><b>Marca:&nbsp;&nbsp;</b>' + MarcaArticulo + '</h5></div>'
        strhtml += '<div id="DivColor" style="text-align:left"><h5><b>Color:&nbsp;&nbsp;</b>' + ColorArticulo + '</h5></div>'
        strhtml += '<div id="DivCateg" style="text-align:left"><h5><b>Categorización:</b></h5></div>'

        strhtml += '</div>'
        strhtml += '</td>'
        strhtml += '<td>'
        strhtml += '<div id="listTalla" style="overflow-x: hidden; overflow-y:auto; height: 378px;">'
        strhtml += divFinal
        strhtml += '</div>'
        strhtml += '</td>'
        strhtml += '</tr>'
        strhtml += '</tbody>'
        strhtml += '</table>'
        strhtml += '</div>'
        strhtml += '<div class="modal-footer" style="margin-top:-30px">'
        strhtml += '<button type="button" class="btn btn-default" data-dismiss="modal">Cerrar</button>'
        strhtml += '</div>'
        var options = { "backdrop": "static", keyboard: true };

        $('#myModalContent').html(strhtml);
        $('#myModal').modal(options);
        $('#myModal').modal('show');


    }

    function restarCantidad(control) {

        var Cod = control.getAttribute('data-id');
        var cInput = 'inpt_' + Cod;
        var valor = $('#' + cInput).val();
        var valorInt = 0;
        var msjAlert = "";
        valorInt = ((BorrarEspacio(valor) == '') ? (msjAlert += 'Fecha Nacimiento.<br/>', 0) : parseInt(valor) - 1);
        valorInt = ((valorInt <= 0) ? (0) : valorInt);
        $('#' + cInput).val(valorInt);
    }

    function validarStock(control) {

        var cInput = control.getAttribute('Id');
        var valor = (($('#' + cInput).val() == '') ? (0) : parseInt($('#' + cInput).val()));;
        var stock = parseInt(control.getAttribute('data-id'));
        if (valor > stock) { $('#' + cInput).val(stock); toastr.error("Valor mayor que el Stock.", "Error"); }
        if (valor < 0) { $('#' + cInput).val(0); toastr.error("Valor menor que cero.", "Error"); }

    }


    function ocultarDiv(divId) {

        $("#" + divId).hide("slow");
    }

    function mostrarDiv(divId) {

        $("#" + divId).show("slow");
    }

    function ocultarDivFast(divId) {

        $("#" + divId).hide();
    }

    function mostrarDivFast(divId) {

        $("#" + divId).show();
    }

    function BorrarEspacio(cadena) {
        cadena = cadena.replace(/ /g, "")
        return cadena;
    }





</script>