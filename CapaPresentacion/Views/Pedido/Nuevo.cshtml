@using CapaEntidad.Pedido
@model Ent_Liquidacion
@{
    ViewBag.Title = "Pedido";
}

@*@Scripts.Render("~/bundles/bootstrap")*@
<style>
    #dwcliente {
        width: 200px;
    }

    .imgRedonda {
        width: 100px;
        height: 80px;
        border-radius: 15px;
    }

    #divImagen {
        width: 100%;
        height: 100%;
    }

    #listatallas {
        border-radius: 10px 10px 10px 10px;
        -moz-border-radius: 10px 10px 10px 10px;
        -webkit-border-radius: 10px 10px 10px 10px;
        border: 2px;
    }

    #lugar {
        border-radius: 10px 10px 10px 10px;
        -moz-border-radius: 10px 10px 10px 10px;
        -webkit-border-radius: 10px 10px 10px 10px;
        border: 2px;
    }
</style>
<link href="~/Content/plugins/iCheck/custom.css" rel="stylesheet" />

<link href="~/ContentSelect/bootstrap-select.css" rel="stylesheet" />
<div class="box box-body box-default" style="margin-top:0px;margin-bottom:0px;padding-top:5px;padding-bottom:5px;">

    <div class="row" style="margin-top:5px;margin-left:5px;margin-right:5px;margin-bottom:0px;border-radius:5px;padding-top:0px;padding-bottom:0px;">

        <div id="DivHBasico" class="modal-content">
            <div class="modal-header modal-header-danger" style="margin-top:0px;margin-bottom:0px;padding-top:2px;padding-bottom:2px;">
                <h5 class="modal-title" id="myModalLabel">
                    <table style="border-bottom:0px;font-size:14px;width:100%;">
                        <tr>
                            <td style="font-size:14px;width:90%;text-align:left;">Promotor y formas de pago</td>
                            <td style="font-size:14px;width:10%;text-align:right;">
                                <span id="bocu" onclick="ocultarDiv('DivBasico'); mostrarDivFast('bver'); ocultarDivFast('bocu')" class="glyphicon glyphicon-minus-sign"></span>
                                <span id="bver" style="display:none" onclick="mostrarDiv('DivBasico'); mostrarDivFast('bocu'); ocultarDivFast('bver')" class="glyphicon glyphicon-plus-sign"></span>
                            </td>
                        </tr>
                    </table>
                </h5>
            </div>
            <div id="DivBasico" class="modal-body">

                <div class="row" style="margin-top:0px;margin-left:10px;margin-right:10px;margin-bottom:0px;border-radius:5px;padding-top:10px;padding-bottom:10px;">

                    <div class="col-sm-3" style="margin-top:2px;margin-bottom:2px;">
                        <label for="disponible">*Promotor</label>
                    </div>
                    <div id="divTipoDoc" class="col-sm-3" style="margin-top:2px;margin-bottom:2px;">

                        @Html.DropDownList("dwPromo", new SelectList(ViewBag.listPromotor, "codigo", "descripcion", "-1"), new { @class = "selectpicker", @data_live_search = "true", @id = "dwPromo", @onchange = "buscarPersonaPedido()", @placeholder = ".col-xs-1" })
                    </div>
                    <div class="col-sm-3" style="margin-top:2px;margin-bottom:2px;">
                        <label for="disponible">*Forma de Pago</label>
                    </div>
                    <div id="divTipoDoc" class="col-sm-3" style="margin-top:2px;margin-bottom:2px;">
                        @Html.DropDownList("dwFormaPago", new SelectList(ViewBag.listFormapago, "codigo", "descripcion", "-1"), new { @class = "selectpicker", @data_live_search = "false", @id = "dwFormaPago", @placeholder = ".col-xs-1" })
                    </div>

                </div>

                <div class="row" style="margin-top:0px;margin-left:10px;margin-right:10px;margin-bottom:0px;border-radius:5px;padding-top:10px;padding-bottom:10px;">

                    <div class="col-sm-3" style="margin-top:2px;margin-bottom:2px;">
                        <label for="disponible">Estado</label>
                    </div>
                    <div class="col-sm-3" style="margin-top:2px;margin-bottom:2px;color:brown">
                        <label id="lblEstado" for="disponible">Nuevo</label>
                    </div>
                    <div class="col-sm-3" style="margin-top:2px;margin-bottom:2px;">
                        <label for="disponible">Premio por ganar</label>
                    </div>
                    <div class="col-sm-3" style="margin-top:2px;margin-bottom:2px;color:brown">
                        <label id="lblPremio" for="disponible">Premio generado</label>
                    </div>
                </div>

            </div>

        </div>
        @using (Ajax.BeginForm("listarStr_ArticuloTalla", new AjaxOptions { OnBegin = "MostrarArticulo();" }))
        {
            <div class="row" style="margin-top:5px;margin-left:0px;margin-right:0px;margin-bottom:5px;background-color:#f4f4f4;border-radius:5px;padding-top:2px;padding-bottom:2px;">

                <div class="col-sm-3" style="margin-top:2px;margin-bottom:2px;">
                    <label for="txtArticulo">Articulo</label>
                </div>
                <div class="col-sm-3" style="margin-top:2px;margin-bottom:2px;">
                    @*<table  style="width :100%;" ><tr><td  style="width :100%;" ><input id="txtArticulo" type="text" placeholder="Ingrese articulo" style="width :90%;" autofocus class="form-control" /><button type="submit" id="btnBuscar" name="btnConsultar" onclick="MostrarArticulo()" title="Buscar" class="btn btn-small btn-primary" data-modal="" data-toggle="modal"><i class="fa fa-search"></i></button></td></tr></table>*@
                    <div class="input-group">
                        <input id="txtArticulo" type="text" focus="true" placeholder="Ingrese articulo" class="form-control" />
                        <div class="input-group-btn">
                            <button class="btn btn-primary" type="submit" id="btnBuscar" name="btnConsultar" title="Buscar">
                                <span class="glyphicon glyphicon-search"></span>
                            </button>
                        </div>
                    </div>

                </div>

            </div>
        }
        <div id="DivHBasico" class="modal-content">
            <div class="modal-header modal-header-danger" style="margin-top:0px;margin-bottom:0px;padding-top:2px;padding-bottom:2px;">
                <h5 class="modal-title" id="myModalLabel">
                    <table style="border-bottom:0px;font-size:14px;width:100%;">
                        <tr>
                            <td style="font-size:14px;width:90%;text-align:left;">Lista de Compra</td>
                            <td style="font-size:14px;width:10%;text-align:right;">
                                <span id="Locu" onclick="ocultarDiv('DivListCompra'); mostrarDivFast('Lver'); ocultarDivFast('Locu')" class="glyphicon glyphicon-minus-sign"></span>
                                <span id="Lver" style="display:none" onclick="mostrarDiv('DivListCompra'); mostrarDivFast('Locu'); ocultarDivFast('Lver')" class="glyphicon glyphicon-plus-sign"></span>
                            </td>
                        </tr>
                    </table>
                </h5>
            </div>
            <div id="DivListCompra" class="modal-body" style="padding:0">
                <div class="row" style="margin-top:0px;margin-left:10px;margin-right:10px;margin-bottom:0px;border-radius:5px;padding-top:10px;padding-bottom:10px;">
                    <div id="divDetalleVenta" style="overflow-x: auto; overflow-y:hidden; width:100%">
                        @*height: 378px;*@
                        <table style="width:100%;">
                            <thead>
                                <tr>
                                    <th>
                                        <div class="col-sm-1" style="margin-top:2px;margin-bottom:2px;">
                                            <label for="disponible">Referencia</label>
                                        </div>
                                    </th>
                                    <th>
                                        <div class="col-sm-1" style="margin-top:2px;margin-bottom:2px;">
                                            <label for="disponible">Articulo</label>
                                        </div>
                                    </th>
                                    <th>
                                        <div class="col-sm-1" style="margin-top:2px;margin-bottom:2px;">
                                            <label for="disponible">Marca</label>
                                        </div>
                                    </th>
                                    <th>
                                        <div class="col-sm-1" style="margin-top:2px;margin-bottom:2px;">
                                            <label for="disponible">Color</label>
                                        </div>
                                    </th>
                                    <th>
                                        <div class="col-sm-1" style="margin-top:2px;margin-bottom:2px;">
                                            <label for="disponible">Talla</label>
                                        </div>
                                    </th>
                                    <th>
                                        <div class="col-sm-1" style="margin-top:2px;margin-bottom:2px;">
                                            <label for="disponible">Cantidad</label>
                                        </div>
                                    </th>
                                    <th>
                                        <div class="col-sm-1" style="margin-top:2px;margin-bottom:2px;">
                                            <label for="disponible">Precio</label>
                                        </div>
                                    </th>
                                    <th>
                                        <div class="col-sm-1" style="margin-top:2px;margin-bottom:2px;">
                                            <label for="disponible">Comision</label>
                                        </div>
                                    </th>
                                    <th>
                                        <div class="col-sm-1" style="margin-top:2px;margin-bottom:2px;">
                                            <label for="disponible">Descuento</label>
                                        </div>
                                    </th>
                                    <th>
                                        <div class="col-sm-1" style="margin-top:2px;margin-bottom:2px;">
                                            <label for="disponible">Total</label>
                                        </div>
                                    </th>
                                </tr>
                            </thead>

                        </table>
                    </div>
                </div>

            </div>

        </div>

        <div id="DivHBasico" class="modal-content">
            <div class="modal-header modal-header-danger" style="margin-top:5px;margin-bottom:0px;padding-top:2px;padding-bottom:2px;">
                <h5 class="modal-title" id="myModalLabel">
                    <table style="border-bottom:0px;font-size:14px;width:100%;">
                        <tr>
                            <td style="font-size:14px;width:90%;text-align:left;">Totales</td>
                            <td style="font-size:14px;width:10%;text-align:right;">
                                <span id="Tocu" onclick="ocultarDiv('DivTotales'); mostrarDivFast('Tver'); ocultarDivFast('Tocu')" class="glyphicon glyphicon-minus-sign"></span>
                                <span id="Tver" style="display:none" onclick="mostrarDiv('DivTotales'); mostrarDivFast('Tocu'); ocultarDivFast('Tver')" class="glyphicon glyphicon-plus-sign"></span>
                            </td>
                        </tr>
                    </table>
                </h5>
            </div>
            <div id="DivTotales" class="modal-body" style="padding:0">
                <div class="row" style="margin-top:0px;margin-left:10px;margin-right:10px;margin-bottom:1px;border-radius:5px;padding-top:0px;padding-bottom:1px;">
                    <div id="divDetalletotales" style="overflow-x: auto; overflow-y:hidden; width:100%">
                        <table style="width:100%;border: 0px solid;border-color:#dcdcdc00">
                            <tbody>
                                <tr>
                                    <td style="background:#FFFFFF;width:20%;vertical-align:middle;">
                                        <div>
                                            <div style="text-align:center;">

                                            </div>
                                        </div>
                                    </td>
                                    <td>
                                        <table style="width:100%">
                                            <tbody>
                                                <tr>
                                                    <td style="text-align:left;">
                                                        &nbsp;<i class="fa fa-info-circle"></i>&nbsp;<b>Sub-Total:</b>
                                                    </td>
                                                    <td valign="top" style="padding:0; margin:0;text-align:left;"><div id="subTotalList">S/. 0.00</div></td>
                                                </tr>
                                                <tr>
                                                    <td style="text-align:left;">
                                                        &nbsp;<i class="fa fa-info-circle"></i>&nbsp;<b>Impuestos:</b>
                                                    </td>
                                                    <td valign="top" style="padding:0; margin:0;text-align:left;"><div id="totalImpuesto">S/. 0.00</div></td>
                                                </tr>
                                                <tr>
                                                    <td style="text-align:left;">
                                                        <div id="notaBusca">
                                                            &nbsp;<i class="fa fa-info-circle"></i>&nbsp;<b>Nota de Credito:</b>
                                                        </div>
                                                    </td>
                                                    <td valign="top" style="padding:0; margin:0;text-align:left;"><div id="totalNota">S/. 0</div></td>
                                                </tr>
                                                <tr>
                                                    <td style="text-align:left;">
                                                        &nbsp;<i class="fa fa-info-circle"></i>&nbsp;<b>Total:</b>
                                                    </td>
                                                    <td valign="top" style="padding:0; margin:0;text-align:left;"><div id="totalList">S/. 0.00</div></td>
                                                </tr>
                                                <tr>
                                                    <td style="text-align:left;">
                                                        <div id="EtiqtotalPercepcion">Percepcion:</div>
                                                    </td>
                                                    <td valign="top" style="padding:0; margin:0;text-align:left;"><div id="totalPercepcion">S/. 0.00</div></td>
                                                </tr>
                                                <tr>
                                                    <td style="text-align:left;">
                                                        &nbsp;<i class="fa fa-info-circle"></i>&nbsp;<b>Gran Total:</b>
                                                    </td>
                                                    <td valign="top" style="padding:0; margin:0;text-align:left;"><div id="grantotalList">S/. 0.00</div></td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

            </div>

        </div>

        <div id="divBoton" style="width:100%;margin-top:5px;text-align:right">
            <button class="btn btn-primary" type="button" onclick="PopupLiquidarPedido()" id="btnliquidar" name="btnliquidar" title="Liquidar">
                <span class="glyphicon glyphicon-floppy-saved"></span>&nbsp;Liquidar Pedido
            </button>

        </div>

    </div>




</div>
<div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" ng-app>
    <div class="modal-dialog">
        <div class="modal-content">
            <div id='myModalContent'></div>
        </div>
    </div>
</div>
@Html.Hidden("lblIdLiquidacion", Model.liq_Id)
@Html.Hidden("lblIdPed", Model.ped_Id)
@Html.Hidden("lblIdCust", Model.cust_Id)
<script src="~/Scripts/bootstrap.min.js"></script>
<script src="~/ScriptsSelect/bootstrap-select.js"></script>
<script src="~/Scripts/BI.js"></script>
<script src="~/Scripts/Plugins/iCheck/icheck.min.js"></script>

<script>
    var gTipoDoc = '';
    var gTipoPer = '';
    var listArticulos = [];
    var glistOtderDtlTem = [];
    var glistOtderDtl = [];
    var glistPago = [];
    var gArtBusqueda
    var glistTalla = [];
    var gStyleMovile = ''
    var gbMovile = false;
    var gMontoPercepcion = 0.00;
    var gLiqId = "";
    var gPedId = "";
    var gCustId = "";
    var gEstado = "1";
    var gvalorTotalCredito = 0.00;
    var gTotal = 0.00;

    var gCustomer = {
        comision: 0.00,
        idCust: 0,
        commission_POS_visaUnica: 0.00,
        percepcion: 0.00,
        taxRate: 0.00,
        email: "",
        nombrecompleto: "",
        premio: "",
        aplica_percepcion: "0",
        cant_nota: 0
    }

    var gPedido = {
        subTotal: 0.00,
        Igv: 0.00,
        Total: 0.00,
        Percepcion: 00
    }

    $(document).ready(function () {

        if (/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)) {
            gStyleMovile = 'style="display:none"';
            gbMovile = true;
            ocultarDivFast('alogo');
        }

        buscarPersonaPedido();
        document.getElementById("txtArticulo").focus();
        DibujarGrilla();

        var iniIdLiquidacion = $('#lblIdLiquidacion').val();

        if (iniIdLiquidacion != '') {

            gPedId = $('#lblIdPed').val();
            gCustId = $('#lblIdCust').val();
            gEstado = '2';
            document.getElementById('lblEstado').innerHTML = 'Edición';
            getLiquidacion(iniIdLiquidacion);
        }


    });

    function setearComboSelectpicker(nameControl, valor, bloqueo) {

        $('select[name=' + nameControl + ']').val(valor);
        $('select[name=' + nameControl + ']').change();
    }

    function buscarPersonaPedido() {

        waitingDialog.show('Espere un momento por favor');
        var ControllerUrl = "@Url.Action("PersonaPedido", "Pedido")";

        var strBoton = '<button class="btn btn-primary" style="margin-top:0px;margin-bottom:0px;padding-top:0px;padding-bottom:0px;padding-right:0px;padding-left:0px;" onclick="ListarNotaCredito()" id="btnliquidar" name="btnliquidar" title="Liquidar"><span class="glyphicon glyphicon-floppy-search"></span>&nbsp;Nota de Credito</button>'
        var promotor = $('#dwPromo').val();
        if (gCustId != '') {

            promotor = 'gCustId'
        }

        document.getElementById("notaBusca").innerHTML = '&nbsp;<i class="fa fa-info-circle"></i>&nbsp;<b>Nota de Credito:</b>'
        //alert(promotor)
        $.ajax({
            type: "GET",
            url: ControllerUrl,
            contentType: "application/json; charset=utf-8",
            data: { basId: promotor },
            datatype: "json",
            cache: true,
            success: function (data) {
                waitingDialog.hide();
                var codTienda = ''
                var consTienda = ''

                if (data != '' && data != '[]') {

                    gCustomer.comision = data.comision;
                    gCustomer.idCust = data.idCust;
                    gCustomer.commission_POS_visaUnica = data.commission_POS_visaUnica;
                    gCustomer.percepcion = data.percepcion;
                    gCustomer.taxRate = data.taxRate;
                    gCustomer.email = data.email;
                    gCustomer.nombrecompleto = data.nombrecompleto;
                    gCustomer.premio = data.premio;
                    gCustomer.aplica_percepcion = data.aplica_percepcion;
                    gCustomer.cant_nota = parseInt(data.cant_nota);
                    gCustomer.premio = data.premio;
                    document.getElementById('lblPremio').innerHTML = data.premio;


                    if (parseInt(data.cant_nota) > 0) {

                        document.getElementById("notaBusca").innerHTML = '&nbsp;<i class="fa fa-info-circle"></i>&nbsp;<b>' + strBoton + '&nbsp;:</b>';
                    }

                }

            },
            error: function () {
                waitingDialog.hide();
                alert('Error')
            }

        });
        waitingDialog.hide();
    }

    function QuitarEspacios(valor) {

        valor = valor.replace(/^\s+|\s+$/g, "");

        return valor;
    }

    function MostrarArticulo() {

        var codArticulo = $('#txtArticulo').val();
        codArticulo = codArticulo.replace(/^\s+|\s+$/g, "");
        if (codArticulo != "") {
            DibujarMostrarArticulo(codArticulo);
            $('#txtArticulo').val('');
        } else {
            toastr.error("Debe ingresar un codigo.", "Aviso");
        }

        //return true

    }



    function EditarDetalle(control) {
        var codArticulo = $(control).attr('data-id');
        DibujarMostrarArticulo(codArticulo);

    }


    function DibujarMostrarArticulo(codArticulo) {

        waitingDialog.show('Espere un momento por favor');

        var bExiste = VerificarExistencia(codArticulo);

        var ControllerUrl = "@Url.Action("listarStr_ArticuloTalla", "Pedido")";
        var css = 'class="row"'
        var border2 = 'padding: 5px 5px 5px 5px;border:2px'
        var espacio = '&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'
        var ConstTalla = '<td><div style="margin-top:2px;margin-right:2px;"><button class="btn btn-white btn-xs" style="width:100%;">variableTalla</button></div></td>'
        var BotonSuma = '<button title="Sumar Cantidad" class="btnSuma btn btn-success" onclick="sumarCantidad(this)" data-id="IdArticuloTallaS" data-modal="Sstock" data-toggle="modal"><span class="glyphicon glyphicon-plus"></span></button>'
        var BotonResta = '<button title="Restar Cantidad" class="btnResta btn btn-danger" onclick="restarCantidad(this)" data-id="IdArticuloTallaR" data-modal="Rstock" data-toggle="modal"><span class="glyphicon glyphicon-minus"></span></button>'
        var InputCantidadTalla = '<input id="inpArtTalla" type="Text"  name="Talla" value="valor" placeholder="cantidad" onchange = "validarStock(this)" data-id="inpStock" style="width:100%;" autofocus="" class="form-control"/>'
        var ConstHtmlTienda = '<br/><div id="lugar" style="background:#FFFFFF;' + border2 + '" ><div ' + css + '  style="background:#FFFFFF;" ><div class="col-sm-12"><div><h4><strong>VariableTienda</strong></h4><p>&nbsp;DireccionTienda</p></div><table><tr><td><div style="margin-top:2px;">' + BotonResta + '</div></td><td style="width:100px"><div style="margin-top:2px;">' + InputCantidadTalla + '</div></td><td><div style="margin-top:2px;">' + BotonSuma + '</div></td></tr></table></div><br/></div></div>';
        var ConstCantidad = ''
        var listTalla = '';
        var listCantidad = '';
        var divFinal = '';
        var strUrlImagen = '';
        var options = { "backdrop": "static", keyboard: true };

        $.ajax({
            type: "GET",
            url: ControllerUrl,
            contentType: "application/json; charset=utf-8",
            data: { codArticulo: codArticulo },
            datatype: "json",
            cache: true,
            success: function (data) {

                var codTienda = ''
                var consTienda = ''

                if (data != '' && data != '[]') {
                    var valors = JSON.parse(data);
                    gArtBusqueda = valors;
                    var nombreTienda = '';
                    var urlImagenSusti = '';
                    var DireccionTienda = '';
                    var CodTalla = '';
                    var cantidad = '';
                    var afecPercep = '';
                    var NombreArticulo = '';
                    var MarcaArticulo = '';
                    var ColorArticulo = '';
                    var CategoriArticulo = '';
                    var PrecioSinIgv = '';
                    var stock = '';
                    var Ofe_Id = '';
                    var Ofe_MaxPares = '';
                    var Ofe_Porc = '';
                    var Ofe_tipo = '';
                    var Ofe_ArtVenta = '';

                    $.each(valors, function (index, item) {

                        strUrlImagen = item.Art_Foto
                        afecPercep = item.Afec_Percepcion
                        NombreArticulo = item.Art_Descripcion
                        MarcaArticulo = item.Mar_Descripcion
                        ColorArticulo = item.Col_Descripcion
                        PrecioSinIgv = item.Art_Pre_Sin_Igv
                        CategoriArticulo = item.Cat_Pri_Descripcion + ' > ' + item.Cat_Descripcion
                        CodTalla = item.Tal_Descripcion
                        codTienda = item.Tall_Des;

                        /*campo para ofertas*/
                        Ofe_Id = item.Ofe_Id;
                        Ofe_MaxPares = item.Ofe_MaxPares;
                        Ofe_Porc = item.Ofe_Porc;
                        Ofe_tipo = item.Ofe_tipo;
                        Ofe_ArtVenta = item.Ofe_ArtVenta;
                        /*fin de campo de ofertas*/

                        nombreTienda = '<i class="fa fa-check-circle"></i>&nbsp;Talla:&nbsp;&nbsp;' + item.Tall_Des
                        DireccionTienda = '<i class="fa fa-info-circle"></i>&nbsp;Stock:&nbsp;&nbsp;' + item.Tall_Cant
                        stock = item.Tall_Cant;

                        var strhtml = ConstHtmlTienda;

                        strhtml = strhtml.replace("VariableTienda", nombreTienda);
                        strhtml = strhtml.replace("DireccionTienda", DireccionTienda);
                        strhtml = strhtml.replace("IdArticuloTallaS", CodTalla);
                        strhtml = strhtml.replace("IdArticuloTallaR", CodTalla);
                        strhtml = strhtml.replace("Rstock", stock);
                        strhtml = strhtml.replace("Sstock", stock);
                        strhtml = strhtml.replace("inpStock", stock);

                        var strValor = ((bExiste) ? (VerificarArticuloTalla(CodTalla)) : '');

                        strhtml = strhtml.replace("valor", strValor);
                        strhtml = strhtml.replace("inpArtTalla", "inpt_" + CodTalla);
                        divFinal += strhtml;

                    });

                    var strhtml = ''
                    var pOcu = "ocultarDivFast('tdImagen');mostrarDivFast('bverP'); ocultarDivFast('bocuP')"
                    var pVer = "mostrarDivFast('tdImagen');ocultarDivFast('bverP'); mostrarDivFast('bocuP')"

                    strhtml += '<div class="modal-header modal-header-danger" style="margin-top:0px;margin-bottom:0px;padding-top:2px;padding-bottom:2px;">'
                    strhtml += '<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>'
                    strhtml += '<h5 class="modal-title" id="myModalLabel">'
                    strhtml += '<table style="border-bottom:0px;font-size:14px;width:100%;">'
                    strhtml += '<tr>'
                    strhtml += '<td style="font-size:14px;width:5%;text-align:left;">'
                    strhtml += '<span id="bocuP" onclick ="' + pOcu + '"  class="glyphicon glyphicon-eye-close"></span>'
                    strhtml += '<span id="bverP" onclick ="' + pVer + '" style="display:none" class="glyphicon glyphicon-picture"></span>'
                    strhtml += '</td>'
                    strhtml += '<td style="font-size:14px;width:90%;text-align:left;">Articulo:&nbsp;&nbsp;' + codArticulo + '&nbsp;&nbsp;-&nbsp;&nbsp;Precio:&nbsp;&nbsp;S/&nbsp;&nbsp;' + PrecioSinIgv + '</td>'
                    strhtml += '</tr>'
                    strhtml += '</table>'
                    strhtml += '</h5>'
                    strhtml += '</div>'
                    strhtml += '<div class="modal-body">'
                    strhtml += '<table id="example" class="table table-hover dataTable  table-striped table-responsive">'
                    strhtml += '<tbody>'
                    strhtml += '<tr>'
                    strhtml += '<td Id="tdImagen"style="background:#FFFFFF;width:30%;vertical-align:middle;border: 1px solid;border-color:gainsboro">'
                    strhtml += '<div Id="DivgImagen">'
                    strhtml += '<div id="DivNombre" style="text-align:center;"><h5><b>' + NombreArticulo + '</b></h5></div><br/>'
                    strhtml += '<div id="DivImagen" style="text-align:center;">'
                    strhtml += '<img id="imagenCatalogo" class="imgRedonda" src="' + strUrlImagen + '" width="100%" height="100%" />'
                    strhtml += '</div><br/>'
                    strhtml += '<div id="DivPrecio" style="text-align:left"><table style="width:100%" ><tr><td style="width:50%" ><div style="width:100%" ><h5><b>Precio:&nbsp;&nbsp;</b></h5></div></td><td><div style="width:100%;color:#FF0000"><h5><b>S/&nbsp;&nbsp;' + PrecioSinIgv + '</b></h5></div></td></tr></table></div>'
                    strhtml += '<div id="DivMarca" style="text-align:left"><h5><b>Marca:&nbsp;&nbsp;</b>' + MarcaArticulo + '</h5></div>'
                    strhtml += '<div id="DivColor" style="text-align:left"><h5><b>Color:&nbsp;&nbsp;</b>' + ColorArticulo + '</h5></div>'
                    strhtml += '<div id="DivCateg" style="text-align:left"><h5><b>Categorización:</b></h5></div>'

                    strhtml += '<div id="DivHCodArt"  style="display:none;">' + codArticulo + '</div>'
                    strhtml += '<div id="DivHAfecPerc"  style="display:none;">' + afecPercep + '</div>'
                    strhtml += '<div id="DivHDesArt"  style="display:none;">' + NombreArticulo + '</div>'
                    strhtml += '<div id="DivHMarArt"  style="display:none;">' + MarcaArticulo + '</div>'
                    strhtml += '<div id="DivHColArt"  style="display:none;">' + ColorArticulo + '</div>'
                    strhtml += '<div id="DivHPrecioArt"  style="display:none;">' + PrecioSinIgv + '</div>'
                    strhtml += '<div id="DivHImagenArt"  style="display:none;">' + strUrlImagen + '</div>'
                    strhtml += '<div id="DivHOfe_tipo"  style="display:none;">' + Ofe_tipo + '</div>'
                    strhtml += '<div id="DivHOfe_Id"  style="display:none;">' + Ofe_Id + '</div>'
                    strhtml += '<div id="DivHOfe_MaxPares"  style="display:none;">' + Ofe_MaxPares + '</div>'
                    strhtml += '<div id="DivHOfe_Porc"  style="display:none;">' + Ofe_Porc + '</div>'
                    strhtml += '<div id="DivHOfe_ArtVenta"  style="display:none;">' + Ofe_ArtVenta + '</div>'

                    strhtml += '</div>'
                    strhtml += '</td>'
                    strhtml += '<td>'
                    strhtml += '<div id="listTalla" style="overflow-x: hidden; overflow-y:auto; height: 378px;">'
                    strhtml += divFinal
                    strhtml += '</div>'
                    strhtml += '</td>'
                    strhtml += '</tr>'
                    strhtml += '</tbody>'
                    strhtml += '</table>'
                    strhtml += '</div>'
                    strhtml += '<div class="modal-footer" style="margin-top:-30px">'
                    strhtml += '<button type="button" class="btn btn-default" data-dismiss="modal">Cerrar</button>'
                    strhtml += '<input type="button" class="btn btn-primary" onclick="agregarLista()"   value="Agregar" />'
                    strhtml += '</div>'

                    $('#myModalContent').html(strhtml);
                    $('#myModal').modal(options);
                    $('#myModal').modal('show');
                    waitingDialog.hide();



                } else {
                    toastr.error("Stock por ingresar.", "Aviso");
                }
                waitingDialog.hide();

            },
            error: function () {
                waitingDialog.hide();
                alert('Error')
            }

        });

        waitingDialog.hide();
    }

    function sumarCantidad(control) {

        var Cod = control.getAttribute('data-id');
        var stock = parseInt(control.getAttribute('data-modal'));
        var cInput = 'inpt_' + Cod;
        var valor = $('#' + cInput).val();
        var valorInt = 0;
        var msjAlert = "";
        valorInt = ((BorrarEspacio(valor) == '') ? (msjAlert += 'Fecha Nacimiento.<br/>', 1) : parseInt(valor) + 1);
        valorInt = ((valorInt >= stock) ? (stock) : valorInt);

        $('#' + cInput).val(valorInt);
    }

    function agregarLista() {

        if (validarAgregarLista()) {
            var codigoArt = document.getElementById('DivHCodArt').innerHTML;
            EliminarArticuloList(codigoArt);//elimnamos el codigo de la lista para agregarlo nuevamente
            var DescriArt = document.getElementById('DivHDesArt').innerHTML;
            var MarcaArt = document.getElementById('DivHMarArt').innerHTML;
            var ColorArt = document.getElementById('DivHColArt').innerHTML;
            var PrecioArt = document.getElementById('DivHPrecioArt').innerHTML;
            var AfecPercep = document.getElementById('DivHAfecPerc').innerHTML;

            var Ofe_tipo = document.getElementById('DivHOfe_tipo').innerHTML;
            var Ofe_Id = document.getElementById('DivHOfe_Id').innerHTML;
            var Ofe_MaxPares = document.getElementById('DivHOfe_MaxPares').innerHTML;
            var Ofe_Porc = document.getElementById('DivHOfe_Porc').innerHTML;
            var Ofe_ArtVenta = document.getElementById('DivHOfe_ArtVenta').innerHTML;

            var strUrlImagen = '';
            var LinecantTotal = 0;
            var listTallasCantidad = []; //lista de las tallas escogidas
            var porcComision = gCustomer.comision / 100;

            var glineArticulo = {
                codigoArt: codigoArt,
                DescriArt: DescriArt,
                MarcaArt: MarcaArt,
                ColorArt: ColorArt,
                PrecioArt: PrecioArt,
                AfecPercep: AfecPercep,
                Ofe_tipo: Ofe_tipo,
                Ofe_Id: Ofe_Id,
                Ofe_MaxPares: Ofe_MaxPares,
                Ofe_Porc: Ofe_Porc,
                Ofe_ArtVenta: Ofe_ArtVenta,
                listTallas: [],
                Comission: 0.00,
                Descuento: 0.00,
                Total: 0.00,
                CantidadTotal: 0,
                strUrlImagen: ""
            }

            $.each(gArtBusqueda, function (index, item) {
                strUrlImagen = item.Art_Foto;
            });

            $('input[name="Talla"]').each(function () {

                var valor = QuitarEspacios($(this).val());
                var CantTalla = ((valor == '') ? 0 : parseInt(valor));

                if (CantTalla > 0) {

                    LinecantTotal += CantTalla;
                    var codTalla = $(this).attr("id").substr(5);
                    var cantStock = parseInt($(this).attr("data-id"));
                    var ComissionT = (((PrecioArt)) * porcComision) * (parseInt(AfecPercep)) * 1;
                    var comisionTalla = Math.round(ComissionT * 100) / 100;
                    comisionTalla = Math.round(comisionTalla * CantTalla * 100) / 100;

                    var CostoTotal = Math.round((PrecioArt * CantTalla) * 100) / 100;
                    //console.log(CostoTotal);
                    //console.log(comisionTalla);
                    var TotalTalla = Math.round((CostoTotal - comisionTalla) * 100) / 100;
                    //console.log('total');
                    //console.log(TotalTalla);

                    var oTalla = {
                        Ofe_tipo: Ofe_tipo,
                        Ofe_Id: Ofe_Id,
                        Ofe_MaxPares: Ofe_MaxPares,
                        Ofe_Porc: Ofe_Porc,
                        Ofe_ArtVenta: Ofe_ArtVenta,
                        codTalla: codTalla,
                        CantTalla: CantTalla,
                        stockTalla: cantStock,
                        comisionTalla: comisionTalla,
                        descuentoTalla: 0.00,
                        totalTalla: TotalTalla
                    }

                    listTallasCantidad.push(oTalla);

                }
            });

            if (LinecantTotal > 0) {
                //var porcComision = gCustomer.comision / 100;
                //Comission = Math.round10((((PrecioArt * LinecantTotal)) * porcComision) * 1, -2);
                var Comission = (((PrecioArt * LinecantTotal)) * porcComision) * 1;
                var desc = glineArticulo.Descuento
                var comiss = Math.round(Comission * 100) / 100;
                var Total = Math.round(((PrecioArt * LinecantTotal) - comiss - desc) * 100) / 100;
                //console.log(PrecioArt)
                //console.log(LinecantTotal)
                //console.log(porcComision)
                glineArticulo.listTallas = listTallasCantidad;
                glineArticulo.Total = Total;
                glineArticulo.Comission = comiss;
                glineArticulo.CantidadTotal = LinecantTotal;
                glineArticulo.strUrlImagen = strUrlImagen;
                listArticulos.push(glineArticulo);
                //listArticulos = listArticulos.sort(function (a, b) { return a.PrecioArt - b.PrecioArt }); //ordenamos de menor a mayor precio
                toastr.success("Se agrego el Articulo a la venta.", 'Mensaje');
                validarOferta();
                DibujarGrilla();
            }

        } else {
            toastr.error("* Verificar las cantidades Ingresadas. <br/> * Debe ingresar cantidades mayor a cero.", "Error");
        }
    }

    //VALIDACION DE LAS OFERTAS
    function validarOferta() {

        var porcComision = gCustomer.comision / 100;
        var listArticulosOfertaPorcentaje = listArticulos.filter(obj => obj.Ofe_tipo === 'N'); //lista de articulos con ofertas tipo desc Porcentaje
        var listArticulosOfertaPack = listArticulos.filter(obj => obj.Ofe_tipo === 'P');  //lista de articulos con ofertas tipo precio Pack
        var cantOfertaPorc = listArticulosOfertaPorcentaje.length;
        var cantOfertaPack = listArticulosOfertaPack.length;

        if (cantOfertaPorc > 0) {

            listArticulosOfertaPorcentaje = listArticulosOfertaPorcentaje.sort(function (a, b) { return a.Ofe_Id - b.Ofe_Id });

            var listOfertaPorc = uniqueBy(listArticulosOfertaPorcentaje, "Ofe_Id"); //lista de ofertas porcentaje que existe

            for (var i = 0; i < listOfertaPorc.length; i++) {//recorremos oferta por oferta

                var totalPares = 0;
                var maxPares = 0;
                var prcOfeDesc = 0.00
                var tmpListOfeArt = [];

                var listArticulosOferta = listArticulosOfertaPorcentaje.filter(obj => obj.Ofe_Id === listOfertaPorc[i]);//optenemos todos los articulos con una oferta

                for (var j = 0; j < listArticulosOferta.length; j++) {

                    var codigoArt = listArticulosOferta[j].codigoArt;

                    var PrecioArt = listArticulosOferta[j].PrecioArt;
                    maxPares = listArticulosOferta[j].Ofe_MaxPares;
                    var listaTallas = listArticulosOferta[j].listTallas;
                    prcOfeDesc = parseFloat(listArticulosOferta[j].Ofe_Porc) / 100;
                    //console.log('ver lista')
                    //console.log(listaTallas)
                    $.each(listaTallas, function (index, item) {

                        var qty = parseInt(item.CantTalla);
                        totalPares += qty;
                        var CodTalla = item.codTalla;
                        //alert('CodTalla seteado')
                        //alert(CodTalla)
                        for (var k = 0; k < qty; k++) {

                            var objArtPromocion = {
                                codigoArt: codigoArt,
                                CodTalla: CodTalla,
                                PrecioArt: PrecioArt,
                                cantidad: 1,
                                porc_comision: porcComision,
                                descuento: 0,
                                oferta: listOfertaPorc[i]
                            }
                            tmpListOfeArt.push(objArtPromocion);
                        }

                    })
                }

                var res = Math.floor(totalPares / maxPares);
                //alert('res')
                //alert(res)
                tmpListOfeArt = tmpListOfeArt.sort(function (a, b) { return a.PrecioArt - b.PrecioArt }); //ordenamos de menor a mayor precio

                if (res > 0) {

                    if (prcOfeDesc == 1) {
                        prcOfeDesc = 0.5;
                        res = 2;
                    }

                    var desc_oferta = 0.00;

                    for (var j = 0; j < res; ++j) {

                        var itmPrecio = tmpListOfeArt[j].PrecioArt;
                        var itmPrcCom = tmpListOfeArt[j].porc_comision;
                        var itmCant = tmpListOfeArt[j].cantidad;
                        var _com_mon = Math.round((itmPrecio * itmCant) * itmPrcCom * 100) / 100;
                        //alert(itmPrecio);
                        //alert(_com_mon);
                        //alert(prcOfeDesc);
                        var montoDesc = parseFloat(((itmPrecio * itmCant) - _com_mon) * (prcOfeDesc));
                        //alert(montoDesc)
                        //alert(montoDesc)
                        if ((j == 0 && maxPares > 0) || (maxPares == 1)) {
                            desc_oferta = redondearDecimal(montoDesc)
                        }

                        //desc_oferta = desc_oferta.toFixed(2);
                        //alert('descuento en el temporal')
                        //alert(desc_oferta)
                        //alert(tmpListOfeArt[j].codigoArt)
                        tmpListOfeArt[j].descuento = desc_oferta;
                    }

                    for (var j = 0; j < listArticulos.length; j++) {

                        var codigoArt = listArticulos[j].codigoArt;
                        var PrecioArt = listArticulos[j].PrecioArt;
                        var listTallaCantidad = listArticulos[j].listTallas;
                        var listdescuentoArticulo = tmpListOfeArt.filter(obj => obj.codigoArt === codigoArt);

                        for (var k = 0; k < listTallaCantidad.length; k++) {

                            var codTalla = listTallaCantidad[k].codTalla;
                            var CantTalla = listTallaCantidad[k].CantTalla;
                            var comisionTalla = listTallaCantidad[k].comisionTalla;
                            //alert('talla')
                            //alert(codTalla)
                            //console.log(listdescuentoArticulo)
                            var listdescuentoArtTalla = listdescuentoArticulo.filter(obj => obj.CodTalla === codTalla);
                            //alert(listdescuentoArtTalla.length)
                            var dscto = 0.00;

                            for (var l = 0; l < listdescuentoArtTalla.length; l++) {

                                dscto += listdescuentoArtTalla[l].descuento;

                            }
                            //alert('descuento talla')
                            //alert(dscto)
                            listTallaCantidad[k].descuentoTalla = dscto;
                            var totalTalla = redondearDecimal((CantTalla * PrecioArt) - comisionTalla - dscto);
                            listTallaCantidad[k].totalTalla = listTallaCantidad[k].totalTalla - totalTalla;
                        }

                        listArticulos[j].listTallas = listTallaCantidad;

                    }

                }

            }
        }


        //PASANDO OFERTAS TIPO PRECIO PACK
        if (cantOfertaPack > 0) {

            listArticulosOfertaPack = listArticulosOfertaPack.sort(function (a, b) { return a.Ofe_Id - b.Ofe_Id });
            //Ofe_ArtVenta
            var listOfertaPack = uniqueBy(listArticulosOfertaPack, "Ofe_Id"); //lista de ofertas pack que existe

            for (var i = 0; i < listOfertaPack.length; i++) {

                var totalPares = 0;
                var maxPares = 0;
                var prcOfeDesc = 0.00
                var tmpListOfeArt = [];
                var ofe_PrecioPack = 0.00

                var listArticulosOferta = listArticulosOfertaPack.filter(obj => obj.Ofe_Id === listOfertaPack[i]);


                for (var j = 0; j < listArticulosOferta.length; j++) {

                    var codigoArt = listArticulosOferta[j].codigoArt;

                    var PrecioArt = listArticulosOferta[j].PrecioArt;
                    maxPares = listArticulosOferta[j].Ofe_MaxPares;
                    var listaTallas = listArticulosOferta[j].listTallas;
                    prcOfeDesc = parseFloat(listArticulosOferta[j].Ofe_Porc) / 100;
                    ofe_PrecioPack = listArticulosOferta[j].Ofe_ArtVenta;
                    //console.log('ver lista')
                    //console.log(listaTallas)
                    $.each(listaTallas, function (index, item) {

                        var qty = parseInt(item.CantTalla);
                        totalPares += qty;
                        var CodTalla = item.codTalla;
                        //alert('CodTalla seteado')
                        //alert(CodTalla)
                        for (var k = 0; k < qty; k++) {

                            var objArtPromocion = {
                                codigoArt: codigoArt,
                                CodTalla: CodTalla,
                                PrecioArt: PrecioArt,
                                cantidad: 1,
                                porc_comision: porcComision,
                                descuento: 0,
                                oferta: listOfertaPack[i]
                            }
                            tmpListOfeArt.push(objArtPromocion);
                        }
                    })

                }

                var res = Math.floor(totalPares / maxPares);
                tmpListOfeArt = tmpListOfeArt.sort(function (a, b) { return a.PrecioArt - b.PrecioArt }); //ordenamos de menor a mayor precio

                if (res > 0) {

                    var totalpromocion = res * maxPares;
                    var desc_oferta = 0.00;

                    var cantColec = 0;
                    var montoColec = 0;

                    for (var j = 0; j < totalpromocion; ++j) {

                        var itmPrecio = tmpListOfeArt[j].PrecioArt;
                        var itmPrcCom = tmpListOfeArt[j].porc_comision;
                        var itmCant = tmpListOfeArt[j].cantidad;
                        var _com_mon = Math.round((itmPrecio * itmCant) * itmPrcCom * 100) / 100;

                        montoColec += (itmPrecio * itmCant) - _com_mon;
                        cantColec += itmCant;
                        //console.log('cantidad')
                        //console.log(cantColec)
                        //console.log(maxPares)
                        if (cantColec == maxPares) {
                            //console.log('entro')
                            //console.log(montoColec)

                            var TotalDesc = montoColec - ofe_PrecioPack;

                            for (var k = 0; k < cantColec; ++k) {

                                var itmPrecioPk = tmpListOfeArt[j - k].PrecioArt;//precio del articulo
                                var itmPrcComPk = tmpListOfeArt[j - k].porc_comision;//porcentaje de la comision
                                var itmCantPk = tmpListOfeArt[j - k].cantidad;//cantidad (1)
                                var _com_monPk = Math.round((itmPrecioPk * itmCantPk) * itmPrcComPk * 100) / 100;//comision
                                var totallineaPk = itmPrecioPk - _com_monPk;
                                desc_oferta = (((totallineaPk / montoColec) * TotalDesc) * 100) / 100;

                                tmpListOfeArt[j - k].descuento = redondearDecimal(desc_oferta);

                            }

                            cantColec = 0;
                            montoColec = 0;
                            desc_oferta = 0;

                        }


                    }

                    for (var j = 0; j < listArticulos.length; j++) {

                        var codigoArt = listArticulos[j].codigoArt;
                        var PrecioArt = listArticulos[j].PrecioArt;
                        var listTallaCantidad = listArticulos[j].listTallas;
                        var listdescuentoArticulo = tmpListOfeArt.filter(obj => obj.codigoArt === codigoArt);

                        for (var k = 0; k < listTallaCantidad.length; k++) {

                            var codTalla = listTallaCantidad[k].codTalla;
                            var CantTalla = listTallaCantidad[k].CantTalla;
                            var comisionTalla = listTallaCantidad[k].comisionTalla;

                            //alert('talla')
                            //alert(codTalla)
                            //console.log(listdescuentoArticulo)
                            var listdescuentoArtTalla = listdescuentoArticulo.filter(obj => obj.CodTalla === codTalla);
                            //alert(listdescuentoArtTalla.length)
                            var dscto = 0.00;

                            for (var l = 0; l < listdescuentoArtTalla.length; l++) {

                                dscto += listdescuentoArtTalla[l].descuento;

                            }
                            //alert('descuento talla')
                            //alert(dscto)
                            listTallaCantidad[k].descuentoTalla = dscto;
                            var totalTalla = redondearDecimal((CantTalla * PrecioArt) - comisionTalla - dscto);
                            listTallaCantidad[k].totalTalla = totalTalla;
                        }

                        listArticulos[j].listTallas = listTallaCantidad;

                    }




                }


            }

        }


        //for (var i = 0; i < listOfertaPorcentaje.length; i++) {

        //    alert(listOfertaPorcentaje[i].codigoArt);
        //    alert(listOfertaPorcentaje[i].PrecioArt);
        //}

        //var listArticulosOfertaPack = listArticulos.filter(obj => obj.Ofe_tipo === 'P');  //lista de articulos con ofertas tipo precio Pack
        //console.log(listOfertaPack);
        //for (var i = 0; i < listOfertaPack.length; i++) {

        //    alert(listOfertaPack[i].codigoArt);
        //    alert(listOfertaPack[i].PrecioArt);
        //}

    }

    // FIN VALIDACION DE  OFERTAS
    function redondearDecimal(numero) {
        //alert('entro')
        numero = parseFloat(numero.toFixed(6));
        //alert(numero);
        numero = parseFloat(numero.toFixed(5));
        //alert(numero);
        numero = parseFloat(numero.toFixed(4));
        //alert(numero);
        numero = parseFloat(numero.toFixed(3));
        //alert(numero);
        numero = Math.round(numero * 100) / 100
        //alert('t');
        //alert(numero);
        numero = parseFloat(numero.toFixed(2));
        //alert(numero);
        //alert('termino')

        return numero
    }

    function uniqueBy(arr, prop) {
        return arr.reduce((a, d) => {
            if (!a.includes(d[prop])) { a.push(d[prop]); }
            return a;
        }, []);
    }


    function validarAgregarLista() {

        var bValido = true;
        var cantTotal = 0;
        $('input[name="Talla"]').each(function () {

            var valor = QuitarEspacios($(this).val());
            var CantTalla = ((valor == '') ? 0 : parseInt(valor));
            cantTotal += CantTalla;

            if (CantTalla >= 0) {

                var cantStock = parseInt($(this).attr("data-id"));
                bValido = ((CantTalla > cantStock) ? false : bValido);
            } else {

                bValido = false;
            }

        });

        bValido = ((cantTotal <= 0) ? false : bValido);

        return bValido;
    }

    function recalcularCostosArticulos() {

        var CantidadTotal = 0;
        var subTOTAL = 0.00
        var porcComision = gCustomer.comision / 100;
        var montoTaxes = 0.00;
        var montoPercepcion = 0.00;
        var Total = 0.00;
        var GranTotal = 0.00;
        var apliPercepcion = 1;
        if (listArticulos != null) {

            for (var i = 0; i < listArticulos.length; i++) {

                var LinecantTotal = 0;
                var ComisionSum = 0.00;
                var PrecioArt = listArticulos[i].PrecioArt;
                var listTallasCantidad = listArticulos[i].listTallas;
                var percepcion = parseInt(listArticulos[i].AfecPercep);
                var desc = 0.00;
                apliPercepcion = ((percepcion == 0) ? 0 : parseInt(apliPercepcion));

                for (var j = 0; j < listTallasCantidad.length; j++) {

                    var CodTalla = listTallasCantidad[j].codTalla;
                    var Cantidad = listTallasCantidad[j].CantTalla;
                    var ComisionTalla = listTallasCantidad[j].comisionTalla;
                    var desctoTalla = listTallasCantidad[j].descuentoTalla;

                    LinecantTotal += Cantidad;
                    ComisionSum += ComisionTalla;
                    desc += desctoTalla;
                }

                var Comission = ComisionSum;//(((PrecioArt * LinecantTotal)) * porcComision) * 1;


                var comiss = Math.round(Comission * 100) / 100;
                var Total = Math.round(((PrecioArt * LinecantTotal) - comiss - desc) * 100) / 100;

                listArticulos[i].Comission = comiss;
                listArticulos[i].listTallas = listTallasCantidad;
                listArticulos[i].Total = Total;
                listArticulos[i].Comission = comiss;
                listArticulos[i].CantidadTotal = LinecantTotal;
                subTOTAL += Total;
            }

            subTOTAL = redondearDecimal(subTOTAL);

            var taxRate = Math.round((gCustomer.taxRate / 100) * 100) / 100;
            var Percepcion = gCustomer.percepcion;
            var AplicaPrecepcion = gCustomer.aplica_percepcion;
            montoTaxes = Math.round((subTOTAL * taxRate) * 100) / 100;
            Total = Math.round(((subTOTAL + montoTaxes) - gvalorTotalCredito) * 100) / 100;
            Total = ((Total < 0) ? 0 : Total);
            var percepcionRate = (gCustomer.aplica_percepcion) ? Math.round((gCustomer.percepcion / 100) * 100) / 100 : 0;
            montoPercepcion = Math.round(Total * percepcionRate * apliPercepcion * 100) / 100;
            GranTotal = Math.round((Total + montoPercepcion) * 100) / 100;
        }

        //alert(subTOTAL);
        //alert(montoTaxes)
        //alert(percepcionRate)
        //alert(montoPercepcion);
        gMontoPercepcion = montoPercepcion;
        gTotal = Total;
        document.getElementById("subTotalList").innerHTML = 'S/. ' + subTOTAL;
        document.getElementById("totalImpuesto").innerHTML = 'S/. ' + montoTaxes;
        document.getElementById("totalPercepcion").innerHTML = 'S/. ' + montoPercepcion;
        document.getElementById("totalNota").innerHTML = 'S/. ' + gvalorTotalCredito;

        document.getElementById("totalList").innerHTML = 'S/. ' + Total;
        document.getElementById("grantotalList").innerHTML = 'S/. ' + GranTotal;
        document.getElementById("EtiqtotalPercepcion").innerHTML = '&nbsp;<i class="fa fa-info-circle"></i>&nbsp;<b>Percepcion ' + gCustomer.percepcion + '%</b>:';

    }


    function EliminarArticuloList(codigoArticulo) {

        for (var i = 0; i < listArticulos.length; i++) {

            if (codigoArticulo == listArticulos[i].codigoArt) {
                listArticulos.splice(i, 1);
            }
        }
    }

    function VerificarExistencia(codigoArticulo) {

        var bexiste = false;

        for (var i = 0; i < listArticulos.length; i++) {

            if (codigoArticulo == listArticulos[i].codigoArt) {
                bexiste = true;
                glistTalla = listArticulos[i].listTallas;

            }
        }

        return bexiste;
    }

    function VerificarExistenciabk(codigoArticulo) {


        for (var i = 0; i < listArticulos.length; i++) {

            if (codigoArticulo == listArticulos[i].codigoArt) {

                var listTallasCantidad2 = listArticulos[i].listTallas;

                for (var j = 0; j < listTallasCantidad2.length; j++) {

                    var CodTalla = listTallasCantidad2[j].codTalla;
                    var Cantidad = listTallasCantidad2[j].CantTalla;
                    var numero = 0;
                    numero = 3
                    //alert('inpt_' + CodTalla)
                    //$('inpt_' + CodTalla).val(Cantidad);
                    //$('#' + cInput).val(valorInt);
                    $('#inpt_06').val(numero)
                    //alert($('#inpt_06').val())

                }
            }
        }

    }

    function VerificarArticuloTalla(codTalla) {

        var valor = '';

        for (var j = 0; j < glistTalla.length; j++) {

            var CodTalla = glistTalla[j].codTalla;
            if (codTalla == CodTalla) { valor = glistTalla[j].CantTalla; };
        }

        return valor;
    }

    function DibujarGrilla() {

        if (gbMovile) {

            GrillaMovil();

        } else {

            GrillaComputador();
        }
    }

    function GrillaComputador() {

        recalcularCostosArticulos();

        var strtable = '';
        var theader = '';
        var tbody = '';
        theader += '<thead>';
        theader += '<tr>';
        theader += '<th>';
        theader += '<div class="col-sm-1" style="margin-top:2px;margin-bottom:2px;">';
        theader += '<label for="disponible"></label>';
        theader += '</div>';
        theader += '</th>';
        theader += '<th>';
        theader += '<div class="col-sm-1" style="margin-top:2px;margin-bottom:2px;">';
        theader += '<label for="disponible">Referencia</label>';
        theader += '</div>';
        theader += '</th>';
        theader += '<th ' + gStyleMovile + '>';
        theader += '<div class="col-sm-1" style="margin-top:2px;margin-bottom:2px;">';
        theader += '<label for="disponible">Articulo</label>';
        theader += '</div>';
        theader += '</th>';
        theader += '<th ' + gStyleMovile + '>';
        theader += '<div class="col-sm-1" style="margin-top:2px;margin-bottom:2px;">';
        theader += '<label for="disponible">Marca</label>';
        theader += '</div>';
        theader += '</th>';
        theader += '<th ' + gStyleMovile + '>';
        theader += '<div class="col-sm-1" style="margin-top:2px;margin-bottom:2px;">';
        theader += '<label for="disponible">Color</label>';
        theader += '</div>';
        theader += '</th>';
        theader += '<th>';
        theader += '<div class="col-sm-1" style="width:100%;text-align:center;margin-top:2px;margin-bottom:2px;Text">';
        theader += '<label for="disponible">Talla/Cantidad</label>';
        theader += '</div>';
        theader += '</th>';
        theader += '<th ' + gStyleMovile + '>';
        theader += '<div class="col-sm-1" style="margin-top:2px;margin-bottom:2px;">';
        theader += ' <label for="disponible">Precio</label>';
        theader += '</div>';
        theader += '</th>';
        theader += '<th ' + gStyleMovile + '>';
        theader += '<div class="col-sm-1" style="margin-top:2px;margin-bottom:2px;">';
        theader += ' <label for="disponible">Comision</label>';
        theader += '</div>';
        theader += '</th>';
        theader += '<th ' + gStyleMovile + '>';
        theader += '<div class="col-sm-1" style="margin-top:2px;margin-bottom:2px;">';
        theader += '<label for="disponible">Descuento</label>';
        theader += '</div>';
        theader += '</th>';
        theader += '<th>';
        theader += '<div class="col-sm-1" style="margin-top:2px;margin-bottom:2px;">';
        theader += '<label for="disponible">Total</label>';
        theader += '</div>';
        theader += '</th>';
        theader += '<th>';
        theader += '<div class="col-sm-1" style="margin-top:2px;margin-bottom:2px;">';
        theader += '<label for="disponible"></label>';
        theader += '</div>';
        theader += '</th>';
        theader += '<th>';
        theader += '<div class="col-sm-1" style="margin-top:2px;margin-bottom:2px;">';
        theader += '<label for="disponible"></label>';
        theader += '</div>';
        theader += '</th>';
        theader += '</tr>';
        theader += '</thead>';

        tbody += '<td>';
        tbody += '<div class="col-sm-1" style="width:100%;margin-top:2px;margin-bottom:2px;">';
        tbody += ' <button title="Ver detalle" style="border-radius:50%" onclick="EditarDetalle(this)" class="btnEditar btn-xs btn-success" data-id="valorEdit" data-modal="" data-toggle="modal"><span class="glyphicon glyphicon-edit"></span></button>';
        tbody += '</div>';
        tbody += '</td>';
        tbody += '<td>';
        tbody += '<div class="col-sm-1" style="width:100%;margin-top:2px;margin-bottom:2px;">';
        tbody += 'Referencia';
        tbody += '</div>';
        tbody += '</td>';
        tbody += '<td ' + gStyleMovile + '>';
        tbody += '<div class="col-sm-1" style="width:100%;margin-top:2px;margin-bottom:2px;">';
        tbody += 'Articulo';
        tbody += '</div>';
        tbody += '</td>';
        tbody += '<td ' + gStyleMovile + '>';
        tbody += '<div class="col-sm-1" style="width:100%;margin-top:2px;margin-bottom:2px;">';
        tbody += 'Marca';
        tbody += '</div>';
        tbody += '</td>';
        tbody += '<td ' + gStyleMovile + '>';
        tbody += '<div class="col-sm-1" style="width:100%;margin-top:2px;margin-bottom:2px;">';
        tbody += 'Color';
        tbody += '</div>';
        tbody += '</td>';
        tbody += '<td>';
        tbody += '<div class="col-sm-1" style="width:100%;margin-top:2px;margin-bottom:2px;text-align:center;">';
        tbody += '<table><tr><td><div style="margin-top:2px;margin-right:2px;"><button class="btn btn-white btn-xs"  title="Tallas"  style="width:100%;">T:</button></div></td><td><div style="margin-top:2px;margin-right:2px;"><button class="btn btn-success btn-xs" style="width:100%;">Total</button></div></td>ListvariableTalla</tr><tr><td><div style="margin-top:2px;margin-right:2px;"><button  title="Cantidad"  class="btn btn-white btn-xs" style="width:100%;">C:</button></div></td></td><td><div style="margin-top:2px;margin-right:2px;"><button class="btn btn-success btn-xs" style="width:100%;">VTotal</button></div></td>ListvariableCantidad</tr></table>'
        tbody += '</div>';
        tbody += '</td>';
        tbody += '<td ' + gStyleMovile + '>';
        tbody += '<div class="col-sm-1" style="width:100%;margin-top:2px;margin-bottom:2px;">';
        tbody += 'Precio';
        tbody += '</div>';
        tbody += '</td>';
        tbody += '<td ' + gStyleMovile + '>';
        tbody += '<div class="col-sm-1" style="width:100%;margin-top:2px;margin-bottom:2px;">';
        tbody += 'Comision';
        tbody += '</div>';
        tbody += '</td>';
        tbody += '<td ' + gStyleMovile + '>';
        tbody += '<div class="col-sm-1" style="width:100%;margin-top:2px;margin-bottom:2px;">';
        tbody += 'Descuento';
        tbody += '</div>';
        tbody += '</td>';
        tbody += '<td>';
        tbody += '<div class="col-sm-1" style="width:100%;margin-top:2px;margin-bottom:2px;">';
        tbody += 'TotalM';
        tbody += '</div>';
        tbody += '</td>';
        tbody += '<td>';
        tbody += '<div class="col-sm-1" style="width:100%;margin-top:2px;margin-bottom:2px;">';
        tbody += ' <button title="Ver detalle" style="border-radius:50%" onclick="verDetalle(this)" class="btnEditar btn-xs btn-primary" data-id="valorBoton" data-modal="" data-toggle="modal"><span class="glyphicon glyphicon-info-sign blue"></span></button>';
        tbody += '</div>';
        tbody += '</td>';
        tbody += '<td>';
        tbody += '<div class="col-sm-1" style="width:100%;margin-top:2px;margin-bottom:2px;">';
        tbody += ' <button title="Eliminar detalle" style="border-radius:50%" onclick="PopupEliminar(this)" class="btnEliminar btn-xs btn-danger" data-id="valorDelete" data-modal="" data-toggle="modal"><span class="glyphicon glyphicon-remove" "></span></button>';
        tbody += '</div>';
        tbody += '</td>';
        tbody += '</tr>';

        var Body = '';

        var ConstTalla = '<td><div style="margin-top:2px;margin-right:2px;"><button class="btn btn-primary btn-xs"  style="width:100%;" title="Talla"  data-id="codTienda" data-tda="desTiendaS" data-modal="codTalla" data-art="codArticulo"  >variableTalla</button></div></td>'
        var ConstCantidad = '<td><div style="margin-top:2px;margin-right:2px;"><button class="btn btn-info btn-xs" style="width:100%;text-align:center;">variableCantidad</button></div></td>'
        var listTalla = '';
        var listCantidad = '';

        if (listArticulos != null) {
            for (var i = 0; i < listArticulos.length; i++) {
                var temrBody = tbody
                temrBody = temrBody.replace("Referencia", listArticulos[i].codigoArt);
                temrBody = temrBody.replace("Articulo", listArticulos[i].DescriArt);
                temrBody = temrBody.replace("valorBoton", listArticulos[i].codigoArt);
                temrBody = temrBody.replace("valorEdit", listArticulos[i].codigoArt);
                temrBody = temrBody.replace("valorDelete", listArticulos[i].codigoArt);
                temrBody = temrBody.replace("Marca", listArticulos[i].MarcaArt);
                temrBody = temrBody.replace("Color", listArticulos[i].ColorArt);
                temrBody = temrBody.replace("Precio", 'S/. ' + listArticulos[i].PrecioArt);
                //temrBody = temrBody.replace("Comision", listArticulos[i].Comission);
                //temrBody = temrBody.replace("TotalM", listArticulos[i].Total);

                var listTallasCantidad2 = listArticulos[i].listTallas;
                listTalla = '';
                listCantidad = '';
                var total = 0;
                var comisionTotalLine = 0.00;
                var TotalLine = 0.00;
                var descuentoArticulo = 0.00;
                for (var j = 0; j < listTallasCantidad2.length; j++) {

                    var talla = listTallasCantidad2[j].codTalla;
                    var cantidad = listTallasCantidad2[j].CantTalla;
                    var comisionTalla = listTallasCantidad2[j].comisionTalla;
                    var totalTalla = listTallasCantidad2[j].totalTalla;
                    var dsctoTalla = listTallasCantidad2[j].descuentoTalla;
                    //console.log('comision Talla')
                    //console.log(comisionTalla)
                    total += parseInt(cantidad);
                    descuentoArticulo += dsctoTalla;

                    listTalla += ConstTalla;
                    listCantidad += ConstCantidad;
                    //console.log('comision total ini  ')
                    //console.log(comisionTotalLine)
                    comisionTotalLine = Math.round((comisionTotalLine + comisionTalla) * 100) / 100;
                    //console.log('comision total fin  ')
                    //console.log(comisionTotalLine)
                    TotalLine = Math.round((TotalLine + totalTalla) * 100) / 100;;

                    listTalla = listTalla.replace("variableTalla", talla);
                    listCantidad = listCantidad.replace("variableCantidad", cantidad);

                }

                //temrBody = temrBody.replace("Descuento", listArticulos[i].Descuento);
                temrBody = temrBody.replace("Descuento", 'S/. ' + descuentoArticulo);

                //console.log('comision total line ')
                //console.log(comisionTotalLine)

                temrBody = temrBody.replace("Comision", 'S/. ' + comisionTotalLine);
                temrBody = temrBody.replace("TotalM", 'S/. ' + TotalLine);

                temrBody = temrBody.replace("VTotal", total);
                temrBody = temrBody.replace("ListvariableTalla", listTalla);
                temrBody = temrBody.replace("ListvariableCantidad", listCantidad);

                Body += temrBody;
            }

            //for (var i = 0; i < listArticulos.length; i++) {

            //    var listTallasCantidad2 = listArticulos[i].listTallas;

            //    for (var j = 0; j < listTallasCantidad2.length; j++) {
            //        alert(listTallasCantidad2[j].codTalla)
            //        alert(listTallasCantidad2[j].CantTalla)
            //    }
            //}

            strtable = '<table style="width:100%;">' + theader + '<tbody>' + Body + '</tbody>' + '</table>';
        }
        document.getElementById("divDetalleVenta").innerHTML = strtable;

    }

    function verDetalle(control) {
        var codArticulo = $(control).attr('data-id');
        DibujarDetalleArticulo(codArticulo);

    }

    function PopupEliminar(control) {
        var codArticulo = $(control).attr('data-id');

        var strhtml = ''

        strhtml += '<div class="modal-header modal-header-danger" style="margin-top:0px;margin-bottom:0px;padding-top:2px;padding-bottom:2px;">'
        strhtml += '<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>'
        strhtml += '<h5 class="modal-title" id="myModalLabel">'
        strhtml += '<table style="border-bottom:0px;font-size:14px;width:50%;">'
        strhtml += '<tr>'
        strhtml += '<td style="font-size:14px;width:100%;text-align:left;">Articulo:&nbsp;&nbsp;' + codArticulo + '</td>'
        strhtml += '</tr>'
        strhtml += '</table>'
        strhtml += '</h5>'
        strhtml += '</div>'
        strhtml += '<div class="modal-body">'
        strhtml += 'Desea eliminar al articulo: ' + codArticulo + '?'
        strhtml += '</div>'
        strhtml += '<div class="modal-footer" style="margin-top:-30px">'
        strhtml += '<button type="button" class="btn btn-default" data-dismiss="modal">Cerrar</button>'
        strhtml += '<button type="button" class="btn btn-danger"  onclick="EliminarDetalle(this)"  data-id="' + codArticulo + '"  data-dismiss="modal">Eliminar</button>'
        //strhtml += ' <button type="button"  title="Eliminar class="btn btn-danger" data-dismiss="modal" detalle" onclick="EliminarDetalle(this)"  data-id="' + codArticulo + '" data-modal="" data-toggle="modal">Elimninar</button>';
        //strhtml += '<input type="submit" class="btn btn-primary" onclick="agregarLista()"  id="btnSubmit" value="Agregar" />'
        strhtml += '</div>'
        var options = { "backdrop": "static", keyboard: true };

        $('#myModalContent').html(strhtml);
        $('#myModal').modal(options);
        $('#myModal').modal('show');

    }

    function ValidacionLiquidacion() {

        var bValidacion = true;
        var varLocalPercep;

        /*validacion de que no esisten ningun articulo*/

        if (listArticulos == null || listArticulos == '') {
            bValidacion = false;
            toastr.error("Debe ingresar al menos un articulo en el pedido.", "Error");
            /*fin de la validacion de que no existe articulo*/

        } else {

            for (var i = 0; i < listArticulos.length; i++) {

                if (i == 0) { varLocalPercep = parseInt(listArticulos[i].AfecPercep) }

                if (varLocalPercep != parseInt(listArticulos[i].AfecPercep)) {

                    toastr.error("No puede liquidar articulos con percepcion y sin percepción a la vez.", "Error");
                    bValidacion = false;
                    break;
                }

            }
        }

        return bValidacion;
    }

    function PopupLiquidarPedido() {

        if (ValidacionLiquidacion()) {
            var strhtml = ''
            strhtml += '<div class="modal-header modal-header-danger" style="margin-top:0px;margin-bottom:0px;padding-top:2px;padding-bottom:2px;">'
            strhtml += '<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>'
            strhtml += '<h5 class="modal-title" id="myModalLabel">'
            strhtml += '<table style="border-bottom:0px;font-size:14px;width:50%;">'
            strhtml += '<tr>'
            strhtml += '<td style="font-size:14px;width:100%;text-align:left;">Confirmación de Liquidación</td>'
            strhtml += '</tr>'
            strhtml += '</table>'
            strhtml += '</h5>'
            strhtml += '</div>'
            strhtml += '<div class="modal-body">'
            strhtml += 'Desea liquidar el pedido ?.'
            strhtml += '</div>'
            strhtml += '<div class="modal-footer" style="margin-top:-30px">'
            strhtml += '<button type="button" class="btn btn-default" data-dismiss="modal">Cancelar</button>'
            strhtml += '<button type="button" class="btn btn-primary"  onclick="liquidarPedido()"   data-dismiss="modal">Liquidar Pedido</button>'
            //strhtml += ' <button type="button"  title="Eliminar class="btn btn-danger" data-dismiss="modal" detalle" onclick="EliminarDetalle(this)"  data-id="' + codArticulo + '" data-modal="" data-toggle="modal">Elimninar</button>';
            //strhtml += '<input type="submit" class="btn btn-primary" onclick="agregarLista()"  id="btnSubmit" value="Agregar" />'
            strhtml += '</div>'
            var options = { "backdrop": "static", keyboard: true };

            $('#myModalContent').html(strhtml);
            $('#myModal').modal(options);
            $('#myModal').modal('show');
        }

    }

    function PopupEliminarTalla(control) {
        var codArticulo = $(control).attr('data-id');
        var codTalla = $(control).attr('data-modal');

        var strhtml = ''

        strhtml += '<div class="modal-header modal-header-danger" style="margin-top:0px;margin-bottom:0px;padding-top:2px;padding-bottom:2px;">'
        strhtml += '<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>'
        strhtml += '<h5 class="modal-title" id="myModalLabel">'
        strhtml += '<table style="border-bottom:0px;font-size:14px;width:50%;">'
        strhtml += '<tr>'
        strhtml += '<td style="font-size:14px;width:100%;text-align:left;">Articulo:&nbsp;&nbsp;' + codArticulo + '</td>'
        strhtml += '</tr>'
        strhtml += '</table>'
        strhtml += '</h5>'
        strhtml += '</div>'
        strhtml += '<div class="modal-body">'
        strhtml += 'Desea eliminar la talla ' + codTalla + ' del articulo: ' + codArticulo + '?'
        strhtml += '</div>'
        strhtml += '<div class="modal-footer" style="margin-top:-30px">'
        strhtml += '<button type="button" class="btn btn-default" data-dismiss="modal">Cerrar</button>'
        strhtml += '<button type="button" class="btn btn-danger"  onclick="EliminarDetalleTalla(this)"  data-id="' + codArticulo + '" data-talla="' + codTalla + '"  data-dismiss="modal">Eliminar</button>'
        //strhtml += ' <button type="button"  title="Eliminar class="btn btn-danger" data-dismiss="modal" detalle" onclick="EliminarDetalle(this)"  data-id="' + codArticulo + '" data-modal="" data-toggle="modal">Elimninar</button>';
        //strhtml += '<input type="submit" class="btn btn-primary" onclick="agregarLista()"  id="btnSubmit" value="Agregar" />'
        strhtml += '</div>'
        var options = { "backdrop": "static", keyboard: true };

        $('#myModalContent').html(strhtml);
        $('#myModal').modal(options);
        $('#myModal').modal('show');

    }

    function EliminarDetalle(control) {
        var codArticulo = $(control).attr('data-id');
        EliminarArticuloList(codArticulo);
        DibujarGrilla();
        toastr.success("El articulo se elimino del pedido.", 'Mensaje');

    }

    function EliminarDetalleTalla(control) {
        var codArticulo = $(control).attr('data-id');
        var codTalla = $(control).attr('data-talla');
        EliminarArticuloTallaList(codArticulo, codTalla);
        recalcularCostosArticulos()
        DibujarGrilla();
        toastr.success("La talla se elimino del pedido.", 'Mensaje');
    }

    function EliminarArticuloTallaList(codigoArticulo, CodTalla) {

        for (var i = 0; i < listArticulos.length; i++) {

            if (codigoArticulo == listArticulos[i].codigoArt) {

                var listTallasCantidad2 = listArticulos[i].listTallas;

                for (var j = 0; j < listTallasCantidad2.length; j++) {

                    if (CodTalla = listTallasCantidad2[j].codTalla) {

                        listTallasCantidad2.splice(j, 1);
                        listArticulos[i].listTallas = listTallasCantidad2;
                        break;
                    }

                }
                break;
            }
        }
    }

    function DibujarDetalleArticulo(codArticulo) {


        var border2 = 'padding: 5px 5px 5px 5px;border:2px';
        var espacio = '&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;';
        var css = 'class="row"';
        var ConstTalla = '<td><div style="margin-top:2px;margin-right:2px;"><button class="btn btn-white btn-xs" style="width:100%;">variableTalla</button></div></td>'
        var BotonSuma = '<button title="Sumar Cantidad" class="btnSuma btn btn-success" onclick="sumarCantidad(this)" data-id="IdArticuloTallaS" data-modal="Sstock" data-toggle="modal"><span class="glyphicon glyphicon-plus"></span></button>'
        var BotonResta = '<button title="Restar Cantidad" class="btnResta btn btn-danger" onclick="restarCantidad(this)" data-id="IdArticuloTallaR" data-modal="Rstock" data-toggle="modal"><span class="glyphicon glyphicon-minus"></span></button>'
        var InputCantidadTalla = '<input id="inpArtTalla" type="Text"  name="Talla" value="valor" placeholder="cantidad" onchange = "validarStock(this)" data-id="inpStock" style="width:100%;" autofocus="" class="form-control"/>'
        var ConstHtmlDetalleTallas = '<br/><div id="listatallas" style="background:#FFFFFF;' + border2 + '" ><div ' + css + '  style="background:#FFFFFF;" ><div class="col-sm-12"><i class="fa fa-info-circle"></i>&nbsp;<b>Tallas y Cantidades</b><br/></div><div class="col-sm-12">ListaTallas</div><br/></div></div>';
        var ConstHtmlDetalle = '<br/><div id="lugar" style="background:#FFFFFF;' + border2 + '" ><div ' + css + '  style="background:#FFFFFF;" ><div class="col-sm-12"><table style="width:100%">Cantidad&nbsp;Precio&nbsp;Comision&nbsp;Descuento&nbsp;Total</table></div><br/></div></div>';

        var strTablaTallas = '<table><tr><td><div style="margin-top:2px;margin-right:2px;"><button class="btn btn-white btn-xs"  title="Tallas"  style="width:100%;">Tallas:</button></div></td><td><div style="margin-top:2px;margin-right:2px;"><button class="btn btn-success btn-xs" style="width:100%;">Total</button></div></td>ListvariableTalla</tr><tr><td><div style="margin-top:2px;margin-right:2px;"><button  title="Cantidad"  class="btn btn-white btn-xs" style="width:100%;">Cantidad:</button></div></td></td><td><div style="margin-top:2px;margin-right:2px;"><button class="btn btn-success btn-xs" style="width:100%;">VTotal</button></div></td>ListvariableCantidad</tr></table>'
        var ConstTalla = '<td><div style="margin-top:2px;margin-right:2px;"><button class="btn btn-primary btn-xs"  style="width:100%;" title="Talla"  data-id="codTienda" data-tda="desTiendaS" data-modal="codTalla" data-art="codArticulo"  >variableTalla</button></div></td>'
        var ConstCantidad = '<td><div style="margin-top:2px;margin-right:2px;"><button class="btn btn-info btn-xs" style="width:100%;text-align:center;">variableCantidad</button></div></td>'

        var listTalla = '';
        var listCantidad = '';
        var divFinal = '';
        var strUrlImagen = '';
        var codTienda = ''
        var consTienda = ''
        var Precio = 0.00;
        var Comision = 0.00;
        var Descuento = 0.00;
        var Total = 0.00;
        var urlImagenSusti = '';
        var DireccionTienda = '';
        var CodTalla = '';
        var cantidad = '';

        var NombreArticulo = '';
        var MarcaArticulo = '';
        var ColorArticulo = '';
        var CategoriArticulo = '';
        var PrecioSinIgv = '';
        var stock = '';


        $.each(listArticulos, function (index, item) {

            if (codArticulo == item.codigoArt) {

                strUrlImagen = item.strUrlImagen
                NombreArticulo = item.DescriArt
                MarcaArticulo = item.MarcaArt
                ColorArticulo = item.ColorArt
                PrecioSinIgv = item.PrecioArt
                CategoriArticulo = item.Cat_Pri_Descripcion + ' > ' + item.Cat_Descripcion

                var strhtml = ConstHtmlDetalle;
                var strhtmlTallas = ConstHtmlDetalleTallas
                var strIni = '<tr><td><p>&nbsp;<i class="fa fa-check-circle"></i>&nbsp;<b>';
                var strIniTotal = '<tr><td><p>&nbsp;<i class="fa fa-info-circle"></i>&nbsp;<b>';
                var strMedio = '</b></p></td><td valign="top" style="padding:0; margin:0;text-align:right">&nbsp;&nbsp;'
                var strFin = '</td></tr>';

                var strCantidad = strIni + 'Cantidad:' + strMedio + item.CantidadTotal + strFin;
                var strPrecio = strIni + 'Precio:' + strMedio + item.PrecioArt + strFin;
                var strComision = strIni + 'Comision:' + strMedio + item.Comission + strFin;

                var strTotal = strIniTotal + 'TOTAL:' + strMedio + '<b>' + item.Total + strFin;

                strhtml = strhtml.replace("Cantidad", strCantidad);
                strhtml = strhtml.replace("Precio", strPrecio);
                strhtml = strhtml.replace("Comision", strComision);

                strhtml = strhtml.replace("Total", strTotal);

                var listTallasCantidad2 = item.listTallas;
                var total = 0;
                var totalDescuento = 0.00;

                for (var j = 0; j < listTallasCantidad2.length; j++) {

                    var talla = listTallasCantidad2[j].codTalla;
                    var cantidad = listTallasCantidad2[j].CantTalla;
                    var descuen = listTallasCantidad2[j].descuentoTalla;

                    totalDescuento += descuen;
                    total += parseInt(cantidad);
                    listTalla += ConstTalla;
                    listCantidad += ConstCantidad;

                    listTalla = listTalla.replace("variableTalla", talla);
                    listCantidad = listCantidad.replace("variableCantidad", cantidad);

                }
                var strDescuento = strIni + 'Descuento:' + strMedio + totalDescuento + strFin;
                strhtml = strhtml.replace("Descuento", strDescuento);

                strTablaTallas = strTablaTallas.replace("VTotal", total);
                strTablaTallas = strTablaTallas.replace("ListvariableTalla", listTalla);
                strTablaTallas = strTablaTallas.replace("ListvariableCantidad", listCantidad);
                strhtmlTallas = strhtmlTallas.replace("ListaTallas", strTablaTallas);

                divFinal += strhtmlTallas
                divFinal += strhtml;
            }

        });


        var strhtml = ''
        var pOcu = "ocultarDivFast('tdImagen');mostrarDivFast('bverP'); ocultarDivFast('bocuP')"
        var pVer = "mostrarDivFast('tdImagen');ocultarDivFast('bverP'); mostrarDivFast('bocuP')"

        strhtml += '<div class="modal-header modal-header-danger" style="margin-top:0px;margin-bottom:0px;padding-top:2px;padding-bottom:2px;">'
        strhtml += '<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>'
        strhtml += '<h5 class="modal-title" id="myModalLabel">'
        strhtml += '<table style="border-bottom:0px;font-size:14px;width:100%;">'
        strhtml += '<tr>'
        strhtml += '<td style="font-size:14px;width:5%;text-align:left;">'
        strhtml += '<span id="bocuP" onclick ="' + pOcu + '"  class="glyphicon glyphicon-eye-close"></span>'
        strhtml += '<span id="bverP" onclick ="' + pVer + '" style="display:none" class="glyphicon glyphicon-picture"></span>'
        strhtml += '</td>'
        strhtml += '<td style="font-size:14px;width:90%;text-align:left;">Articulo:&nbsp;&nbsp;' + codArticulo + '&nbsp;&nbsp;-&nbsp;&nbsp;Precio:&nbsp;&nbsp;S/&nbsp;&nbsp;' + PrecioSinIgv + '</td>'
        strhtml += '</tr>'
        strhtml += '</table>'
        strhtml += '</h5>'
        strhtml += '</div>'
        strhtml += '<div class="modal-body">'
        strhtml += '<table id="example" class="table table-hover dataTable  table-striped table-responsive">'
        strhtml += '<tbody>'
        strhtml += '<tr>'
        strhtml += '<td Id="tdImagen"style="background:#FFFFFF;width:30%;vertical-align:middle;border: 1px solid;border-color:gainsboro">'
        strhtml += '<div Id="DivgImagen">'
        strhtml += '<div id="DivNombre" style="text-align:center;"><h5><b>' + NombreArticulo + '</b></h5></div><br/>'
        strhtml += '<div id="DivImagen" style="text-align:center;">'
        strhtml += '<img id="imagenCatalogo" class="imgRedonda" src="' + strUrlImagen + '" width="100%" height="100%" />'
        strhtml += '</div><br/>'
        strhtml += '<div id="DivPrecio" style="text-align:left"><table style="width:100%" ><tr><td style="width:50%" ><div style="width:100%" ><h5><b>Precio:&nbsp;&nbsp;</b></h5></div></td><td><div style="width:100%;color:#FF0000"><h5><b>S/&nbsp;&nbsp;' + PrecioSinIgv + '</b></h5></div></td></tr></table></div>'
        strhtml += '<div id="DivMarca" style="text-align:left"><h5><b>Marca:&nbsp;&nbsp;</b>' + MarcaArticulo + '</h5></div>'
        strhtml += '<div id="DivColor" style="text-align:left"><h5><b>Color:&nbsp;&nbsp;</b>' + ColorArticulo + '</h5></div>'
        strhtml += '<div id="DivCateg" style="text-align:left"><h5><b>Categorización:</b></h5></div>'

        strhtml += '</div>'
        strhtml += '</td>'
        strhtml += '<td>'
        strhtml += '<div id="listTalla" style="overflow-x: hidden; overflow-y:auto; height: 378px;">'
        strhtml += divFinal
        strhtml += '</div>'
        strhtml += '</td>'
        strhtml += '</tr>'
        strhtml += '</tbody>'
        strhtml += '</table>'
        strhtml += '</div>'
        strhtml += '<div class="modal-footer" style="margin-top:-30px">'
        strhtml += '<button type="button" class="btn btn-default" data-dismiss="modal">Cerrar</button>'
        strhtml += '</div>'
        var options = { "backdrop": "static", keyboard: true };

        $('#myModalContent').html(strhtml);
        $('#myModal').modal(options);
        $('#myModal').modal('show');


    }

    function restarCantidad(control) {

        var Cod = control.getAttribute('data-id');
        var cInput = 'inpt_' + Cod;
        var valor = $('#' + cInput).val();
        var valorInt = 0;
        var msjAlert = "";
        valorInt = ((BorrarEspacio(valor) == '') ? (msjAlert += 'Fecha Nacimiento.<br/>', 0) : parseInt(valor) - 1);
        valorInt = ((valorInt <= 0) ? (0) : valorInt);
        $('#' + cInput).val(valorInt);
    }

    function validarStock(control) {

        var cInput = control.getAttribute('Id');
        var valor = (($('#' + cInput).val() == '') ? (0) : parseInt($('#' + cInput).val()));;
        var stock = parseInt(control.getAttribute('data-id'));
        if (valor > stock) {
            //$('#' + cInput).val(stock);
            toastr.error("Valor mayor que el Stock.", "Error");
        }
        if (valor < 0) { $('#' + cInput).val(0); toastr.error("Valor menor que cero.", "Error"); }

    }

    function ocultarDiv(divId) {

        $("#" + divId).hide("slow");
    }

    function mostrarDiv(divId) {

        $("#" + divId).show("slow");
    }

    function ocultarDivFast(divId) {

        $("#" + divId).hide();
    }

    function mostrarDivFast(divId) {

        $("#" + divId).show();
    }

    function BorrarEspacio(cadena) {
        cadena = cadena.replace(/ /g, "")
        return cadena;
    }

    //LIQUIDACION DEL PEDIDO

    function PrepararPedido() {


        var OrderDTL = {
            _code: '',
            _artName: '',
            _brand: '',//marca
            _brandImg: '',
            _color: '',
            _size: '',
            _qty: 0,
            _qtyCancel: 0,
            _majorCat: '',
            _cat: '',
            _subcat: '',
            _origin: '',
            _originDesc: '',
            _comm: '',
            _uriPhoto: '',
            _price: 0.00,
            _priceigv: 0.00,
            _priceDesc: '',
            _priceigvDesc: '',
            _commission: 0.00,
            _commissionigv: 0.00,
            _det_dcto_sigv: 0.00,
            _commissionPctg: 0.00,
            _commissionDesc: '',
            _commissionigvDesc: '',
            _dscto: 0.00,
            _dsctoDesc: '',
            _dsctoPerc: 0.00,
            _dsctoVale: 0.00,
            _dsctoValeDesc: '',
            _dsctoMsg: '',
            _lineTotal: 0.00,
            _lineTotDesc: '',
            _ap_percepcion: '',
            _ofe_Tipo: '',
            _ofe_PrecioPack: 0.00,
            _ofe_id: 0.00,
            _ofe_maxpares: 0.00,
            _ofe_porc: 0.00,
            _units: 0,
            _premio: '',
            _premioDesc: '',
            _premId: ''
        }

        //var orderDtlTemp={
        //    articulo:'',
        //    cantidad:0,
        //    items: 0,
        //    premId: null,
        //    premio: "N",
        //    talla:""
        //}glistOtderDtl

        glistOtderDtlTem = [];
        glistOtderDtl = [];

        var CantidadTotal = 0;
        var subTOTAL = 0.00
        var porcComision = gCustomer.comision / 100;
        var ComisionSum = 0.00;
        var nroItem = 0;
        for (var i = 0; i < listArticulos.length; i++) {

            var LinecantTotal = 0;
            var articulo = listArticulos[i].codigoArt;
            var PrecioArt = listArticulos[i].PrecioArt;
            var listTallasCantidad = listArticulos[i].listTallas;
            var ofe_Id = listArticulos[i].Ofe_Id;
            var Ofe_MaxPares = listArticulos[i].Ofe_MaxPares;
            var Ofe_Porc = listArticulos[i].Ofe_Porc;
            var Ofe_ArtVenta = listArticulos[i].Ofe_ArtVenta;
            //alert(PrecioArt)

            for (var j = 0; j < listTallasCantidad.length; j++) {

                nroItem++;

                var CodTalla = listTallasCantidad[j].codTalla;
                var Cantidad = parseInt(listTallasCantidad[j].CantTalla);
                var comisionTalla = listTallasCantidad[j].comisionTalla;
                var Comission = Math.round((((PrecioArt * Cantidad)) * porcComision) * 100) / 100;
                var DescuentoTalla = listTallasCantidad[j].descuentoTalla;


                var lineOrderDTL = {

                    _code: articulo,
                    _size: CodTalla,
                    _qty: Cantidad,
                    _price: PrecioArt,
                    _commissionPctg: porcComision,
                    _commission: Comission,
                    _ofe_porc: Ofe_Porc,
                    _dscto: DescuentoTalla,
                    _ofe_id: ofe_Id,
                    _premId: null
                }

                var orderDtlTemp = {
                    articulo: articulo,
                    cantidad: Cantidad,
                    items: nroItem,
                    premId: null,
                    premio: "N",
                    talla: CodTalla
                }

                glistOtderDtl.push(lineOrderDTL);
                glistOtderDtlTem.push(orderDtlTemp);

            }

            //var Comission = ComisionSum;//(((PrecioArt * LinecantTotal)) * porcComision) * 1;
            //var desc = 0;

            //var comiss = Math.round(Comission * 100) / 100;
            //var Total = Math.round(((PrecioArt * LinecantTotal) - comiss - desc) * 100) / 100;

            //listArticulos[i].Comission = comiss;
            //listArticulos[i].listTallas = listTallasCantidad;
            //listArticulos[i].Total = Total;
            //listArticulos[i].Comission = comiss;
            //listArticulos[i].CantidadTotal = LinecantTotal;
            //subTOTAL += Total;
        }

    }

    function liquidarPedido() {
        PrepararPedido();
        //alert(glistOtderDtlTem[0].articulo);
        var formaPago = $('#dwFormaPago').val();

        var objPedidoLiquidar = {
            _usu: 5,
            _idCust: gCustomer.idCust,
            _reference: "",
            _discCommPctg: gCustomer.comision,//20
            _discCommValue: 0, //0
            _shipTo: "",//""
            _specialInstr: "",//""
            _itemsDetail: glistOtderDtl,// list _itemsDetail
            _varpercepcion: gMontoPercepcion,//0.80 monto de la percepcion
            _estado: gEstado,//1
            _ped_id: gPedId,//""
            _liq: gLiqId,//""
            _liq_dir: 0,//0
            _PagPos: 0,//0
            _PagoPostarjeta: "",//""
            _PagoNumConsignacion: "",//""
            _PagoTotal: 0,//0
            //dtpago: null,
            ListPago: glistPago,
            _pago_credito: false,//false
            _porc_percepcion: gCustomer.percepcion,//2
            order_dtl_temp: glistOtderDtlTem,
            strTipoPago: formaPago,//005 deposito banco
        }

        $.ajax
          ({
              url: '../Pedido/LiquidarPedido',
              dataType: "json",
              type: "POST",
              data: objPedidoLiquidar,
              success: function (data, textStatus, XMLHttpRequest) {
                  waitingDialog.hide();

                  if ((data.Success).toString() == "true") {

                      if (gEstado == "1") {
                          toastr.success("Se liquidó el pedido con éxito. Nro: " + data.Message + ".", "Mensaje");
                          limpiarCampos();
                      }

                      if (gEstado == "2") {
                          toastr.success("Se modifico la liquidació con éxito. Nro: " + data.Message + ".", "Mensaje");

                      }



                  } else {
                      toastr.error("Se al liquidar el pedido.", "Error");
                  }

              },
              error: function (xhr) {
                  waitingDialog.hide();
                  toastr.error(xhr, 'Error');
              }
          })

    }

    function limpiarCampos() {
        listArticulos = null;
        DibujarGrilla();
    }
    //FIN LIQUIDACION DEL PEDIDO

    //FUNCIONES QUE PASAN CON UN DISPOSITIVO MOVIL


    function GrillaMovil() {


        var border2 = 'border:2px';
        var espacio = '&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;';
        var butonDelete = '<div class="col-sm-1" style="width:100%;margin-top:2px;margin-bottom:2px;">';
        butonDelete += ' <button title="Eliminar detalle" style="border-radius:50%" onclick="PopupEliminarTalla(this)" class="btnEliminar btn-xs btn-danger" data-id="valorArticuloDelete" data-modal="valorTallaDelete" data-toggle="modal"><span class="glyphicon glyphicon-remove" "></span></button>';
        butonDelete += '</div>';
        var strImg = '<td Id="tdImagenGR"style="background:#FFFFFF;width:20%;vertical-align:middle;">'
        strImg += '<div Id="DivgImagen">'
        strImg += '<div id="DivImagen" style="text-align:center;">'
        strImg += '<img id="imagenCatalogo" class="imgRedonda" src="DireccionImagen" width="100%" height="100%" />'
        strImg += '</div>'
        strImg += '</div>'
        strImg += '</td>'
        var css = 'class="row"';
        var ConstTalla = '<td><div style="margin-top:2px;margin-right:2px;"><button class="btn btn-white btn-xs" style="width:100%;">variableTalla</button></div></td>'
        var BotonSuma = '<button title="Sumar Cantidad" class="btnSuma btn btn-white btn-xs" onclick="sumarCantidadMovil(this)" data-id="IdArticuloTallaS"  data-art="IdArticuloCodS" data-modal="Sstock" data-toggle="modal"><span class="glyphicon glyphicon-plus"></span></button>'
        var BotonResta = '<button title="Restar Cantidad" class="btnResta btn btn-white btn-xs" onclick="restarCantidadMovil(this)" data-id="IdArticuloTallaR" data-art="IdArticuloCodR" data-modal="Rstock" data-toggle="modal"><span class="glyphicon glyphicon-minus"></span></button>'
        var InputCantidadTalla = '<input id="inpArtTalla" type="Text"  value="valorInp" style="width:100%;" autofocus="" class="form-control"/>'
        var ConstHtmlDetalleTallas = '<br/><div id="listatallas" style="background:#FFFFFF;' + border2 + '" ><div ' + css + '  style="background:#FFFFFF;" ><div class="col-sm-12"><i class="fa fa-info-circle"></i>&nbsp;<b>Tallas y Cantidades</b><br/></div><div class="col-sm-12">ListaTallas</div><br/></div></div>';
        var ConstHtmlDetalle = '<div id="lugar" style="background:#FFFFFF;' + border2 + '" ><div ' + css + '  style="background:#FFFFFF;" ><div class="col-sm-12"><table style="width:100%;border: 1px solid;border-color:gainsboro"><tr><td>' + strImg + '</td><td><table style="width:100%">Nombre&nbsp;Codigo&nbsp;Marca&nbsp;Color&nbsp;Talla&nbsp;Precio&nbsp;CDantidad&nbsp;Cantidad</table></td></tr></table></div></div></div>';

        var strTablaTallas = '<table><tr><td><div style="margin-top:2px;margin-right:2px;"><button class="btn btn-white btn-xs"  title="Tallas"  style="width:100%;">Tallas:</button></div></td><td><div style="margin-top:2px;margin-right:2px;"><button class="btn btn-success btn-xs" style="width:100%;">Total</button></div></td>ListvariableTalla</tr><tr><td><div style="margin-top:2px;margin-right:2px;"><button  title="Cantidad"  class="btn btn-white btn-xs" style="width:100%;">Cantidad:</button></div></td></td><td><div style="margin-top:2px;margin-right:2px;"><button class="btn btn-success btn-xs" style="width:100%;">VTotal</button></div></td>ListvariableCantidad</tr></table>'
        var ConstTalla = '<td><div style="margin-top:2px;margin-right:2px;"><button class="btn btn-primary btn-xs"  style="width:100%;" title="Talla"  data-id="codTienda" data-tda="desTiendaS" data-modal="codTalla" data-art="codArticulo"  >variableTalla</button></div></td>'
        var ConstCantidad = '<td><div style="margin-top:2px;margin-right:2px;"><button class="btn btn-info btn-xs" style="width:100%;text-align:center;">variableCantidad</button></div></td>'

        var listTalla = '';
        var listCantidad = '';
        var divFinal = '';
        var strUrlImagen = '';
        var codTienda = ''
        var consTienda = ''
        var Precio = 0.00;
        var Comision = 0.00;
        var Descuento = 0.00;
        var Total = 0.00;
        var urlImagenSusti = '';
        var DireccionTienda = '';

        var cantidad = '';

        var NombreArticulo = '';
        var CodigoArt = '';
        var MarcaArticulo = '';
        var ColorArticulo = '';
        var CategoriArticulo = '';
        var PrecioSinIgv = '';
        var stock = '';
        var strhtmlF = ''
        var cant = 0;

        if (listArticulos != null) {

            $.each(listArticulos, function (index, item) {

                cant += 1
                CodigoArt = item.codigoArt;
                strUrlImagen = item.strUrlImagen
                NombreArticulo = item.DescriArt
                MarcaArticulo = item.MarcaArt
                ColorArticulo = item.ColorArt
                PrecioSinIgv = item.PrecioArt
                CategoriArticulo = item.Cat_Pri_Descripcion + ' > ' + item.Cat_Descripcion

                var strhtml = ConstHtmlDetalle;
                var strhtmlTallas = ConstHtmlDetalleTallas
                //style = "font-size:14px;width:90%;text-align:left;"
                var strIni = '<tr><td style="text-align:left;">&nbsp;<i class="fa fa-check-circle"></i>&nbsp;<b>';
                var strIniCn = '<tr><td style="text-align:left;" colspan="2">&nbsp;<i class="fa fa-check-circle"></i>&nbsp;<b>';
                var strIniS = '<tr><td style="text-align:left;"><b>';
                var strIniNombre = '<tr><td style="text-align:center;" colspan="2" >&nbsp;&nbsp;<b>';
                var strMedio = '</b></td><td valign="top" style="padding:0; margin:0;text-align:left;">&nbsp;&nbsp;'
                var strMedioCant = '</b></td><td valign="top" style="padding:0; margin:0;text-align:center;">'
                var strMedioPrecio = '</b></td><td valign="top" style="padding:0; margin:0;text-align:left;color:#FF0000;">&nbsp;&nbsp;'
                var strFin = '</td></tr>';

                var strNombre = strIniNombre + '' + '<b>' + NombreArticulo + strFin;
                var strCodigo = strIniNombre + '' + '<b>' + CodigoArt + strFin;
                var strMarca = strIni + 'Marca:' + strMedio + MarcaArticulo + strFin;
                var strColor = strIni + 'Color:' + strMedio + ColorArticulo + strFin;
                var strPrecio = strIni + 'Precio:' + strMedioPrecio + 'S/.' + item.PrecioArt + strFin;



                strhtml = strhtml.replace("Nombre", strNombre);
                strhtml = strhtml.replace("Codigo", strCodigo);

                strhtml = strhtml.replace("Marca", strMarca);
                strhtml = strhtml.replace("Color", strColor);
                strhtml = strhtml.replace("Precio", strPrecio);
                //strhtml = strhtml.replace("Talla", strTalla);
                //strhtml = strhtml.replace("Cantidad", strCantidad);
                strhtml = strhtml.replace("DireccionImagen", strUrlImagen);

                var listTallasCantidad2 = item.listTallas;
                var total = 0;



                for (var j = 0; j < listTallasCantidad2.length; j++) {

                    var strhtmlTotal = strhtml;
                    var CodTalla = listTallasCantidad2[j].codTalla;

                    var strTalla = strIni + 'Talla:' + strMedio + CodTalla + strFin;
                    strhtmlTotal = strhtmlTotal.replace("Talla", strTalla);

                    var stock = listTallasCantidad2[j].stockTalla;

                    var strCantidad = strIniS + butonDelete + strMedioCant + '<table><tr><td>' + BotonResta + '</td><td width="50px"><div id="div_' + CodigoArt + '_' + CodTalla + '" >' + listTallasCantidad2[j].CantTalla + '</div><div style="display:none">' + InputCantidadTalla + '</div></td><td>' + BotonSuma + '</td></tr></table>' + strFin;
                    strhtmlTotal = strhtmlTotal.replace("Cantidad", strCantidad);

                    strhtmlTotal = strhtmlTotal.replace("inpArtTalla", "inpt_" + CodigoArt + '_' + CodTalla);
                    strhtmlTotal = strhtmlTotal.replace("valorInp", listTallasCantidad2[j].CantTalla);



                    strhtmlTotal = strhtmlTotal.replace("Sstock", stock);

                    strhtmlTotal = strhtmlTotal.replace("IdArticuloTallaS", CodTalla);
                    strhtmlTotal = strhtmlTotal.replace("IdArticuloTallaR", CodTalla);

                    strhtmlTotal = strhtmlTotal.replace("IdArticuloCodS", CodigoArt);
                    strhtmlTotal = strhtmlTotal.replace("IdArticuloCodR", CodigoArt);

                    strhtmlTotal = strhtmlTotal.replace("valorArticuloDelete", CodigoArt);//para el boton eliminar
                    strhtmlTotal = strhtmlTotal.replace("valorTallaDelete", CodTalla); //para le boton eliminar


                    var strDCantidad = strIniCn + 'Cantidad:' + '<b>' + strFin;
                    strhtmlTotal = strhtmlTotal.replace("CDantidad", strDCantidad);

                    divFinal += strhtmlTotal;
                }

            })



            strhtmlF += '<div id="listTalla" style="overflow-x: hidden; overflow-y:auto;height:200px;">'
            strhtmlF += divFinal
            strhtmlF += '</div>'
        }
        if (cant > 0)
            document.getElementById("DivListCompra").innerHTML = strhtmlF;

        recalcularCostosArticulos();

    }

    function CantidadArticuloTalla(codigoArticulo, talla) {

        var cantidad = 0;

        for (var i = 0; i < listArticulos.length; i++) {

            if (codigoArticulo == listArticulos[i].codigoArt) {

                var listTallasCantidad = listArticulos[i].listTallas;

                for (var j = 0; j < listTallasCantidad.length; j++) {

                    var CodTalla = listTallasCantidad[j].codTalla;

                    if (talla == CodTalla) {

                        cantidad = listTallasCantidad[j].CantTalla;
                        break;
                    }

                }

                break;
            }
        }

        return cantidad;
    }

    function AsignarCantidadArticuloTalla(codigoArticulo, talla, cantidad) {

        var porcComision = gCustomer.comision / 100;

        var lineArticulo = {
            codigoArt: "",
            DescriArt: "",
            MarcaArt: "",
            ColorArt: "",
            PrecioArt: 0.00,
            listTallas: [],
            Comission: 0.00,
            Descuento: 0.00,
            Total: 0.00,
            CantidadTotal: 0,
            strUrlImagen: ""
        }

        var PrecioArt = 0.00;
        var LinecantTotal = 0;

        for (var i = 0; i < listArticulos.length; i++) {

            if (codigoArticulo == listArticulos[i].codigoArt) {

                lineArticulo.codigoArt = listArticulos[i].codigoArt;
                lineArticulo.DescriArt = listArticulos[i].DescriArt;
                lineArticulo.MarcaArt = listArticulos[i].MarcaArt;
                lineArticulo.ColorArt = listArticulos[i].ColorArt;
                lineArticulo.strUrlImagen = listArticulos[i].strUrlImagen;

                LinecantTotal = listArticulos[i].LinecantTotal;
                PrecioArt = listArticulos[i].PrecioArt;

                var listTallasCantidad = listArticulos[i].listTallas;

                for (var j = 0; j < listTallasCantidad.length; j++) {

                    var CodTalla = listTallasCantidad[j].codTalla;

                    if (talla == CodTalla) {

                        var cantidadOld = listTallasCantidad[j].CantTalla;

                        listTallasCantidad[j].CantTalla = cantidad;

                        var ComissionT = (((PrecioArt * cantidad)) * porcComision) * 1;
                        var comisionTalla = Math.round(ComissionT * 100) / 100;

                        listTallasCantidad[j].comisionTalla = comisionTalla;



                        lineArticulo.listTallas = listTallasCantidad;

                        LinecantTotal = LinecantTotal + cantidad - cantidadOld;

                        lineArticulo.LinecantTotal = LinecantTotal;


                        listArticulos.splice(i, 1);

                        break;
                    }
                }
                break;
            }
        }


        var porcComision = gCustomer.comision / 100;
        var Comission = (((PrecioArt * LinecantTotal)) * porcComision) * 1;
        var desc = lineArticulo.Descuento
        var comiss = Math.round(Comission * 100) / 100;
        var Total = Math.round(((PrecioArt * LinecantTotal) - comiss - desc) * 100) / 100;

        lineArticulo.PrecioArt = PrecioArt;
        lineArticulo.Comission = comiss;
        lineArticulo.listTallas = listTallasCantidad;
        lineArticulo.Total = Total;
        lineArticulo.Comission = comiss;
        lineArticulo.CantidadTotal = LinecantTotal;
        listArticulos.push(lineArticulo);

    }

    function sumarCantidadMovil(control) {

        var codTalla = control.getAttribute('data-id');
        var codArticulo = control.getAttribute('data-art');
        var stock = parseInt(control.getAttribute('data-modal'));
        var cInput = 'inpt_' + codArticulo + '_' + codTalla;
        var valorActual = parseInt($('#' + cInput).val()) + 1;

        if (valorActual <= stock) {

            $('#' + cInput).val(valorActual);
            document.getElementById('div_' + codArticulo + '_' + codTalla).innerHTML = valorActual;
            AsignarCantidadArticuloTalla(codArticulo, codTalla, valorActual);
            recalcularCostosArticulos();

        } else {

            toastr.error("Cantidad no debe superar el stock:" + stock + ".", "Aviso");
        }
        //alert(CantidadArticuloTalla(codArticulo, codTalla))
        //var valorInt = 0;
        //var msjAlert = "";
        //valorInt = ((BorrarEspacio(valor) == '') ? (1) : parseInt(valor) + 1);
        //valorInt = ((valorInt >= stock) ? (stock) : valorInt);

        //$('#' + cInput).val(valorInt);
    }

    function restarCantidadMovil(control) {

        var codTalla = control.getAttribute('data-id');
        var codArticulo = control.getAttribute('data-art');
        var cInput = 'inpt_' + codArticulo + '_' + codTalla;
        var valorActual = parseInt($('#' + cInput).val()) - 1;

        if (valorActual >= 1) {
            $('#' + cInput).val(valorActual);
            document.getElementById('div_' + codArticulo + '_' + codTalla).innerHTML = valorActual;
            AsignarCantidadArticuloTalla(codArticulo, codTalla, valorActual);
            recalcularCostosArticulos();
        }
    }

    //FIN FUNCIONES QUE PASAN CON UN DISPOSITIVO MOVIL

    function ListarNotaCreditoParcial() {

        waitingDialog.show('Espere un momento por favor');
        var TeamDetailPostBackURL = "@Url.Action("ListaNC", "Pedido")";

        var $buttonClicked = $(this);

        var options = { "backdrop": "static", keyboard: true };
        $.ajax({
            type: "GET",
            url: TeamDetailPostBackURL,
            contentType: "application/json; charset=utf-8",
            data: { BasId: gCustomer.idCust, LiqId: '' },
            datatype: "json",
            cache: true,
            success: function (data) {
                waitingDialog.hide();

                //debugger;
                $('#myModalContent').html(data);
                $('#myModal').modal(options);
                $('#myModal').modal('show');


            },
            error: function () {
                waitingDialog.hide();
                alert("Dynamic content load failed.");

            }
        })
    }

    /*Recuperar una liquidacion para su edicion */
    function getLiquidacion(IdLiquidacion) {

        gLiqId = IdLiquidacion;

        //waitingDialog.show('Espere un momento por favor');

        var ControllerUrl = "@Url.Action("getLiquidacionDetalle", "Pedido")";

        $.ajax({
            type: "GET",
            url: ControllerUrl,
            contentType: "application/json; charset=utf-8",
            data: { LiqId: IdLiquidacion },
            datatype: "json",
            cache: true,
            success: function (data) {

                var codArticulo = '';
                var dsctoTotal = 0.00;
                var cantTotal = 0.00;
                var comisionTotal = 0.00;
                var listTallasCantidad = [];
                var glineArticulo
                var totalArticulo = 0.00;

                $.each(data, function (index, item) {

                    codArticulo = ((codArticulo == '') ? (item._code) : codArticulo);

                    if (codArticulo != item._code) {

                        glineArticulo.listTallas = listTallasCantidad
                        glineArticulo.Comission = comisionTotal
                        glineArticulo.Descuento = dsctoTotal
                        glineArticulo.Total = totalArticulo
                        listTallasCantidad = [];
                        listArticulos.push(glineArticulo);
                        codArticulo = item._code;
                        cantTotal = 0.00;
                        dsctoTotal = 0.00;
                        comisionTotal = 0.00;
                        totalArticulo = 0.00;
                    }

                    glineArticulo = {
                        codigoArt: item._code,
                        DescriArt: item._artName,
                        MarcaArt: item._brand,
                        ColorArt: item._color,
                        PrecioArt: item._price,
                        AfecPercep: item._ap_percepcion,
                        Ofe_tipo: item._ofe_Tipo,
                        Ofe_Id: item._ofe_id,
                        Ofe_MaxPares: item._ofe_maxpares,
                        Ofe_Porc: item._ofe_porc,
                        Ofe_ArtVenta: item._ofe_PrecioPack,
                        listTallas: [],
                        Comission: 0.00,
                        Descuento: 0.00,
                        Total: item._code,
                        CantidadTotal: 0,
                        strUrlImagen: item._ArtImg,
                    }

                    var CostoTotal = Math.round((parseFloat(item._price) * parseFloat(item._qty)) * 100) / 100;
                    var TotalTalla = Math.round((CostoTotal - parseFloat(item._commission)) * 100) / 100;

                    cantTotal += cantTotal + parseInt(item._qty);
                    dsctoTotal += parseFloat(item._dscto);
                    comisionTotal += parseFloat(item._commission);
                    totalArticulo += TotalTalla;

                    var oTalla = {
                        Ofe_tipo: item._ofe_Tipo,
                        Ofe_Id: item._ofe_id,
                        Ofe_MaxPares: item._ofe_maxpares,
                        Ofe_Porc: item._ofe_porc,
                        Ofe_ArtVenta: item._ofe_PrecioPack,
                        codTalla: item._size,
                        CantTalla: item._qty,
                        stockTalla: item._Stkqty,
                        comisionTalla: item._commission,
                        descuentoTalla: item._dscto,
                        totalTalla: TotalTalla,
                    }



                    listTallasCantidad.push(oTalla);


                });

                glineArticulo.listTallas = listTallasCantidad
                glineArticulo.Comission = comisionTotal
                glineArticulo.Descuento = dsctoTotal
                glineArticulo.Total = totalArticulo

                listArticulos.push(glineArticulo);
                validarOferta();
                DibujarGrilla();

                waitingDialog.hide();
            },
            error: function () {
                waitingDialog.hide();
                alert('Error')
            }
        });

        waitingDialog.hide();
    }

    /*fin de recuperar una liquidacion para su edicion*/

    /*LISTA LAS NOTAS DE CREDITO PARA EL PAGO DE LA LIQUIDACION*/


    function ListarNotaCredito() {
        waitingDialog.show('Espere un momento por favor');

        var lBasId = gCustomer.idCust

        var css = 'class="row"'
        var border2 = 'padding: 5px 5px 5px 5px;border:2px'
        var espacio = '&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'
        var ConstTalla = '<td><div style="margin-top:2px;margin-right:2px;"><button class="btn btn-white btn-xs" style="width:100%;">variableTalla</button></div></td>'
        var BotonSuma = '<button title="Sumar Cantidad" class="btnSuma btn btn-success" onclick="sumarCantidad(this)" data-id="IdArticuloTallaS" data-modal="Sstock" data-toggle="modal"><span class="glyphicon glyphicon-plus"></span></button>'
        var BotonResta = '<button title="Restar Cantidad" class="btnResta btn btn-danger" onclick="restarCantidad(this)" data-id="IdArticuloTallaR" data-modal="Rstock" data-toggle="modal"><span class="glyphicon glyphicon-minus"></span></button>'
        var InputCantidadTalla = '<input id="inpArtTalla" type="Text"  name="Talla" value="valor" placeholder="cantidad" onchange = "validarStock(this)" data-id="inpStock" style="width:100%;" autofocus="" class="form-control"/>'
        var ConstHtmlTienda = '<br/><div id="lugar" style="background:#FFFFFF;' + border2 + '" ><div ' + css + '  style="background:#FFFFFF;" ><div class="col-sm-12"><div><h4><strong>VariableTienda</strong></h4><p>&nbsp;DireccionTienda</p></div><table><tr><td><div style="margin-top:2px;">' + BotonResta + '</div></td><td style="width:100px"><div style="margin-top:2px;">' + InputCantidadTalla + '</div></td><td><div style="margin-top:2px;">' + BotonSuma + '</div></td></tr></table></div><br/></div></div>';
        var ConstCantidad = ''
        var listTalla = '';
        var listCantidad = '';
        var divFinal = '';
        var strUrlImagen = '';
        var options = { "backdrop": "static", keyboard: true };

        var ControllerUrl = "@Url.Action("getListaNC", "Pedido")";

        $.ajax({
            type: "GET",
            url: ControllerUrl,
            contentType: "application/json; charset=utf-8",
            data: { BasId: lBasId, LiqId: gLiqId },
            datatype: "json",
            cache: true,
            success: function (data) {

                //$.each(data, function (index, item) {
                //    alert(item.Ncredito)
                //});

                var style = 'style="background:#FFFFFF;width:30%;vertical-align:middle;border: 1px solid;border-color:gainsboro"';
                var row = '<tr><td ' + style + '>valor1</td><td ' + style + ' >valor2</td><td ' + style + ' >valor3</td></tr>'
                var strCheck = '<input type="checkbox" onchange="validarMontoNC(this)" id="IdNc" name="notaCredito" value="Bike">'
                var strRowTotal = ''
                var divGeneral = '<div id="IdMto" style="display:none;" >valorMto</div>'
                var divList = ''
                $.each(data, function (index, item) {
                    //alert(item.Ncredito)

                    strRowTotal += row;
                    strRowTotal = strRowTotal.replace("valor1", strCheck);
                    strRowTotal = strRowTotal.replace("IdNc", item.Rhv_return_nro);
                    strRowTotal = strRowTotal.replace("valor2", item.Ncredito);
                    strRowTotal = strRowTotal.replace("valor3", 'S/.' + item.Importe);
                    divList += divGeneral;
                    divList = divList.replace("IdMto", 'dm_' + item.Rhv_return_nro);
                    divList = divList.replace("valorMto", item.Importe);


                });

                var strhtml = ''

                strhtml += '<div class="modal-header modal-header-danger" style="margin-top:0px;margin-bottom:0px;padding-top:2px;padding-bottom:2px;">'
                strhtml += '<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>'
                strhtml += '<h5 class="modal-title" id="myModalLabel">'
                strhtml += 'Seleccione nota de credito'
                strhtml += '</h5>'
                strhtml += '</div>'
                strhtml += '<div class="modal-body">'
                strhtml += '<table id="example" class="table table-hover dataTable  table-striped table-responsive">'
                strhtml += '<tbody>'
                strhtml += strRowTotal
                strhtml += '</tbody>'
                strhtml += '</table>'
                strhtml += '</div>'
                strhtml += '<div id="listadeNotas" style="display:none;" >'
                strhtml += divList
                strhtml += '</div>'
                strhtml += '<div class="modal-footer" style="margin-top:-30px">'
                strhtml += '<button type="button" class="btn btn-default" data-dismiss="modal">Cerrar</button>'
                strhtml += '<input type="button" class="btn btn-primary" onclick="agregarNotaCredito()"   value="Agregar" />'
                strhtml += '</div>'
                var options = { "backdrop": "static", keyboard: true };

                $('#myModalContent').html(strhtml);
                $('#myModal').modal(options);
                $('#myModal').modal('show');

                waitingDialog.hide();
            },
            error: function () {
                waitingDialog.hide();
                alert('Error')
            }
        });

        waitingDialog.hide();
    }

    function agregarNotaCredito() {

        gvalorTotalCredito = 0.00;
        glistPago = [];

        $('input[name="notaCredito"]').each(function () {

            var Idnota = $(this).attr("id");

            if ($(this).is(':checked')) {
                var valorNC = parseFloat(document.getElementById('dm_' + Idnota).innerHTML);

                var objNc = {
                    numeroDoc: Idnota,
                    valorDoc: valorNC
                }

                gvalorTotalCredito += valorNC;
                glistPago.push(objNc);
            }

        });
        recalcularCostosArticulos();
    }

    function validarMontoNC(control) {

        var ctrlId = $(control).attr("id");
        var montoTotalNC = 0.00;
        var bchekect

        $('input[name="notaCredito"]').each(function () {

            var Idnota = $(this).attr("id");

            if ($(this).is(':checked')) {

                if (ctrlId != Idnota) {
                    var valorNC = parseFloat(document.getElementById('dm_' + Idnota).innerHTML);
                    montoTotalNC += valorNC
                } else {

                }

            }
        });

        if (montoTotalNC > gTotal) {
            document.getElementById(ctrlId).checked = false;
            toastr.error("No se puede seleccionar este registro, porque el total de saldos es mayor al total pedido.", "Error");

        }

    }


    /*FIN DEL LISTADO DE LAS NOTAS DE CREDITO*/





</script>